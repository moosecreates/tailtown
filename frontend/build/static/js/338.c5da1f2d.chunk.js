"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[338],{70338:(e,t,s)=>{s.r(t),s.d(t,{default:()=>D});var l=s(9950),a=s(28429),i=s(62999),r=s(78317),n=s(10226),u=s(52432),c=s(36080),d=s(82053),o=s(65429),h=s(48089),x=s(50704),m=s(60899),A=s(8145),p=s(25979),j=s(19647),y=s(70006),v=s(23266),g=s(24516),E=s(25277),b=s(16497),f=s(93038),T=s(46639),P=s(14801),C=s(42074),S=s(41084),N=s(44414);const D=()=>{const{id:e}=(0,a.g)(),t=(0,a.Zp)(),s="new"===e||window.location.pathname.includes("/price-rules/new"),[D,R]=(0,l.useState)(!1),[I,O]=(0,l.useState)(!1),[W,_]=(0,l.useState)(""),[w,k]=(0,l.useState)(""),[M,U]=(0,l.useState)(""),[z,F]=(0,l.useState)(""),[L,G]=(0,l.useState)("DISCOUNT"),[Y,q]=(0,l.useState)("PERCENTAGE"),[V,K]=(0,l.useState)(0),[Q,B]=(0,l.useState)(""),[H,J]=(0,l.useState)(""),[X,Z]=(0,l.useState)(!0),[$,ee]=(0,l.useState)(10),[te,se]=(0,l.useState)([]),[le,ae]=(0,l.useState)(""),[ie,re]=(0,l.useState)(""),ne=(0,l.useCallback)(async()=>{try{R(!0);const t=(await S.A.getPriceRuleById(e)).data;if(k(t.name),U(t.description||""),F(t.ruleType),G(t.adjustmentType||"DISCOUNT"),q(t.discountType),K(t.discountValue),B(t.minQuantity||""),J(t.maxQuantity||""),Z(t.isActive),ee(t.priority),t.daysOfWeek)try{se(JSON.parse(t.daysOfWeek))}catch(l){console.error("Error parsing days of week:",l)}t.startDate&&ae(t.startDate.split("T")[0]),t.endDate&&re(t.endDate.split("T")[0]),_("")}catch(a){var t,s;console.error("Error loading price rule:",a),_((null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Failed to load price rule")}finally{R(!1)}},[e]);(0,l.useEffect)(()=>{e&&"new"!==e&&ne()},[e,ne]);const ue=e=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e];return(0,N.jsx)(i.A,{maxWidth:"md",children:(0,N.jsxs)(r.A,{sx:{mt:4,mb:4},children:[(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,N.jsx)(n.A,{component:C.N_,to:"/settings/price-rules",startIcon:(0,N.jsx)(P.A,{}),sx:{mr:2},children:"Back"}),(0,N.jsxs)(r.A,{children:[(0,N.jsxs)(u.A,{"aria-label":"breadcrumb",sx:{mb:1},children:[(0,N.jsx)(c.A,{component:C.N_,to:"/settings",color:"inherit",children:"Settings"}),(0,N.jsx)(c.A,{component:C.N_,to:"/settings/price-rules",color:"inherit",children:"Price Rules"}),(0,N.jsx)(d.A,{color:"text.primary",children:s?"Create New Rule":"Edit Rule"})]}),(0,N.jsx)(d.A,{variant:"h4",component:"h1",children:s?"Create New Price Rule":"Edit Price Rule"})]})]}),W&&(0,N.jsx)(o.A,{severity:"error",sx:{mb:3},children:W}),(0,N.jsxs)("form",{onSubmit:async l=>{if(l.preventDefault(),w&&z&&Y&&void 0!==V)if("PERCENTAGE"===Y&&(V<0||V>100))_("Percentage discount must be between 0 and 100");else if("DAY_OF_WEEK"!==z||0!==te.length)try{O(!0);const l={name:w,description:M||void 0,ruleType:z,adjustmentType:L,discountType:Y,discountValue:V,minQuantity:""===Q?void 0:Number(Q),maxQuantity:""===H?void 0:Number(H),isActive:X,priority:$,daysOfWeek:te.length>0?JSON.stringify(te):void 0,startDate:le||void 0,endDate:ie||void 0};let a;a=s?await S.A.createPriceRule(l):await S.A.updatePriceRule(e,l),t("/settings/price-rules")}catch(r){var a,i;console.error("Error saving price rule:",r),_((null===(a=r.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.message)||"Failed to save price rule")}finally{O(!1)}else _("Please select at least one day of the week");else _("Please fill in all required fields")},children:[(0,N.jsx)(h.A,{children:(0,N.jsx)(x.A,{children:(0,N.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,N.jsx)(m.Ay,{item:!0,xs:12,children:(0,N.jsx)(A.A,{label:"Rule Name",fullWidth:!0,required:!0,value:w,onChange:e=>k(e.target.value),size:"small"})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,children:(0,N.jsx)(A.A,{label:"Description",fullWidth:!0,multiline:!0,rows:2,value:M,onChange:e=>U(e.target.value),size:"small"})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsxs)(p.A,{fullWidth:!0,required:!0,size:"small",children:[(0,N.jsx)(j.A,{children:"Rule Type"}),(0,N.jsxs)(y.A,{value:z,onChange:e=>F(e.target.value),label:"Rule Type",children:[(0,N.jsx)(v.A,{value:"DAY_OF_WEEK",children:"Day of Week"}),(0,N.jsx)(v.A,{value:"MULTI_DAY",children:"Multi-Day Stay"}),(0,N.jsx)(v.A,{value:"MULTI_PET",children:"Multiple Pets"}),(0,N.jsx)(v.A,{value:"SEASONAL",children:"Seasonal"}),(0,N.jsx)(v.A,{value:"PROMOTIONAL",children:"Promotional"}),(0,N.jsx)(v.A,{value:"CUSTOM",children:"Custom"})]})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsxs)(p.A,{fullWidth:!0,required:!0,size:"small",children:[(0,N.jsx)(j.A,{children:"Adjustment Type"}),(0,N.jsxs)(y.A,{value:L,onChange:e=>G(e.target.value),label:"Adjustment Type",children:[(0,N.jsx)(v.A,{value:"DISCOUNT",children:"Discount (Reduce Price)"}),(0,N.jsx)(v.A,{value:"SURCHARGE",children:"Surcharge (Increase Price)"})]}),(0,N.jsx)(g.A,{children:"DISCOUNT"===L?"Reduces the price":"Increases the price"})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsxs)(p.A,{fullWidth:!0,required:!0,size:"small",children:[(0,N.jsx)(j.A,{children:"Value Type"}),(0,N.jsxs)(y.A,{value:Y,onChange:e=>q(e.target.value),label:"Value Type",children:[(0,N.jsx)(v.A,{value:"PERCENTAGE",children:"Percentage"}),(0,N.jsx)(v.A,{value:"FIXED_AMOUNT",children:"Fixed Amount"})]})]})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"".concat("DISCOUNT"===L?"Discount":"Surcharge"," Value (").concat("PERCENTAGE"===Y?"%":"FIXED_AMOUNT"===Y?"$":"",")"),fullWidth:!0,required:!0,type:"number",value:V,onChange:e=>K(Number(e.target.value)),InputProps:{inputProps:{min:0,max:"PERCENTAGE"===Y?100:void 0,step:"PERCENTAGE"===Y?1:.01}},size:"small",error:"PERCENTAGE"===Y&&(V<0||V>100),helperText:"PERCENTAGE"===Y&&(V<0||V>100)?"Percentage must be between 0 and 100":""})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"Priority",fullWidth:!0,type:"number",value:$,onChange:e=>ee(Number(e.target.value)),helperText:"Higher values have higher priority",InputProps:{inputProps:{min:0,step:1}},size:"small"})}),("MULTI_DAY"===z||"MULTI_PET"===z)&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"Minimum ".concat("MULTI_DAY"===z?"Days":"Pets"),fullWidth:!0,type:"number",value:Q,onChange:e=>B(""===e.target.value?"":Number(e.target.value)),InputProps:{inputProps:{min:1,step:1}},size:"small"})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"Maximum ".concat("MULTI_DAY"===z?"Days":"Pets"),fullWidth:!0,type:"number",value:H,onChange:e=>J(""===e.target.value?"":Number(e.target.value)),InputProps:{inputProps:{min:Number(Q)||1,step:1}},size:"small"})})]}),"DAY_OF_WEEK"===z&&(0,N.jsxs)(m.Ay,{item:!0,xs:12,children:[(0,N.jsx)(d.A,{variant:"subtitle2",gutterBottom:!0,children:"Days of Week"}),(0,N.jsx)(r.A,{display:"flex",flexWrap:"wrap",gap:1,children:[0,1,2,3,4,5,6].map(e=>(0,N.jsx)(E.A,{label:ue(e),onClick:()=>(e=>{te.includes(e)?se(te.filter(t=>t!==e)):se([...te,e])})(e),color:te.includes(e)?"primary":"default",variant:te.includes(e)?"filled":"outlined",sx:{mb:1}},e))}),"DAY_OF_WEEK"===z&&0===te.length&&(0,N.jsx)(g.A,{error:!0,children:"Please select at least one day"})]}),("SEASONAL"===z||"PROMOTIONAL"===z)&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"Start Date",fullWidth:!0,type:"date",value:le,onChange:e=>ae(e.target.value),InputLabelProps:{shrink:!0},size:"small"})}),(0,N.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(A.A,{label:"End Date",fullWidth:!0,type:"date",value:ie,onChange:e=>re(e.target.value),InputLabelProps:{shrink:!0},size:"small"})})]}),(0,N.jsx)(m.Ay,{item:!0,xs:12,children:(0,N.jsx)(b.A,{control:(0,N.jsx)(f.A,{checked:X,onChange:e=>Z(e.target.checked)}),label:"Active"})})]})})}),(0,N.jsxs)(r.A,{display:"flex",justifyContent:"flex-end",mt:3,children:[(0,N.jsx)(n.A,{variant:"outlined",onClick:()=>t("/settings/price-rules"),sx:{mr:2},children:"Cancel"}),(0,N.jsx)(n.A,{type:"submit",variant:"contained",color:"primary",disabled:I,children:I?(0,N.jsx)(T.A,{size:24}):s?"Create Rule":"Update Rule"})]})]})]})})}}}]);