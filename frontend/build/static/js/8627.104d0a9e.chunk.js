"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[8627],{18627:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var s=a(89379),r=a(9950),l=a(62999),n=a(78317),i=a(82053),o=a(10226),c=a(2235),d=a(69019),m=a(84142),p=a(65429),x=a(46639),u=a(60899),y=a(48089),h=a(50704),A=a(25277),j=a(25713),g=a(25333),b=a(96583),v=a(40033),f=a(28170),w=a(8145),C=a(25979),T=a(19647),S=a(70006),k=a(23266),E=a(79739),N=a(98785),M=a(53256),W=a(95302),U=a(12015),_=a(66387),z=a(40379),P=a(49939),B=a(20760),D=a(82932);const F=new class{async getAllTemplates(e){try{const t=new URLSearchParams;null!==e&&void 0!==e&&e.type&&t.append("type",e.type),null!==e&&void 0!==e&&e.category&&t.append("category",e.category),void 0!==(null===e||void 0===e?void 0:e.isActive)&&t.append("isActive",String(e.isActive));return(await D.Ay.get("/api/message-templates?".concat(t.toString()))).data.data||[]}catch(t){throw console.error("Error fetching message templates:",t),t}}async getTemplateById(e){try{return(await D.Ay.get("/api/message-templates/".concat(e))).data.data}catch(t){throw console.error("Error fetching template:",t),t}}async createTemplate(e){try{return(await D.Ay.post("/api/message-templates",e)).data.data}catch(t){throw console.error("Error creating template:",t),t}}async updateTemplate(e,t){try{return(await D.Ay.put("/api/message-templates/".concat(e),t)).data.data}catch(a){throw console.error("Error updating template:",a),a}}async deleteTemplate(e){try{await D.Ay.delete("/api/message-templates/".concat(e))}catch(t){throw console.error("Error deleting template:",t),t}}async duplicateTemplate(e){try{return(await D.Ay.post("/api/message-templates/".concat(e,"/duplicate"))).data.data}catch(t){throw console.error("Error duplicating template:",t),t}}};var I=a(44414);const R=()=>{const[e,t]=(0,r.useState)(0),[a,D]=(0,r.useState)(!1),[R,G]=(0,r.useState)(!1),[L,V]=(0,r.useState)(null),[q,O]=(0,r.useState)(null),[H,J]=(0,r.useState)(!0),[K,Q]=(0,r.useState)({open:!1,message:"",severity:"success"}),[X,Y]=(0,r.useState)({name:"",type:"sms",category:"appointment_reminder",subject:"",body:""}),[Z,$]=(0,r.useState)([]);(0,r.useEffect)(()=>{ee()},[]);const ee=async()=>{try{J(!0);const e=(await F.getAllTemplates()).map(e=>({id:e.id,name:e.name,type:e.type.toLowerCase(),category:e.category.toLowerCase(),subject:e.subject,body:e.body,variables:e.variables,isActive:e.isActive,createdAt:e.createdAt}));$(e)}catch(e){console.error("Error loading templates:",e),Q({open:!0,message:"Failed to load templates",severity:"error"})}finally{J(!1)}},te=e=>{e?(O(e),Y({name:e.name,type:e.type,category:e.category,subject:e.subject||"",body:e.body})):(O(null),Y({name:"",type:"sms",category:"appointment_reminder",subject:"",body:""})),D(!0)},ae=()=>{D(!1),O(null)},se=Z.filter(t=>0===e||(1===e?"sms"===t.type:2===e?"email"===t.type:3===e?"appointment_reminder"===t.category:4!==e||("marketing"===t.category||"promotional"===t.category))),re=e=>({appointment_reminder:"primary",marketing:"success",confirmation:"info",follow_up:"warning",promotional:"secondary"}[e]||"default");return(0,I.jsxs)(l.A,{maxWidth:"xl",children:[(0,I.jsxs)(n.A,{sx:{mt:4,mb:4},children:[(0,I.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,I.jsxs)(n.A,{children:[(0,I.jsx)(i.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Message Templates"}),(0,I.jsx)(i.A,{variant:"body1",color:"text.secondary",children:"Create and manage reusable templates for SMS and email communications"})]}),(0,I.jsx)(o.A,{variant:"contained",startIcon:(0,I.jsx)(M.A,{}),onClick:()=>te(),children:"Create Template"})]}),(0,I.jsx)(c.A,{sx:{mb:3},children:(0,I.jsxs)(d.A,{value:e,onChange:(e,a)=>{t(a)},sx:{borderBottom:1,borderColor:"divider"},children:[(0,I.jsx)(m.A,{label:"All Templates"}),(0,I.jsx)(m.A,{icon:(0,I.jsx)(W.A,{}),label:"SMS",iconPosition:"start"}),(0,I.jsx)(m.A,{icon:(0,I.jsx)(U.A,{}),label:"Email",iconPosition:"start"}),(0,I.jsx)(m.A,{icon:(0,I.jsx)(_.A,{}),label:"Reminders",iconPosition:"start"}),(0,I.jsx)(m.A,{label:"Marketing"})]})}),(0,I.jsx)(p.A,{severity:"info",sx:{mb:3},children:(0,I.jsxs)(i.A,{variant:"body2",children:[(0,I.jsx)("strong",{children:"Available Variables:"})," Use double curly braces to insert dynamic content. Common variables: customerName, petName, appointmentTime, businessName, businessPhone (wrap in double curly braces)"]})}),H?(0,I.jsx)(n.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,I.jsx)(x.A,{})}):(0,I.jsx)(u.Ay,{container:!0,spacing:3,children:se.map(e=>{return(0,I.jsx)(u.Ay,{item:!0,xs:12,md:6,lg:4,children:(0,I.jsxs)(y.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,I.jsxs)(h.A,{sx:{flexGrow:1},children:[(0,I.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",mb:2},children:["sms"===e.type?(0,I.jsx)(W.A,{sx:{mr:1,color:"primary.main"}}):(0,I.jsx)(U.A,{sx:{mr:1,color:"success.main"}}),(0,I.jsx)(i.A,{variant:"h6",component:"h2",sx:{flexGrow:1},children:e.name})]}),(0,I.jsxs)(n.A,{sx:{mb:2},children:[(0,I.jsx)(A.A,{label:(t=e.category,{appointment_reminder:"Appointment Reminder",marketing:"Marketing",confirmation:"Confirmation",follow_up:"Follow-Up",promotional:"Promotional"}[t]),color:re(e.category),size:"small",sx:{mr:1}}),(0,I.jsx)(A.A,{label:e.type.toUpperCase(),variant:"outlined",size:"small"})]}),e.subject&&(0,I.jsxs)(i.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["Subject: ",e.subject]}),(0,I.jsx)(i.A,{variant:"body2",color:"text.secondary",sx:{mt:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical"},children:e.body}),(0,I.jsx)(n.A,{sx:{mt:2},children:(0,I.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:["Variables: ",e.variables.length]})})]}),(0,I.jsxs)(j.A,{sx:{justifyContent:"space-between",px:2,pb:2},children:[(0,I.jsxs)(n.A,{children:[(0,I.jsx)(g.A,{size:"small",onClick:()=>te(e),title:"Edit",children:(0,I.jsx)(z.A,{fontSize:"small"})}),(0,I.jsx)(g.A,{size:"small",onClick:()=>(async e=>{try{await F.duplicateTemplate(e.id),Q({open:!0,message:"Template duplicated successfully",severity:"success"}),ee()}catch(t){console.error("Error duplicating template:",t),Q({open:!0,message:"Failed to duplicate template",severity:"error"})}})(e),title:"Duplicate",children:(0,I.jsx)(P.A,{fontSize:"small"})}),(0,I.jsx)(g.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this template?"))try{await F.deleteTemplate(e),Q({open:!0,message:"Template deleted successfully",severity:"success"}),ee()}catch(t){console.error("Error deleting template:",t),Q({open:!0,message:"Failed to delete template",severity:"error"})}})(e.id),title:"Delete",children:(0,I.jsx)(B.A,{fontSize:"small"})})]}),(0,I.jsx)(o.A,{size:"small",variant:"outlined",onClick:()=>{V(e),G(!0)},children:"Use Template"})]})]})},e.id);var t})}),!H&&0===se.length&&(0,I.jsxs)(c.A,{sx:{p:4,textAlign:"center"},children:[(0,I.jsx)(i.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No templates found"}),(0,I.jsx)(i.A,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Create your first template to get started"}),(0,I.jsx)(o.A,{variant:"contained",startIcon:(0,I.jsx)(M.A,{}),onClick:()=>te(),children:"Create Template"})]})]}),(0,I.jsxs)(b.A,{open:a,onClose:ae,maxWidth:"md",fullWidth:!0,children:[(0,I.jsx)(v.A,{children:q?"Edit Template":"Create New Template"}),(0,I.jsx)(f.A,{children:(0,I.jsxs)(n.A,{sx:{pt:2,display:"flex",flexDirection:"column",gap:2},children:[(0,I.jsx)(w.A,{label:"Template Name",fullWidth:!0,value:X.name,onChange:e=>Y((0,s.A)((0,s.A)({},X),{},{name:e.target.value})),required:!0}),(0,I.jsxs)(C.A,{fullWidth:!0,children:[(0,I.jsx)(T.A,{children:"Type"}),(0,I.jsxs)(S.A,{value:X.type,label:"Type",onChange:e=>Y((0,s.A)((0,s.A)({},X),{},{type:e.target.value})),children:[(0,I.jsx)(k.A,{value:"sms",children:"SMS"}),(0,I.jsx)(k.A,{value:"email",children:"Email"})]})]}),(0,I.jsxs)(C.A,{fullWidth:!0,children:[(0,I.jsx)(T.A,{children:"Category"}),(0,I.jsxs)(S.A,{value:X.category,label:"Category",onChange:e=>Y((0,s.A)((0,s.A)({},X),{},{category:e.target.value})),children:[(0,I.jsx)(k.A,{value:"appointment_reminder",children:"Appointment Reminder"}),(0,I.jsx)(k.A,{value:"confirmation",children:"Confirmation"}),(0,I.jsx)(k.A,{value:"follow_up",children:"Follow-Up"}),(0,I.jsx)(k.A,{value:"marketing",children:"Marketing"}),(0,I.jsx)(k.A,{value:"promotional",children:"Promotional"})]})]}),"email"===X.type&&(0,I.jsx)(w.A,{label:"Email Subject",fullWidth:!0,value:X.subject,onChange:e=>Y((0,s.A)((0,s.A)({},X),{},{subject:e.target.value})),helperText:"Use {{variableName}} for dynamic content"}),(0,I.jsx)(w.A,{label:"Message Body",fullWidth:!0,multiline:!0,rows:8,value:X.body,onChange:e=>Y((0,s.A)((0,s.A)({},X),{},{body:e.target.value})),helperText:"Use {{variableName}} for dynamic content (e.g., {{customerName}}, {{petName}})",required:!0}),(0,I.jsx)(p.A,{severity:"info",children:(0,I.jsxs)(i.A,{variant:"body2",children:[(0,I.jsx)("strong",{children:"Common Variables (wrap in double curly braces):"}),(0,I.jsx)("br",{}),"customerName, petName, appointmentTime, appointmentDate, serviceName, businessName, businessPhone, businessAddress"]})})]})}),(0,I.jsxs)(E.A,{children:[(0,I.jsx)(o.A,{onClick:ae,children:"Cancel"}),(0,I.jsx)(o.A,{onClick:async()=>{try{const e={name:X.name,type:X.type.toUpperCase(),category:X.category.toUpperCase(),subject:X.subject,body:X.body};q?(await F.updateTemplate(q.id,e),Q({open:!0,message:"Template updated successfully",severity:"success"})):(await F.createTemplate(e),Q({open:!0,message:"Template created successfully",severity:"success"})),ae(),ee()}catch(e){console.error("Error saving template:",e),Q({open:!0,message:"Failed to save template",severity:"error"})}},variant:"contained",disabled:!X.name||!X.body,children:q?"Update":"Create"})]})]}),(0,I.jsxs)(b.A,{open:R,onClose:()=>G(!1),maxWidth:"md",fullWidth:!0,children:[(0,I.jsxs)(v.A,{children:["Use Template: ",null===L||void 0===L?void 0:L.name]}),(0,I.jsx)(f.A,{children:(0,I.jsxs)(n.A,{sx:{pt:2},children:[(0,I.jsxs)(p.A,{severity:"info",sx:{mb:3},children:[(0,I.jsx)(i.A,{variant:"body2",children:(0,I.jsx)("strong",{children:"Next Steps:"})}),(0,I.jsxs)(i.A,{variant:"body2",component:"div",sx:{mt:1},children:["1. Go to ",(0,I.jsx)("strong",{children:"SMS Marketing"})," or ",(0,I.jsx)("strong",{children:"Email Marketing"})," to send this template",(0,I.jsx)("br",{}),"2. Select recipients from your customer list",(0,I.jsx)("br",{}),"3. The template will auto-fill with customer/pet data",(0,I.jsx)("br",{}),"4. Review and send!"]})]}),(0,I.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Template Preview:"}),(null===L||void 0===L?void 0:L.subject)&&(0,I.jsxs)(n.A,{sx:{mb:2},children:[(0,I.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Subject:"}),(0,I.jsx)(c.A,{sx:{p:2,bgcolor:"grey.50"},children:(0,I.jsx)(i.A,{variant:"body2",children:L.subject})})]}),(0,I.jsxs)(n.A,{sx:{mb:2},children:[(0,I.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Message:"}),(0,I.jsx)(c.A,{sx:{p:2,bgcolor:"grey.50"},children:(0,I.jsx)(i.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:null===L||void 0===L?void 0:L.body})})]}),(0,I.jsxs)(n.A,{sx:{mb:2},children:[(0,I.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:["Variables (",null===L||void 0===L?void 0:L.variables.length,"):"]}),(0,I.jsx)(n.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:null===L||void 0===L?void 0:L.variables.map(e=>(0,I.jsx)(A.A,{label:e,size:"small",variant:"outlined"},e))})]})]})}),(0,I.jsxs)(E.A,{children:[(0,I.jsx)(o.A,{onClick:()=>G(!1),children:"Close"}),(0,I.jsxs)(o.A,{variant:"contained",onClick:()=>{G(!1);const e="sms"===(null===L||void 0===L?void 0:L.type)?"/admin/marketing/sms":"/admin/marketing/email";window.location.href=e+"?template="+(null===L||void 0===L?void 0:L.id)},children:["Go to ","sms"===(null===L||void 0===L?void 0:L.type)?"SMS":"Email"," Marketing \u2192"]})]})]}),(0,I.jsx)(N.A,{open:K.open,autoHideDuration:6e3,onClose:()=>Q((0,s.A)((0,s.A)({},K),{},{open:!1})),children:(0,I.jsx)(p.A,{severity:K.severity,onClose:()=>Q((0,s.A)((0,s.A)({},K),{},{open:!1})),children:K.message})})]})}}}]);