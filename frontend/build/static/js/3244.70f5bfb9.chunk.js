"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[3244],{63244:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ie});var n=s(89379),i=s(9950),a=s(62999),r=s(78317),l=s(82053),o=s(2235),d=s(58535),c=s(43754),u=s(37885),x=s(10226),m=s(65429),h=s(46639),A=s(98785),p=s(60899),v=s(77922),j=s(8145),y=s(2046),g=s(25979),b=s(19647),f=s(70006),C=s(23266),D=s(19223),S=s(28783),I=s(6565),w=s(89007),P=s(35286),R=s(28429),N=s(44414);const E=e=>{let{onContinue:t,initialCustomer:s,initialPets:a}=e;const d=(0,R.Zp)(),[c,u]=(0,i.useState)(""),[A,E]=(0,i.useState)([]),[T,k]=(0,i.useState)(s),[O,z]=(0,i.useState)(!1),[q,W]=(0,i.useState)(null),[F,B]=(0,i.useState)([]),[M,U]=(0,i.useState)(a),[V,_]=(0,i.useState)(!1),[H,L]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(c.length<2)E([]);else try{z(!0),W(null);const e=await w.m.searchCustomers(c);E(e.data||[])}catch(e){console.error("Error loading customers:",e),W("Failed to load customers. Please try again.")}finally{z(!1)}})()},[c]),(0,i.useEffect)(()=>{(async()=>{if(!T)return B([]),void U([]);try{var e;_(!0),L(null);const t=await P.B.getPetsByCustomer(T.id);if(B(t.data||[]),1===(null===(e=t.data)||void 0===e?void 0:e.length))U([t.data[0]]);else if(a.length>0&&t.data){const e=a.filter(e=>t.data.some(t=>t.id===e.id));U(e)}else U([])}catch(t){console.error("Error loading pets:",t),L("Failed to load pets. Please try again.")}finally{_(!1)}})()},[T,a]);return(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Customer & Pet Information"}),q&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:2},children:q}),H&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:2},children:H}),(0,N.jsxs)(o.A,{elevation:2,sx:{p:3,mb:3},children:[(0,N.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Customer"}),(0,N.jsxs)(p.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,N.jsx)(p.Ay,{item:!0,xs:12,md:9,children:(0,N.jsx)(v.A,{id:"customer-select",options:A,value:T,onChange:(e,t)=>{k(t)},getOptionLabel:e=>"".concat(e.firstName," ").concat(e.lastName," (").concat(e.email,")"),renderInput:e=>(0,N.jsx)(j.A,(0,n.A)((0,n.A)({},e),{},{label:"Search Customers",variant:"outlined",size:"small",fullWidth:!0,onChange:e=>u(e.target.value),InputProps:(0,n.A)((0,n.A)({},e.InputProps),{},{startAdornment:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(y.A,{position:"start",children:(0,N.jsx)(D.A,{})}),e.InputProps.startAdornment]}),endAdornment:(0,N.jsxs)(N.Fragment,{children:[O?(0,N.jsx)(h.A,{size:20}):null,e.InputProps.endAdornment]})}),helperText:"Search by name, email, or phone"})),loading:O,loadingText:"Searching customers...",noOptionsText:"No customers found"})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,md:3,children:(0,N.jsx)(x.A,{variant:"outlined",startIcon:(0,N.jsx)(S.A,{}),onClick:()=>{d("/customers/new?redirect=/orders/new")},fullWidth:!0,children:"New Customer"})})]}),T&&(0,N.jsxs)(r.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid #e0e0e0"},children:[(0,N.jsxs)(l.A,{variant:"subtitle2",children:[T.firstName," ",T.lastName]}),(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Email: ",T.email]}),(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Phone: ",T.phone||"N/A"]}),T.address&&(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Address: ",T.address,", ",T.city||""," ",T.state||""," ",T.zipCode||""]})]})]}),(0,N.jsxs)(o.A,{elevation:2,sx:{p:3,mb:3},children:[(0,N.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Pets (Select one or more)"}),(0,N.jsxs)(g.A,{fullWidth:!0,size:"small",disabled:!T||V,children:[(0,N.jsx)(b.A,{id:"pet-select-label",children:"Select Pets"}),(0,N.jsx)(f.A,{labelId:"pet-select-label",id:"pet-select",multiple:!0,value:M.map(e=>e.id),label:"Select Pets",onChange:e=>{const t=e.target.value,s=F.filter(e=>t.includes(e.id));U(s)},startAdornment:(0,N.jsx)(y.A,{position:"start",children:(0,N.jsx)(I.A,{})}),endAdornment:V?(0,N.jsx)(y.A,{position:"end",children:(0,N.jsx)(h.A,{size:20})}):null,renderValue:e=>{const t=e;return F.filter(e=>t.includes(e.id)).map(e=>e.name).join(", ")},children:F.map(e=>(0,N.jsxs)(C.A,{value:e.id,children:[e.name," (",e.type.toLowerCase(),")",e.breed?" - ".concat(e.breed):""]},e.id))})]}),M.length>0&&(0,N.jsx)(r.A,{sx:{mt:2,display:"flex",flexDirection:"column",gap:1},children:M.map(e=>(0,N.jsxs)(r.A,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid #e0e0e0"},children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:e.name}),(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Type: ",e.type,e.breed?", Breed: ".concat(e.breed):""]}),e.gender&&(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Gender: ",e.gender,e.isNeutered?" (Neutered/Spayed)":""]}),e.specialNeeds&&(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Special Needs: ",e.specialNeeds]})]},e.id))})]}),(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:(0,N.jsxs)(x.A,{variant:"contained",color:"primary",onClick:()=>{T&&M.length>0?t(T,M):(T||W("Please select a customer"),0===M.length&&L("Please select at least one pet"))},disabled:!T||0===M.length,children:["Continue ",M.length>0&&"(".concat(M.length," pet").concat(M.length>1?"s":"",")")]})})]})};var T=s(95722),k=s(22580),O=s(81831),z=s(396),q=s(41976),W=s(92383);const F=e=>{let{onContinue:t,customer:s,pet:n,initialReservation:a}=e;const[d,c]=(0,i.useState)(a.startDate||new Date),[u,A]=(0,i.useState)(()=>{if(a.endDate)return a.endDate;const e=new Date;return e.setDate(e.getDate()+1),e}),[v,y]=(0,i.useState)([]),[D,S]=(0,i.useState)(""),[I,w]=(0,i.useState)([]),[P,R]=(0,i.useState)(""),[E,F]=(0,i.useState)(a.notes||""),[B,M]=(0,i.useState)(!1),[U,V]=(0,i.useState)(!1),[_,H]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{M(!0),H(null);const e=await q.V.getAllServices();e&&e.data&&(y(e.data),e.data.length>0&&(a.serviceId&&e.data.some(e=>e.id===a.serviceId)?S(a.serviceId):S(e.data[0].id)))}catch(e){console.error("Error loading services:",e),H("Failed to load services. Please try again.")}finally{M(!1)}})()},[]),(0,i.useEffect)(()=>{(async()=>{if(d&&u&&D)try{V(!0),H(null);const e=d.toISOString().split("T")[0],t=u.toISOString().split("T")[0],s=await W.c.getAvailableResourcesByDate(e,t,D);s&&s.data?(w(s.data),!P||0!==s.data.length&&s.data.some(e=>e.id===P)||R("")):(w([]),R(""))}catch(e){console.error("Error loading resources:",e),H("Failed to load available resources. Please try again.")}finally{V(!1)}})()},[d,u,D,P]);const L=e=>{const t=e;if(c(t),t&&u&&t>=u){const e=new Date(t.getTime());e.setDate(e.getDate()+1),A(e)}};return(0,N.jsx)(O.$,{dateAdapter:z.h,children:(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Reservation Details"}),_&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:2},children:_}),(!s||!n)&&(0,N.jsx)(m.A,{severity:"warning",sx:{mb:2},children:"Please select a customer and pet before creating a reservation."}),(0,N.jsxs)(o.A,{elevation:2,sx:{p:3,mb:3},children:[(0,N.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:["Customer: ",s?"".concat(s.firstName," ").concat(s.lastName):"Not selected"]}),(0,N.jsxs)(l.A,{variant:"subtitle1",gutterBottom:!0,children:["Pet: ",n?n.name:"Not selected"]}),(0,N.jsxs)(p.Ay,{container:!0,spacing:2,sx:{mt:2},children:[(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsxs)(g.A,{fullWidth:!0,size:"small",disabled:B||!s||!n,children:[(0,N.jsx)(b.A,{id:"service-select-label",children:"Service Type"}),(0,N.jsx)(f.A,{labelId:"service-select-label",id:"service-select",value:D,label:"Service Type",onChange:e=>{const t=e.target.value;S(t);const s=v.find(e=>e.id===t);if(s&&s.duration&&d){const e=new Date(d.getTime());e.setMinutes(e.getMinutes()+s.duration),A(e)}},endAdornment:B?(0,N.jsx)(h.A,{size:20,sx:{mr:2}}):null,children:v.map(e=>(0,N.jsxs)(C.A,{value:e.id,children:[e.name," - $",e.price.toFixed(2)]},e.id))})]})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(T.l,{label:"Start Date",value:d,onChange:L,slotProps:{textField:{fullWidth:!0,size:"small",disabled:!s||!n}},minDate:new Date})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(k.A,{label:"Start Time",value:d,onChange:e=>{if(!e||!d)return;const t=new Date(d);t.setHours(e.getHours(),e.getMinutes()),L(t);const s=v.find(e=>e.id===D);if(s&&s.duration){const e=new Date(t.getTime());e.setMinutes(e.getMinutes()+s.duration),A(e)}},slotProps:{textField:{fullWidth:!0,size:"small",disabled:!s||!n}}})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(T.l,{label:"End Date",value:u,onChange:e=>A(e),slotProps:{textField:{fullWidth:!0,size:"small",disabled:!s||!n}},minDate:d||void 0})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,sm:6,children:(0,N.jsx)(k.A,{label:"End Time",value:u,onChange:e=>{if(!e||!u)return;const t=new Date(u);t.setHours(e.getHours(),e.getMinutes()),A(t)},slotProps:{textField:{fullWidth:!0,size:"small",disabled:!s||!n}}})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsxs)(g.A,{fullWidth:!0,size:"small",disabled:U||!D||!d||!u,children:[(0,N.jsx)(b.A,{id:"resource-select-label",children:"Kennel/Suite Selection"}),(0,N.jsxs)(f.A,{labelId:"resource-select-label",id:"resource-select",value:P,label:"Kennel/Suite Selection",onChange:e=>R(e.target.value),endAdornment:U?(0,N.jsx)(h.A,{size:20,sx:{mr:2}}):null,children:[(0,N.jsx)(C.A,{value:"",children:(0,N.jsx)("em",{children:"Auto-assign kennel"})}),I.map(e=>(0,N.jsxs)(C.A,{value:e.id,children:[e.name," - ",e.type.replace("_"," ")]},e.id))]})]})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:3,label:"Reservation Notes",value:E,onChange:e=>F(e.target.value),size:"small",disabled:!s||!n})})]})]}),(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:(0,N.jsx)(x.A,{variant:"contained",color:"primary",onClick:()=>{if(!d||!u||!D)return void H("Please fill in all required fields");if(d>=u)return void H("Start date must be before end date");const e=v.find(e=>e.id===D),s={startDate:d,endDate:u,serviceId:D,resourceId:P||void 0,notes:E,status:"CONFIRMED",price:e?e.price:0};t(s)},disabled:!s||!n||!D||!d||!u,children:"Continue to Add-Ons"})})]})})};var B=s(1320),M=s(15769),U=s(69780),V=s(9213),_=s(21671),H=s(34075),L=s(25333),$=s(99532),G=s(98523),K=s(57988);const Y=e=>{let{onContinue:t,initialAddOns:s,serviceId:n,reservationDates:a}=e;const[d,c]=(0,i.useState)([]),[u,A]=(0,i.useState)(!1),[p,v]=(0,i.useState)(null),[j,y]=(0,i.useState)(s||[]),[g,b]=(0,i.useState)(0),[f,C]=(0,i.useState)(0);(0,i.useEffect)(()=>{n&&(async()=>{try{A(!0),v(null);const e=await q.V.getServiceById(n);null!==e&&void 0!==e&&e.data&&b(e.data.price);const t=await q.V.getServiceAddOns(n);if(t&&t.data&&(c(t.data),s&&s.length>0)){const e=s.filter(e=>t.data.some(t=>t.id===e.serviceId));y(e)}}catch(e){console.error("Error loading add-on services:",e),v("Failed to load add-on services. Please try again.")}finally{A(!1)}})()},[n,s]),(0,i.useEffect)(()=>{let e=1;if(a.startDate&&a.endDate){const t=a.endDate.getTime()-a.startDate.getTime();e=Math.ceil(t/864e5)||1}const t=g*e,s=j.reduce((e,t)=>e+t.price*t.quantity,0);C(t+s)},[j,g,a.startDate,a.endDate]);const D=(e,t)=>{if(t<1){const t=j.filter((t,s)=>s!==e);y(t)}else{const s=[...j];s[e].quantity=t,y(s)}},S=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Add-On Services"}),p&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:2},children:p}),(0,N.jsxs)(o.A,{elevation:2,sx:{p:3,mb:3},children:[(0,N.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Add-Ons"}),u?(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",py:3},children:(0,N.jsx)(h.A,{})}):(0,N.jsx)(B.A,{children:(0,N.jsxs)(M.A,{size:"small",children:[(0,N.jsx)(U.A,{children:(0,N.jsxs)(V.A,{children:[(0,N.jsx)(_.A,{children:"Service"}),(0,N.jsx)(_.A,{children:"Description"}),(0,N.jsx)(_.A,{align:"right",children:"Price"}),(0,N.jsx)(_.A,{align:"center",children:"Add"})]})}),(0,N.jsx)(H.A,{children:0===d.length?(0,N.jsx)(V.A,{children:(0,N.jsx)(_.A,{colSpan:4,children:(0,N.jsx)(l.A,{variant:"body2",align:"center",sx:{py:2},children:"No add-on services available"})})}):d.map(e=>(0,N.jsxs)(V.A,{hover:!0,children:[(0,N.jsx)(_.A,{children:e.name}),(0,N.jsx)(_.A,{children:e.description||"No description"}),(0,N.jsx)(_.A,{align:"right",children:S(e.price)}),(0,N.jsx)(_.A,{align:"center",children:(0,N.jsx)(L.A,{size:"small",color:"primary",onClick:()=>(e=>{const t=j.findIndex(t=>t.serviceId===e.id);if(t>=0){const e=[...j];e[t].quantity+=1,y(e)}else y([...j,{serviceId:e.id,name:e.name,quantity:1,price:e.price}])})(e),children:(0,N.jsx)($.A,{fontSize:"small"})})})]},e.id))})]})})]}),(0,N.jsxs)(o.A,{elevation:2,sx:{p:3,mb:3},children:[(0,N.jsx)(l.A,{variant:"subtitle1",gutterBottom:!0,children:"Selected Add-Ons"}),(0,N.jsx)(B.A,{children:(0,N.jsxs)(M.A,{size:"small",children:[(0,N.jsx)(U.A,{children:(0,N.jsxs)(V.A,{children:[(0,N.jsx)(_.A,{children:"Service"}),(0,N.jsx)(_.A,{align:"right",children:"Price"}),(0,N.jsx)(_.A,{align:"center",children:"Quantity"}),(0,N.jsx)(_.A,{align:"right",children:"Total"}),(0,N.jsx)(_.A,{align:"center",children:"Remove"})]})}),(0,N.jsx)(H.A,{children:0===j.length?(0,N.jsx)(V.A,{children:(0,N.jsx)(_.A,{colSpan:5,children:(0,N.jsx)(l.A,{variant:"body2",align:"center",sx:{py:2},children:"No add-on services selected"})})}):j.map((e,t)=>(0,N.jsxs)(V.A,{hover:!0,children:[(0,N.jsx)(_.A,{children:e.name}),(0,N.jsx)(_.A,{align:"right",children:S(e.price)}),(0,N.jsx)(_.A,{align:"center",children:(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,N.jsx)(L.A,{size:"small",onClick:()=>D(t,e.quantity-1),children:(0,N.jsx)(G.A,{fontSize:"small"})}),(0,N.jsx)(l.A,{sx:{mx:1},children:e.quantity}),(0,N.jsx)(L.A,{size:"small",onClick:()=>D(t,e.quantity+1),children:(0,N.jsx)($.A,{fontSize:"small"})})]})}),(0,N.jsx)(_.A,{align:"right",children:S(e.price*e.quantity)}),(0,N.jsx)(_.A,{align:"center",children:(0,N.jsx)(L.A,{size:"small",color:"error",onClick:()=>(e=>{const t=j.filter((t,s)=>s!==e);y(t)})(t),children:(0,N.jsx)(K.A,{fontSize:"small"})})})]},t))})]})}),(0,N.jsx)(r.A,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:(0,N.jsxs)(l.A,{variant:"subtitle1",children:["Base Service: ",S(g),a.startDate&&a.endDate&&" \xd7 ".concat(Math.ceil((a.endDate.getTime()-a.startDate.getTime())/864e5)||1," day(s)")]})}),(0,N.jsx)(r.A,{sx:{mt:1,display:"flex",justifyContent:"flex-end"},children:(0,N.jsxs)(l.A,{variant:"h6",children:["Subtotal: ",S(f)]})})]}),(0,N.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[(0,N.jsx)(x.A,{variant:"outlined",color:"secondary",onClick:()=>t([],0),children:"Skip Add-Ons"}),(0,N.jsx)(x.A,{variant:"contained",color:"primary",onClick:()=>{t(j,f)},children:"Continue to Review"})]})]})};var Q=s(74745);const X=e=>{var t,s,a,d,c,u,m;let{onContinue:h,orderData:A}=e;const[v,y]=(0,i.useState)(A.invoice.notes),[g,b]=(0,i.useState)(A.invoice.discount),f=A.invoice.subtotal,C=A.invoice.taxRate,D=f*C,S=f+D-g,I=e=>e?new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e):"N/A",w=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Review Invoice"}),(0,N.jsx)(o.A,{elevation:2,sx:{p:3,mb:3},children:(0,N.jsxs)(p.Ay,{container:!0,spacing:2,children:[(0,N.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:"Customer Information:"}),(0,N.jsxs)(l.A,{variant:"body2",children:[null===(t=A.customer)||void 0===t?void 0:t.firstName," ",null===(s=A.customer)||void 0===s?void 0:s.lastName]}),(0,N.jsx)(l.A,{variant:"body2",children:null===(a=A.customer)||void 0===a?void 0:a.email}),(0,N.jsx)(l.A,{variant:"body2",children:(null===(d=A.customer)||void 0===d?void 0:d.phone)||"No phone provided"})]}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:"Pet Information:"}),(0,N.jsxs)(l.A,{variant:"body2",children:[null===(c=A.pet)||void 0===c?void 0:c.name," (",null===(u=A.pet)||void 0===u?void 0:u.type,")"]}),(null===(m=A.pet)||void 0===m?void 0:m.breed)&&(0,N.jsxs)(l.A,{variant:"body2",children:["Breed: ",A.pet.breed]})]}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(Q.A,{sx:{my:2}})}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:"Reservation Details:"}),(0,N.jsxs)(l.A,{variant:"body2",children:["Start: ",I(A.reservation.startDate)]}),(0,N.jsxs)(l.A,{variant:"body2",children:["End: ",I(A.reservation.endDate)]})]}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:"Invoice Information:"}),(0,N.jsxs)(l.A,{variant:"body2",children:["Invoice #: ",A.invoice.invoiceNumber]}),(0,N.jsxs)(l.A,{variant:"body2",children:["Date: ",I(new Date)]})]}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(Q.A,{sx:{my:2}})}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,N.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,children:"Service Details:"}),(0,N.jsx)(B.A,{children:(0,N.jsxs)(M.A,{size:"small",children:[(0,N.jsx)(U.A,{children:(0,N.jsxs)(V.A,{children:[(0,N.jsx)(_.A,{children:"Description"}),(0,N.jsx)(_.A,{align:"right",children:"Quantity"}),(0,N.jsx)(_.A,{align:"right",children:"Unit Price"}),(0,N.jsx)(_.A,{align:"right",children:"Total"})]})}),(0,N.jsxs)(H.A,{children:[(0,N.jsxs)(V.A,{children:[(0,N.jsx)(_.A,{children:"Reservation Service"}),(0,N.jsx)(_.A,{align:"right",children:"1"}),(0,N.jsx)(_.A,{align:"right",children:w(f-A.addOns.reduce((e,t)=>e+t.price*t.quantity,0))}),(0,N.jsx)(_.A,{align:"right",children:w(f-A.addOns.reduce((e,t)=>e+t.price*t.quantity,0))})]}),A.addOns.map((e,t)=>(0,N.jsxs)(V.A,{children:[(0,N.jsx)(_.A,{children:e.name}),(0,N.jsx)(_.A,{align:"right",children:e.quantity}),(0,N.jsx)(_.A,{align:"right",children:w(e.price)}),(0,N.jsx)(_.A,{align:"right",children:w(e.price*e.quantity)})]},t))]})]})})]}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(Q.A,{sx:{my:2}})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300},children:[(0,N.jsx)(l.A,{variant:"subtitle2",children:"Subtotal:"}),(0,N.jsx)(l.A,{variant:"body1",sx:{ml:"auto"},children:w(f)})]}),(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300},children:[(0,N.jsxs)(l.A,{variant:"subtitle2",children:["Tax (",(100*C).toFixed(1),"%):"]}),(0,N.jsx)(l.A,{variant:"body1",sx:{ml:"auto"},children:w(D)})]}),(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300,mb:1},children:[(0,N.jsx)(l.A,{variant:"subtitle2",color:g>0?"error":"text.primary",fontWeight:g>0?"bold":"normal",children:"Discount:"}),(0,N.jsx)(j.A,{size:"small",type:"number",InputProps:{startAdornment:"$",sx:{color:g>0?"error.main":"inherit"}},value:g,onChange:e=>{const t=parseFloat(e.target.value)||0;b(t)},sx:{width:100,ml:"auto","& .MuiOutlinedInput-root":{borderColor:g>0?"error.main":"inherit"}}})]}),g>0&&(0,N.jsx)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300,mb:1},children:(0,N.jsxs)(l.A,{variant:"caption",color:"text.secondary",children:["Discounted subtotal: ",w(f-g)]})}),(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300,mt:1},children:[(0,N.jsx)(l.A,{variant:"h6",children:"Total:"}),(0,N.jsx)(l.A,{variant:"h6",sx:{ml:"auto"},children:w(S)})]}),A.invoice.depositRequired&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300,mt:2,pt:2,borderTop:"2px dashed #ccc"},children:[(0,N.jsx)(l.A,{variant:"subtitle2",color:"primary",children:"Deposit Required:"}),(0,N.jsx)(l.A,{variant:"subtitle2",color:"primary",sx:{ml:"auto"},children:w(A.invoice.depositAmount)})]}),(0,N.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%",maxWidth:300},children:[(0,N.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Balance Due at Checkout:"}),(0,N.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{ml:"auto"},children:w(A.invoice.balanceDue)})]})]})]})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:3,label:"Invoice Notes",value:v,onChange:e=>y(e.target.value),size:"small",sx:{mt:2}})})]})}),(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:(0,N.jsx)(x.A,{variant:"contained",color:"primary",onClick:()=>{const e=(0,n.A)((0,n.A)({},A.invoice),{},{notes:v,discount:g,taxAmount:D,total:S});h(e)},children:"Continue to Payment"})})]})};var Z=s(71812);const J=e=>{let{onContinue:t,amount:s,invoiceId:a,depositRequired:d=!1,depositAmount:c=0,totalAmount:u=0,initialPayment:A}=e;const[v,D]=(0,i.useState)(d?"deposit":"full"),[S,I]=(0,i.useState)(A.method||"CASH"),[P,R]=(0,i.useState)(""),[E,T]=(0,i.useState)(""),[k,O]=(0,i.useState)(""),[z,q]=(0,i.useState)(""),[W,F]=(0,i.useState)(""),[B,M]=(0,i.useState)(0),[U,V]=(0,i.useState)(!1),[_,H]=(0,i.useState)(0),[L,$]=(0,i.useState)(!1),[G,K]=(0,i.useState)(null),[Y,X]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{if(a){const e=await Z.p.getInvoiceById(a);if(null!==e&&void 0!==e&&e.customerId){const t=await w.m.getCustomerById(e.customerId);null!==t&&void 0!==t&&t.storeCredit&&M(t.storeCredit)}}}catch(G){console.error("Failed to load store credit:",G),M(0)}})()},[a]);const J=Math.max(0,Math.round(100*(s-_))/100),ee=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Payment Processing"}),G&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:2},children:G}),Y&&(0,N.jsx)(m.A,{severity:"success",sx:{mb:2},children:"Payment processed successfully!"}),(0,N.jsx)(o.A,{elevation:2,sx:{p:3,mb:3},children:(0,N.jsxs)(p.Ay,{container:!0,spacing:3,children:[(0,N.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,N.jsxs)(l.A,{variant:"h6",gutterBottom:!0,children:["Invoice Total: ",ee(u||s)]}),d&&(0,N.jsxs)(r.A,{sx:{mt:2,p:2,bgcolor:"primary.light",borderRadius:1},children:[(0,N.jsxs)(l.A,{variant:"subtitle2",color:"primary.contrastText",gutterBottom:!0,children:["Deposit Required: ",ee(c)]}),(0,N.jsxs)(l.A,{variant:"body2",color:"primary.contrastText",children:["Balance Due at Checkout: ",ee((u||s)-c)]})]})]}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,N.jsx)(Q.A,{sx:{my:1}}),(0,N.jsx)(l.A,{variant:"subtitle2",gutterBottom:!0,sx:{mt:2},children:"Payment Option:"}),(0,N.jsx)(g.A,{component:"fieldset",children:(0,N.jsxs)(r.A,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[d&&(0,N.jsxs)(x.A,{variant:"deposit"===v?"contained":"outlined",onClick:()=>D("deposit"),sx:{minWidth:150},children:["Pay Deposit (",ee(c),")"]}),(0,N.jsxs)(x.A,{variant:"full"===v?"contained":"outlined",onClick:()=>D("full"),sx:{minWidth:150},children:["Pay in Full (",ee(u||s),")"]}),!d&&(0,N.jsx)(x.A,{variant:"skip"===v?"contained":"outlined",color:"secondary",onClick:()=>D("skip"),sx:{minWidth:150},children:"Skip Payment"})]})})]}),"skip"!==v&&(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsxs)(l.A,{variant:"h6",color:"primary",children:["Amount to Pay Now: ",ee("deposit"===v?c:u||s)]})}),"skip"===v&&(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(m.A,{severity:"info",children:"No payment will be processed. The reservation will be created with a pending invoice."})}),B>0&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,N.jsx)(Q.A,{}),(0,N.jsxs)(r.A,{sx:{mt:2,display:"flex",alignItems:"center"},children:[(0,N.jsxs)(l.A,{variant:"subtitle2",children:["Available Store Credit: ",ee(B)]}),(0,N.jsx)(r.A,{sx:{ml:2},children:(0,N.jsx)(g.A,{sx:{width:200},children:(0,N.jsx)(j.A,{label:"Apply Store Credit",type:"number",value:U?_:0,onChange:e=>{const t=Math.min(Math.max(0,parseFloat(e.target.value)||0),B,s);H(t)},InputProps:{startAdornment:"$",inputProps:{min:0,max:Math.min(B,s),step:.01}},disabled:!U,size:"small"})})})]})]}),(0,N.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,N.jsx)(Q.A,{}),(0,N.jsxs)(l.A,{variant:"h6",sx:{mt:2},children:["Remaining to Pay: ",ee(J)]})]})]}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsxs)(g.A,{fullWidth:!0,size:"small",children:[(0,N.jsx)(b.A,{id:"payment-method-label",children:"Payment Method"}),(0,N.jsxs)(f.A,{labelId:"payment-method-label",id:"payment-method",value:S,label:"Payment Method",onChange:e=>I(e.target.value),children:[(0,N.jsx)(C.A,{value:"CREDIT_CARD",children:"Credit Card"}),(0,N.jsx)(C.A,{value:"CASH",children:"Cash"}),(0,N.jsx)(C.A,{value:"CHECK",children:"Check"})]})]})}),"CREDIT_CARD"===S&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,label:"Card Number",value:P,onChange:e=>R(e.target.value),placeholder:"1234 5678 9012 3456",inputProps:{maxLength:19},size:"small"})}),(0,N.jsx)(p.Ay,{item:!0,xs:6,children:(0,N.jsx)(j.A,{fullWidth:!0,label:"Expiry Date",value:E,onChange:e=>T(e.target.value),placeholder:"MM/YY",inputProps:{maxLength:5},size:"small"})}),(0,N.jsx)(p.Ay,{item:!0,xs:6,children:(0,N.jsx)(j.A,{fullWidth:!0,label:"CVV",value:k,onChange:e=>O(e.target.value),placeholder:"123",inputProps:{maxLength:4},size:"small"})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,label:"Name on Card",value:z,onChange:e=>q(e.target.value),size:"small"})})]}),("CASH"===S||"CHECK"===S)&&(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,label:"Payment Amount",type:"number",value:J,InputProps:{startAdornment:(0,N.jsx)(y.A,{position:"start",children:"$"}),inputProps:{min:0,step:.01}},size:"small",disabled:!0})}),(0,N.jsx)(p.Ay,{item:!0,xs:12,children:(0,N.jsx)(j.A,{fullWidth:!0,multiline:!0,rows:2,label:"Payment Notes",value:W,onChange:e=>F(e.target.value),size:"small"})})]})}),(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:3},children:"skip"===v?(0,N.jsx)(x.A,{variant:"contained",color:"primary",onClick:()=>{t({method:"NONE",amount:0,status:"PENDING",notes:"Payment skipped - no deposit required"})},children:"Complete Reservation"}):(0,N.jsx)(x.A,{variant:"contained",color:"primary",onClick:async()=>{if("CREDIT_CARD"===S){if(!P||!E||!k||!z)return void K("Please fill in all credit card details");if(!/^\d{16}$/.test(P.replace(/\s/g,"")))return void K("Card number should be 16 digits");if(!/^\d{2}\/\d{2}$/.test(E))return void K("Expiry date should be in format MM/YY");if(!/^\d{3,4}$/.test(k))return void K("CVV should be 3 or 4 digits")}try{$(!0),K(null);const e={invoiceId:a,amount:Math.round(100*J)/100,method:S,status:"PAID",transactionId:"SIMULATED-".concat(Date.now()),notes:W};if(U&&_>0&&(e.storeCredit=_),"CREDIT_CARD"===S){const t=P.replace(/\s/g,"").slice(-4);e.notes+=" | Card ending in ".concat(t),e.cardLastFour=t}await new Promise(e=>setTimeout(e,1e3)),X(!0),t((0,n.A)((0,n.A)({},e),{},{storeCredit:U?_:0,cardDetails:"CREDIT_CARD"===S?{cardNumber:P,expiryDate:E,cvv:k,cardholderName:z}:void 0}))}catch(i){var e,s;console.error("Error processing payment:",i),K((null===(e=i.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to process payment. Please try again.")}finally{$(!1)}},disabled:L||Y,children:L?(0,N.jsx)(h.A,{size:24}):"Process Payment (".concat(ee("deposit"===v?c:u||s),")")})})]})};var ee=s(69179),te=s(45295),se=s(41084);const ne=["Customer Information","Reservation Details","Add-On Services","Review Invoice","Process Payment"],ie=()=>{var e;const t=(0,R.Zp)(),[s,p]=(0,i.useState)(0),[v,j]=(0,i.useState)(!1),[y,g]=(0,i.useState)(null),[b,f]=(0,i.useState)(!1),[C,D]=(0,i.useState)(null),[S,I]=(0,i.useState)(null),[w,P]=(0,i.useState)({open:!1,message:"",severity:"success"}),[T,k]=(0,i.useState)({customer:null,pets:[],reservation:{startDate:null,endDate:null,serviceId:"",resourceId:"",status:"PENDING",notes:""},addOns:[],invoice:{invoiceNumber:"INV-".concat(Date.now()),subtotal:0,taxRate:.0744,taxAmount:0,discount:0,total:0,depositAmount:0,depositRequired:!1,balanceDue:0,notes:""},payment:{method:"CREDIT_CARD",amount:0}}),O=()=>{p(e=>e+1)},z=()=>{P((0,n.A)((0,n.A)({},w),{},{open:!1}))},q=(e,t)=>{k((0,n.A)((0,n.A)({},T),{},{customer:e,pets:t})),O()},W=async e=>{try{j(!0);let s=e.price||0;const i=.0744;let a=0;if(e.serviceId&&e.startDate&&e.endDate)try{const t={serviceId:e.serviceId,startDate:new Date(e.startDate).toISOString(),endDate:new Date(e.endDate).toISOString(),petCount:1},s=await se.A.calculatePrice(t);if(s&&s.data&&s.data.appliedRules&&s.data.appliedRules.length>0){const e=s.data.basePrice;a=e-s.data.finalPrice}}catch(t){console.error("Error calculating price rules:",t)}const r=(s-a)*i,l=s-a+r;let o=0,d=!1;if(e.service&&(d=e.service.depositRequired||!1,d)){const t=e.service.depositType,s=e.service.depositAmount||0;"PERCENTAGE"===t?o=l*s/100:"FIXED_AMOUNT"===t&&(o=s)}const c=l-o;k((0,n.A)((0,n.A)({},T),{},{reservation:e,invoice:(0,n.A)((0,n.A)({},T.invoice),{},{subtotal:s,taxRate:i,taxAmount:r,discount:a,total:l,depositAmount:o,depositRequired:d,balanceDue:c}),payment:(0,n.A)((0,n.A)({},T.payment),{},{amount:d?o:l})})),O()}catch(y){console.error("Error in handleReservationUpdate:",y),g("Failed to process reservation details")}finally{j(!1)}},B=e=>{const t=e.reduce((e,t)=>e+t.price*t.quantity,0),s=(T.reservation.price||0)+t,i=s*T.invoice.taxRate,a=s+i-(T.invoice.discount||0);k((0,n.A)((0,n.A)({},T),{},{addOns:e,invoice:(0,n.A)((0,n.A)({},T.invoice),{},{subtotal:s,taxAmount:i,total:a}),payment:(0,n.A)((0,n.A)({},T.payment),{},{amount:a})})),O()},M=e=>{k((0,n.A)((0,n.A)({},T),{},{invoice:(0,n.A)((0,n.A)({},T.invoice),e),payment:(0,n.A)((0,n.A)({},T.payment),{},{amount:e.total})})),O()},U=e=>{k((0,n.A)((0,n.A)({},T),{},{payment:(0,n.A)((0,n.A)({},T.payment),e)})),V()},V=async()=>{try{if(j(!0),g(null),!T.customer||0===T.pets.length)throw new Error("Customer and at least one pet are required");const e=[],t=T.pets.length>1,s=T.reservation.resourceId&&""!==T.reservation.resourceId;for(let o=0;o<T.pets.length;o++){const n=T.pets[o],i={customerId:T.customer.id,petId:n.id,serviceId:T.reservation.serviceId,startDate:T.reservation.startDate?new Date(T.reservation.startDate).toISOString():(new Date).toISOString(),endDate:T.reservation.endDate?new Date(T.reservation.endDate).toISOString():(new Date).toISOString(),status:T.reservation.status,notes:T.reservation.notes||""};s&&!t&&(i.resourceId=T.reservation.resourceId);const a=await ee.u.createReservation(i);e.push(a)}D(e[0].id);const n=T.addOns.reduce((e,t)=>e+t.price*t.quantity,0),i=T.invoice.subtotal-n,a={customerId:T.customer.id,reservationId:e[0].id,dueDate:new Date(Date.now()+6048e5),status:"DRAFT",subtotal:T.invoice.subtotal,taxRate:T.invoice.taxRate,taxAmount:T.invoice.taxAmount,discount:T.invoice.discount,total:T.invoice.total,notes:"".concat(T.invoice.notes).concat(T.pets.length>1?" (".concat(T.pets.length," pets: ").concat(T.pets.map(e=>e.name).join(", "),")"):""),lineItems:[...T.pets.map(e=>({description:"Reservation Service - ".concat(e.name),quantity:1,unitPrice:i/T.pets.length,amount:i/T.pets.length,taxable:!0})),...T.addOns.map(e=>({description:e.name,quantity:e.quantity,unitPrice:e.price,amount:e.price*e.quantity,taxable:!0}))]},r=await Z.p.createInvoice(a);r.id&&I(r.id);const l={invoiceId:r.id,customerId:T.customer.id,amount:T.payment.amount,method:T.payment.method,status:"PAID",transactionId:"TXID-".concat(Date.now()),notes:"Payment processed via ".concat(T.payment.method)};await te.M.createPayment(l),r.id&&await Z.p.updateInvoice(r.id,{status:"PAID"}),f(!0),P({open:!0,message:"Order processed successfully!",severity:"success"})}catch(a){var e,t,s,n,i;console.error("Error in completeOrder:",a);let r="An error occurred while processing the order";null!==(e=a.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?r=a.response.data.message:null!==(s=a.response)&&void 0!==s&&null!==(n=s.data)&&void 0!==n&&n.error?r=a.response.data.error:a.message&&(r=a.message),null!==(i=a.response)&&void 0!==i&&i.data&&console.error("Server error response:",a.response.data),g(r),P({open:!0,message:r,severity:"error"})}finally{j(!1)}};return(0,N.jsxs)(a.A,{maxWidth:"md",children:[(0,N.jsxs)(r.A,{sx:{py:4},children:[(0,N.jsx)(l.A,{variant:"h5",component:"h1",gutterBottom:!0,children:"New Order Entry"}),(0,N.jsxs)(o.A,{elevation:3,sx:{p:3,mb:3},children:[(0,N.jsx)(d.A,{activeStep:s,alternativeLabel:!0,sx:{mb:4},children:ne.map(e=>(0,N.jsx)(c.A,{children:(0,N.jsx)(u.A,{children:e})},e))}),b?(0,N.jsxs)(r.A,{children:[(0,N.jsx)(l.A,{variant:"h6",gutterBottom:!0,children:"Order completed successfully!"}),(0,N.jsx)(l.A,{variant:"body1",paragraph:!0,children:"The reservation has been created and payment has been processed."}),(0,N.jsxs)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3,gap:2},children:[(0,N.jsx)(x.A,{variant:"outlined",onClick:()=>{var e;null!==(e=T.customer)&&void 0!==e&&e.id&&t("/customers/".concat(T.customer.id))},disabled:!(null!==(e=T.customer)&&void 0!==e&&e.id),children:"View Customer"}),(0,N.jsx)(x.A,{variant:"outlined",onClick:()=>{C&&t("/reservations/".concat(C))},disabled:!C,children:"View Reservation"}),(0,N.jsx)(x.A,{variant:"contained",onClick:()=>{p(0),f(!1),D(null),I(null),k({customer:null,pets:[],reservation:{startDate:null,endDate:null,serviceId:"",resourceId:"",status:"PENDING",notes:""},addOns:[],invoice:{invoiceNumber:"INV-".concat(Date.now()),subtotal:0,taxRate:.0744,taxAmount:0,discount:0,total:0,depositAmount:0,depositRequired:!1,balanceDue:0,notes:""},payment:{method:"CREDIT_CARD",amount:0}})},children:"Create New Order"})]})]}):(0,N.jsxs)(r.A,{children:[y&&(0,N.jsx)(m.A,{severity:"error",sx:{mb:3},children:y}),(e=>{switch(e){case 0:return(0,N.jsx)(E,{onContinue:q,initialCustomer:T.customer,initialPets:T.pets});case 1:return(0,N.jsx)(F,{onContinue:W,customer:T.customer,pet:T.pets[0]||null,initialReservation:T.reservation});case 2:return(0,N.jsx)(Y,{onContinue:B,initialAddOns:T.addOns,serviceId:T.reservation.serviceId,reservationDates:{startDate:T.reservation.startDate,endDate:T.reservation.endDate}});case 3:return(0,N.jsx)(X,{onContinue:M,orderData:T});case 4:return(0,N.jsx)(J,{onContinue:U,amount:T.invoice.total,depositRequired:T.invoice.depositRequired,depositAmount:T.invoice.depositAmount,totalAmount:T.invoice.total,initialPayment:T.payment,invoiceId:S||void 0});default:return"Unknown step"}})(s),(0,N.jsxs)(r.A,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:[0!==s&&(0,N.jsx)(x.A,{disabled:v,onClick:()=>{p(e=>e-1)},sx:{mr:1},children:"Back"}),s<ne.length-1&&(0,N.jsx)(x.A,{variant:"contained",onClick:O,disabled:0===s&&(!T.customer||0===T.pets.length)||1===s&&!T.reservation.serviceId||v,children:"Next"})]}),v&&(0,N.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,N.jsx)(h.A,{})})]})]})]}),(0,N.jsx)(A.A,{open:w.open,autoHideDuration:6e3,onClose:z,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,N.jsx)(m.A,{onClose:z,severity:w.severity,sx:{width:"100%"},children:w.message})})]})}}}]);