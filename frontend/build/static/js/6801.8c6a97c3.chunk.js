"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[6801],{16801:(e,s,l)=>{l.r(s),l.d(s,{CouponManagement:()=>W,default:()=>V});var t=l(89379),n=l(9950),i=l(78317),a=l(82053),o=l(10226),r=l(65429),d=l(1320),c=l(2235),u=l(15769),m=l(69780),A=l(9213),h=l(21671),x=l(34075),p=l(83274),j=l(25333),C=l(25277),v=l(96583),y=l(40033),g=l(28170),f=l(60899),U=l(8145),E=l(23266),b=l(16497),P=l(93038),T=l(79739),w=l(53256),D=l(49939),S=l(20760),I=l(40379),N=l(99061),k=l(81298),F=l(44414);const W=()=>{const[e,s]=(0,n.useState)([]),[l,W]=(0,n.useState)(!0),[V,M]=(0,n.useState)(!1),[R,O]=(0,n.useState)(null),[z,G]=(0,n.useState)({type:"PERCENTAGE",discountValue:10,maxUsesPerCustomer:1}),[L,q]=(0,n.useState)(null),[Y,X]=(0,n.useState)(null);(0,n.useEffect)(()=>{$()},[]);const $=async()=>{try{W(!0);const e=await N.U.getAllCoupons();s(e.data)}catch(e){q("Failed to load coupons")}finally{W(!1)}},_=e=>{e?(O(e),G({code:e.code,description:e.description,type:e.type,discountValue:e.discountValue,minimumPurchase:e.minimumPurchase,firstTimeCustomersOnly:e.firstTimeCustomersOnly,validFrom:e.validFrom,validUntil:e.validUntil,maxTotalUses:e.maxTotalUses,maxUsesPerCustomer:e.maxUsesPerCustomer,notes:e.notes})):(O(null),G({type:"PERCENTAGE",discountValue:10,maxUsesPerCustomer:1})),M(!0)},B=()=>{M(!1),O(null),G({}),q(null)},H=e=>"EXPIRED"===e.status||N.U.isCouponExpired(e)?"error":"DEPLETED"===e.status||N.U.isCouponDepleted(e)?"warning":"INACTIVE"===e.status?"default":"success",J=e=>N.U.isCouponExpired(e)?"EXPIRED":N.U.isCouponDepleted(e)?"DEPLETED":N.U.isCouponNotYetValid(e)?"NOT YET VALID":e.status;return(0,F.jsxs)(i.A,{children:[(0,F.jsxs)(i.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,F.jsx)(a.A,{variant:"h4",component:"h1",children:"Coupon Management"}),(0,F.jsx)(o.A,{variant:"contained",startIcon:(0,F.jsx)(w.A,{}),onClick:()=>_(),children:"Create Coupon"})]}),L&&(0,F.jsx)(r.A,{severity:"error",onClose:()=>q(null),sx:{mb:2},children:L}),Y&&(0,F.jsx)(r.A,{severity:"success",onClose:()=>X(null),sx:{mb:2},children:Y}),(0,F.jsx)(d.A,{component:c.A,children:(0,F.jsxs)(u.A,{children:[(0,F.jsx)(m.A,{children:(0,F.jsxs)(A.A,{children:[(0,F.jsx)(h.A,{children:"Code"}),(0,F.jsx)(h.A,{children:"Description"}),(0,F.jsx)(h.A,{children:"Discount"}),(0,F.jsx)(h.A,{children:"Valid Period"}),(0,F.jsx)(h.A,{children:"Usage"}),(0,F.jsx)(h.A,{children:"Status"}),(0,F.jsx)(h.A,{align:"right",children:"Actions"})]})}),(0,F.jsx)(x.A,{children:e.map(e=>(0,F.jsxs)(A.A,{children:[(0,F.jsx)(h.A,{children:(0,F.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,F.jsx)(a.A,{variant:"body2",fontWeight:"bold",children:e.code}),(0,F.jsx)(p.A,{title:"Copy code",children:(0,F.jsx)(j.A,{size:"small",onClick:()=>{return s=e.code,navigator.clipboard.writeText(s),void X('Copied "'.concat(s,'" to clipboard'));var s},children:(0,F.jsx)(D.A,{fontSize:"small"})})})]})}),(0,F.jsx)(h.A,{children:e.description}),(0,F.jsxs)(h.A,{children:[N.U.formatCouponDiscount(e),e.minimumPurchase&&(0,F.jsxs)(a.A,{variant:"caption",display:"block",color:"text.secondary",children:["Min: $",e.minimumPurchase]})]}),(0,F.jsxs)(h.A,{children:[(0,F.jsx)(a.A,{variant:"body2",children:(0,k.Yq)("string"===typeof e.validFrom?e.validFrom:e.validFrom.toISOString())}),(0,F.jsxs)(a.A,{variant:"body2",children:["to ",(0,k.Yq)("string"===typeof e.validUntil?e.validUntil:e.validUntil.toISOString())]})]}),(0,F.jsxs)(h.A,{children:[e.currentUses,e.maxTotalUses&&" / ".concat(e.maxTotalUses)]}),(0,F.jsx)(h.A,{children:(0,F.jsx)(C.A,{label:J(e),color:H(e),size:"small"})}),(0,F.jsxs)(h.A,{align:"right",children:[(0,F.jsx)(j.A,{size:"small",onClick:()=>_(e),title:"Edit",children:(0,F.jsx)(I.A,{fontSize:"small"})}),(0,F.jsx)(j.A,{size:"small",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this coupon?"))try{await N.U.deleteCoupon(e),X("Coupon deleted successfully"),$()}catch(s){q("Failed to delete coupon")}})(e.id),title:"Delete",children:(0,F.jsx)(S.A,{fontSize:"small"})})]})]},e.id))})]})}),(0,F.jsxs)(v.A,{open:V,onClose:B,maxWidth:"md",fullWidth:!0,children:[(0,F.jsx)(y.A,{children:R?"Edit Coupon":"Create New Coupon"}),(0,F.jsx)(g.A,{children:(0,F.jsxs)(f.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,label:"Coupon Code *",value:z.code||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{code:e.target.value.toUpperCase()})),placeholder:"SUMMER2025",helperText:"Unique code customers will enter"})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsxs)(U.A,{fullWidth:!0,select:!0,label:"Discount Type *",value:z.type||"PERCENTAGE",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{type:e.target.value})),children:[(0,F.jsx)(E.A,{value:"PERCENTAGE",children:"Percentage"}),(0,F.jsx)(E.A,{value:"FIXED_AMOUNT",children:"Fixed Amount"})]})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,children:(0,F.jsx)(U.A,{fullWidth:!0,label:"Description *",value:z.description||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{description:e.target.value})),placeholder:"Summer 2025 promotion",multiline:!0,rows:2})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"number",label:"PERCENTAGE"===z.type?"Discount Percentage *":"Discount Amount *",value:z.discountValue||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{discountValue:Number(e.target.value)})),InputProps:{endAdornment:"PERCENTAGE"===z.type?"%":"$"}})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"number",label:"Minimum Purchase",value:z.minimumPurchase||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{minimumPurchase:Number(e.target.value)||void 0})),placeholder:"0",InputProps:{startAdornment:"$"}})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"date",label:"Valid From *",value:z.validFrom||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{validFrom:e.target.value})),InputLabelProps:{shrink:!0}})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"date",label:"Valid Until *",value:z.validUntil||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{validUntil:e.target.value})),InputLabelProps:{shrink:!0}})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max Total Uses",value:z.maxTotalUses||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{maxTotalUses:Number(e.target.value)||void 0})),placeholder:"Unlimited",helperText:"Leave empty for unlimited"})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,sm:6,children:(0,F.jsx)(U.A,{fullWidth:!0,type:"number",label:"Max Uses Per Customer",value:z.maxUsesPerCustomer||1,onChange:e=>G((0,t.A)((0,t.A)({},z),{},{maxUsesPerCustomer:Number(e.target.value)}))})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,children:(0,F.jsx)(b.A,{control:(0,F.jsx)(P.A,{checked:z.firstTimeCustomersOnly||!1,onChange:e=>G((0,t.A)((0,t.A)({},z),{},{firstTimeCustomersOnly:e.target.checked}))}),label:"First-time customers only"})}),(0,F.jsx)(f.Ay,{item:!0,xs:12,children:(0,F.jsx)(U.A,{fullWidth:!0,label:"Notes",value:z.notes||"",onChange:e=>G((0,t.A)((0,t.A)({},z),{},{notes:e.target.value})),multiline:!0,rows:2,placeholder:"Internal notes about this coupon"})})]})}),(0,F.jsxs)(T.A,{children:[(0,F.jsx)(o.A,{onClick:B,children:"Cancel"}),(0,F.jsx)(o.A,{onClick:async()=>{try{if(q(null),!z.code||!z.description||!z.validFrom||!z.validUntil)return void q("Please fill in all required fields");R?(await N.U.updateCoupon(R.id,z),X("Coupon updated successfully")):(await N.U.createCoupon(z),X("Coupon created successfully")),B(),$()}catch(l){var e,s;q((null===(e=l.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to save coupon")}},variant:"contained",children:R?"Update":"Create"})]})]})]})},V=W}}]);