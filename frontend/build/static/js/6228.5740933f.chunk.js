"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[6228],{96228:(e,t,a)=>{a.r(t),a.d(t,{default:()=>X});var n=a(9950),r=a(62999),s=a(78317),l=a(82053),i=a(65429),o=a(96583),c=a(40033),d=a(28170),u=a(69179),h=a(82932),v=a(89379),x=a(92383),m=a(54060);const y=e=>{let{currentDate:t,getDaysToDisplay:a,kennelTypeFilter:r}=e;const[s,l]=(0,n.useState)([]),[i,o]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0),[u,y]=(0,n.useState)(null),[g,p]=(0,n.useState)(null),[A,f]=(0,n.useState)(!1),[D,b]=(0,n.useState)(null),k=(0,n.useCallback)(async()=>{try{d(!0),y(null);try{var e,n,r;const t=await x.c.getAllResources(1,1e3,"name","asc","suite");let s=[];if("success"!==(null===t||void 0===t?void 0:t.status)||!Array.isArray(null===t||void 0===t?void 0:t.data))return console.error("Could not find suite resources in response"),y("Failed to load kennels: Could not find suite resources"),void d(!1);s=t.data;const i=a(),o=(0,m.$T)(i[0]),c=(0,m.$T)(i[i.length-1]),u=s.map(e=>e.id);let g={};g=u.length>0?await h.Nl.post("/api/resources/availability/batch",{resourceIds:u,startDate:o,endDate:c}):{data:{resources:[],checkStartDate:o,checkEndDate:c}};const p={},A=(null===(e=g)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data)||(null===(r=g)||void 0===r?void 0:r.data),f={};null!==A&&void 0!==A&&A.resources&&Array.isArray(A.resources)?A.resources.forEach(e=>{p[e.resourceId]=e.isAvailable,f[e.resourceId]=e.occupyingReservations||[]}):console.warn("Could not process availability data, assuming all available");const D=s.map(e=>(0,v.A)((0,v.A)({},e),{},{isAvailable:!1!==p[e.id],occupyingReservations:f[e.id]||[],checkDate:o})),b=(j=D,[...j].sort((e,t)=>{const a=e.name||"",n=t.name||"",r=a.match(/^([A-Z])(\d+)$/),s=n.match(/^([A-Z])(\d+)$/);if(r&&s){const[,e,t]=r,[,a,n]=s;return e!==a?e.localeCompare(a):Number(t)-Number(n)}return a.localeCompare(n)}));return l(b),void d(!1)}catch(w){console.error("Error fetching resources:",w);try{var s,i,o,c,g,A,f,D,b;const e=await h.Nl.get("/api/resources/availability",{params:{resourceType:"suite",date:(0,m.$T)(t)}});let a=[];var k;if("success"===(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.status)){if(null!==e&&void 0!==e&&null!==(k=e.data)&&void 0!==k&&k.data&&(p(e.data.data),!a.length))try{const e=await x.c.getAllResources(1,1e3,"name","asc","suite");e&&Array.isArray(e)&&(a=e.map(e=>(0,v.A)((0,v.A)({},e),{},{isAvailable:!0,checkDate:(0,m.$T)(t)})))}catch(u){console.warn("Could not fetch suite details, using placeholder data",u)}}else if("success"===(null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.status)&&null!==e&&void 0!==e&&null!==(o=e.data)&&void 0!==o&&null!==(c=o.data)&&void 0!==c&&c.resources&&Array.isArray(null===e||void 0===e||null===(g=e.data)||void 0===g||null===(A=g.data)||void 0===A?void 0:A.resources))a=e.data.data.resources,p(e.data.data);else if(null!==e&&void 0!==e&&null!==(f=e.data)&&void 0!==f&&f.resources&&Array.isArray(null===e||void 0===e||null===(D=e.data)||void 0===D?void 0:D.resources))a=e.data.resources;else if(Array.isArray(null===e||void 0===e?void 0:e.data))a=e.data;else if(null!==e&&void 0!==e&&null!==(b=e.data)&&void 0!==b&&b.data&&"object"===typeof e.data.data)for(const t in e.data.data)if(Array.isArray(e.data.data[t])){a=e.data.data[t];break}if(0===a.length)console.warn("No kennel data found in any expected format"),y("No kennels found. Please check your resource configuration.");else{const e=function(e){return[...e].sort((e,t)=>{var a,n;const r=e.suiteNumber||(null===(a=e.name)||void 0===a?void 0:a.replace(/\D/g,""))||"0",s=t.suiteNumber||(null===(n=t.name)||void 0===n?void 0:n.replace(/\D/g,""))||"0";return Number(r)-Number(s)})}(a);l(e)}d(!1)}catch(C){console.error("Fallback API call also failed:",C),y("Failed to load kennels: ".concat(C.message||"Unknown error")),d(!1)}}}catch(u){console.error("Error in loadKennelsAndAvailability:",u),y("Failed to load kennels: ".concat(u.message||"Unknown error")),d(!1)}var j},[t,a]),j=(0,n.useCallback)(async()=>{try{var e,t,n;const r=a(),s=(0,m.$T)(r[0]),l=(0,m.$T)(r[r.length-1]),i=await h.Nl.get("/api/reservations",{params:{startDate:s,endDate:l,limit:1e3}}),c=(null===i||void 0===i||null===(e=i.data)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.reservations)||(null===i||void 0===i||null===(n=i.data)||void 0===n?void 0:n.reservations)||[];o(c)}catch(u){console.error("Error loading reservations:",u),o([])}},[a]);(0,n.useEffect)(()=>{k(),j()},[k,j]);return{kennels:s.filter(e=>{var t;if("ALL"===r)return!0;return(e.type||(null===(t=e.attributes)||void 0===t?void 0:t.suiteType)||"STANDARD_SUITE")===r}),reservations:i,loading:c,error:u,availabilityData:g,fetchingAvailability:A,availabilityError:D,refreshData:k}};var g=a(37027),p=a(83274),A=a(25333),f=a(10226),D=a(25979),b=a(19647),k=a(70006),j=a(23266),w=a(26858),C=a(68476),S=a(52946),T=a(70944),I=a(61396),E=a(43880),N=a(44414);const R=(0,n.memo)(e=>{let{currentDate:t,viewType:a,kennelTypeFilter:n,onDateChange:r,onViewTypeChange:i,onKennelTypeFilterChange:o,onTodayClick:c}=e;const{isMobile:d}=(0,g.Qs)();return(0,N.jsx)(s.A,{sx:{mb:{xs:2,md:3}},children:(0,N.jsxs)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center",justifyContent:"space-between"},children:[(0,N.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:{xs:.5,sm:1},flexShrink:0,minWidth:"fit-content"},children:[(0,N.jsx)(p.A,{title:"Previous",children:(0,N.jsx)(A.A,{onClick:()=>{const e=new Date(t);switch(a){case"day":e.setDate(e.getDate()-1);break;case"week":e.setDate(e.getDate()-7);break;case"month":e.setMonth(e.getMonth()-1)}r(e)},size:(0,g.Qz)(d),children:(0,N.jsx)(w.A,{})})}),(0,N.jsx)(l.A,{variant:d?"subtitle1":"h6",sx:{textAlign:"center",fontSize:{xs:"0.9rem",sm:"1.25rem"},whiteSpace:"nowrap"},children:(()=>{const e={year:"numeric",month:"long"};return"day"===a&&(e.day="numeric",e.weekday="long"),t.toLocaleDateString("en-US",e)})()}),(0,N.jsx)(p.A,{title:"Next",children:(0,N.jsx)(A.A,{onClick:()=>{const e=new Date(t);switch(a){case"day":e.setDate(e.getDate()+1);break;case"week":e.setDate(e.getDate()+7);break;case"month":e.setMonth(e.getMonth()+1)}r(e)},size:(0,g.Qz)(d),children:(0,N.jsx)(C.A,{})})}),(0,N.jsx)(p.A,{title:"Today",children:(0,N.jsx)(f.A,{variant:"outlined",size:"small",startIcon:(0,N.jsx)(S.A,{}),onClick:c,sx:{ml:{xs:.5,sm:2},display:{xs:"none",sm:"inline-flex"}},children:"Today"})})]}),(0,N.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:{xs:1,md:2},flexShrink:1,minWidth:"fit-content"},children:[(0,N.jsxs)(s.A,{sx:{display:"flex",gap:.5,flexShrink:0},children:[(0,N.jsx)(p.A,{title:"Month View",children:(0,N.jsx)(A.A,{onClick:()=>i("month"),color:"month"===a?"primary":"default",size:(0,g.Qz)(d),children:(0,N.jsx)(T.A,{fontSize:d?"small":"medium"})})}),(0,N.jsx)(p.A,{title:"Week View",children:(0,N.jsx)(A.A,{onClick:()=>i("week"),color:"week"===a?"primary":"default",size:(0,g.Qz)(d),children:(0,N.jsx)(I.A,{fontSize:d?"small":"medium"})})}),(0,N.jsx)(p.A,{title:"Day View",children:(0,N.jsx)(A.A,{onClick:()=>i("day"),color:"day"===a?"primary":"default",size:(0,g.Qz)(d),children:(0,N.jsx)(E.A,{fontSize:d?"small":"medium"})})})]}),(0,N.jsxs)(D.A,{size:"small",sx:{minWidth:{xs:140,sm:150},maxWidth:{xs:180,sm:200},flexShrink:1},children:[(0,N.jsx)(b.A,{children:"Kennel Type"}),(0,N.jsxs)(k.A,{value:n,label:"Kennel Type",onChange:e=>o(e.target.value),children:[(0,N.jsx)(j.A,{value:"ALL",children:"All Types"}),(0,N.jsx)(j.A,{value:"STANDARD_SUITE",children:d?"Std":"Standard"}),(0,N.jsx)(j.A,{value:"STANDARD_PLUS_SUITE",children:d?"Std+":"Standard Plus"}),(0,N.jsx)(j.A,{value:"VIP_SUITE",children:"VIP"})]})]})]})]})})});R.displayName="KennelCalendarHeader";const z=R;var L=a(46639),K=a(2235),U=a(1320),F=a(15769),W=a(69780),P=a(9213),M=a(21671),_=a(34075),H=a(25277);const O=(0,n.memo)(e=>{var t;let{kennel:a,days:n,viewType:r,onCellClick:i,isKennelOccupied:o}=e;const c=a.suiteNumber||a.name||"Kennel ".concat(a.id),d=(e=>{switch(e){case"STANDARD_SUITE":default:return{label:"Standard",color:"default"};case"STANDARD_PLUS_SUITE":return{label:"Standard+",color:"primary"};case"VIP_SUITE":return{label:"VIP",color:"secondary"}}})(a.type||(null===(t=a.attributes)||void 0===t?void 0:t.suiteType)||"STANDARD_SUITE"),u=e=>{switch(e){case"CONFIRMED":case"COMPLETED":return"#4caf50";case"CHECKED_IN":return"#2196f3";case"PENDING":return"#ff9800";case"CHECKED_OUT":return"#9c27b0";case"CANCELLED":case"NO_SHOW":return"#f44336";default:return"#9e9e9e"}},h=(e,t,a,n,r)=>{var s;let l="inherit",i="1px solid rgba(224, 224, 224, 1)";if(r){var o;l="DAYCARE"===(null===(o=r.service)||void 0===o?void 0:o.serviceCategory)?"rgba(255, 152, 0, 0.12)":"rgba(33, 150, 243, 0.12)"}else t?n&&(l="rgba(0, 0, 0, 0.04)"):l="rgba(200, 200, 200, 0.1)";return a&&(l="inherit"===l?"rgba(25, 118, 210, 0.04)":l),{backgroundColor:l,cursor:"pointer",borderBottom:i,borderLeft:a?"2px solid rgba(25, 118, 210, 0.3)":i,borderRight:a?"2px solid rgba(25, 118, 210, 0.3)":"none",p:.5,height:45,position:"relative","&:hover":{backgroundColor:e&&r?"DAYCARE"===(null===(s=r.service)||void 0===s?void 0:s.serviceCategory)?"rgba(255, 152, 0, 0.20)":"rgba(33, 150, 243, 0.20)":"rgba(0, 0, 0, 0.08)"}}};return(0,N.jsxs)(P.A,{hover:!0,children:[(0,N.jsx)(M.A,{sx:{fontWeight:"bold",backgroundColor:"background.paper",position:"sticky",left:0,zIndex:2,borderRight:"2px solid rgba(224, 224, 224, 1)"},children:(0,N.jsxs)(s.A,{children:[(0,N.jsx)(l.A,{variant:"body2",fontWeight:"bold",children:c}),(0,N.jsx)(H.A,{label:d.label,color:d.color,size:"small",sx:{mt:.5}})]})}),n.map((e,t)=>{var n;const r=o(a.id,e),c=e.toDateString()===(new Date).toDateString(),d=(a.occupyingReservations||[]).filter(t=>{const a=new Date(t.startDate),n=new Date(t.endDate),r=new Date(e);return a.setHours(0,0,0,0),n.setHours(23,59,59,999),r.setHours(12,0,0,0),r>=a&&r<=n}),v=d.length>0,x=!r.occupied&&!v,m=0===e.getDay()||6===e.getDay(),y=r.reservation||(v?d[0]:void 0);return(0,N.jsx)(M.A,{align:"center",sx:h(r.occupied,x,c,m,y),onClick:()=>i(a,e,y),children:y?(0,N.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:[(0,N.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.25},children:(0,N.jsx)(H.A,{label:y.status,size:"small",sx:{bgcolor:u(y.status),color:"white",fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}})}),(0,N.jsx)(l.A,{variant:"caption",display:"block",noWrap:!0,sx:{fontSize:"0.7rem"},children:(null===(n=y.pet)||void 0===n?void 0:n.name)||"Unknown Pet"})]}):x?(0,N.jsx)(s.A,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"text.secondary"},children:(0,N.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.65rem"},children:"\u2022"})}):(0,N.jsx)(s.A,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"text.secondary"},children:(0,N.jsx)(l.A,{variant:"caption",sx:{fontSize:"0.65rem"},children:"Unavailable"})})},t)})]})});O.displayName="KennelRow";const V=O,Y=(0,n.memo)(e=>{let{kennels:t,reservations:a,loading:r,error:o,currentDate:c,viewType:d,availabilityData:u,getDaysToDisplay:h,onCellClick:v,isKennelOccupied:x}=e;const m=h(),y=(0,n.useCallback)(e=>{switch(d){case"day":return e.toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});case"week":return e.toLocaleDateString("en-US",{weekday:"short",day:"numeric"});default:return e.getDate().toString()}},[d]);return r?(0,N.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",p:4},children:[(0,N.jsx)(L.A,{}),(0,N.jsx)(l.A,{sx:{ml:2},children:"Loading kennels..."})]}):o?(0,N.jsx)(i.A,{severity:"error",sx:{mb:2},children:o}):0===t.length?(0,N.jsx)(i.A,{severity:"info",sx:{mb:2},children:"No kennels found. Please check your filter settings or resource configuration."}):(0,N.jsxs)(K.A,{elevation:2,children:[(0,N.jsx)(U.A,{sx:{maxHeight:"calc(100vh - 300px)",overflowX:"auto"},children:(0,N.jsxs)(F.A,{stickyHeader:!0,size:"small",children:[(0,N.jsx)(W.A,{children:(0,N.jsxs)(P.A,{children:[(0,N.jsx)(M.A,{sx:{minWidth:120,fontWeight:"bold",backgroundColor:"primary.main",color:"primary.contrastText",position:"sticky",left:0,zIndex:3},children:"Kennel"}),m.map((e,t)=>{const a=new Date,n=e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear();return(0,N.jsx)(M.A,{align:"center",sx:{minWidth:"day"===d?200:100,fontWeight:"bold",backgroundColor:"primary.main",color:"primary.contrastText",borderLeft:"1px solid rgba(224, 224, 224, 1)",position:"relative","&::after":n?{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"3px",backgroundColor:"rgba(255, 255, 255, 0.5)"}:{}},children:y(e)},t)})]})}),(0,N.jsx)(_.A,{children:t.map(e=>(0,N.jsx)(V,{kennel:e,days:m,viewType:d,onCellClick:v,isKennelOccupied:x},e.id))})]})}),(0,N.jsx)(s.A,{sx:{p:2,borderTop:"1px solid rgba(224, 224, 224, 1)",backgroundColor:"grey.50"},children:(0,N.jsxs)(l.A,{variant:"body2",color:"text.secondary",children:["Showing ",t.length," kennels for ",m.length," days"]})})]})});Y.displayName="KennelGrid";const $=Y;var Q=a(92685);const G=(0,n.memo)(e=>{var t,a,n;let{selectedKennel:r,selectedDate:l,selectedReservation:i,onSubmit:o,onClose:c,error:d}=e;if(!r||!l)return(0,N.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,N.jsx)(L.A,{})});const u=i?(0,v.A)((0,v.A)({},i),{},{customerId:i.customerId,petId:i.petId,serviceId:i.serviceId,resourceId:i.resourceId||(null===(t=i.resource)||void 0===t?void 0:t.id),kennelId:i.resourceId||(null===(a=i.resource)||void 0===a?void 0:a.id)}):{suiteNumber:r.suiteNumber||"",suiteName:r.name||"",suiteType:r.type||(null===(n=r.attributes)||void 0===n?void 0:n.suiteType)||"STANDARD_SUITE",startDate:l.start,endDate:l.end,kennelId:r.id};return(0,N.jsx)(Q.A,{onSubmit:o,initialData:u,defaultDates:l,showAddOns:!0,serviceCategories:["BOARDING","DAYCARE"],onClose:c})});G.displayName="ReservationFormWrapper";const B=G,Z=e=>{let{onEventUpdate:t}=e;const{isMobile:a,isTablet:r}=(0,g.Qs)(),[l,v]=(0,n.useState)(new Date),[x,m]=(0,n.useState)("week"),[p,A]=(0,n.useState)("ALL"),[f,D]=(0,n.useState)(!1),[b,k]=(0,n.useState)(null),[j,w]=(0,n.useState)(null),[C,S]=(0,n.useState)(null),[T,I]=(0,n.useState)(null),E=(0,n.useCallback)(()=>{const e=[],t=new Date(l);switch(x){case"day":e.push(new Date(t));break;case"week":const a=new Date(t);a.setDate(t.getDate()-t.getDay());for(let t=0;t<7;t++){const n=new Date(a);n.setDate(a.getDate()+t),e.push(n)}break;case"month":new Date(t.getFullYear(),t.getMonth(),1);const n=new Date(t.getFullYear(),t.getMonth()+1,0);for(let r=1;r<=n.getDate();r++)e.push(new Date(t.getFullYear(),t.getMonth(),r))}return e},[l,x]),{kennels:R,reservations:L,loading:K,error:U,availabilityData:F,fetchingAvailability:W,availabilityError:P,refreshData:M}=y({currentDate:l,getDaysToDisplay:E,kennelTypeFilter:p}),_=(0,n.useCallback)((e,t)=>{const a=L.find(a=>{const n=new Date(a.startDate),r=new Date(a.endDate),s=new Date(t);return n.setHours(0,0,0,0),r.setHours(23,59,59,999),s.setHours(12,0,0,0),(a.resourceId===e||a.kennelId===e||a.suiteId===e)&&s>=n&&s<=r});return{occupied:!!a,reservation:a}},[L]),H=(0,n.useCallback)(async(e,t,a)=>{if(k(e),a){const e=await(async e=>{try{const a=await h.Nl.get("/api/reservations/".concat(e));var t;return"success"===a.data.status?(null===(t=a.data.data)||void 0===t?void 0:t.reservation)||a.data.data||a.data:(console.error("Failed to fetch complete reservation data:",a.data),null)}catch(U){return console.error("Error fetching complete reservation data:",U),null}})(a.id);e?S(e):(console.warn("KennelCalendar: Could not fetch complete reservation data, using incomplete data"),S(a))}else S(null);const n=new Date(t);n.setDate(t.getDate()+1),w({start:t,end:n}),I(null),D(!0)},[]),O=(0,n.useCallback)(async e=>{try{var a;let n;return I(null),C?(n=await u.u.updateReservation(C.id,e),D(!1),k(null),w(null),S(null)):n=await u.u.createReservation(e),M(),t&&n&&t(n),{reservationId:null===(a=n)||void 0===a?void 0:a.id}}catch(U){throw console.error("Error submitting reservation form:",U),I(U.message||"Failed to save reservation"),U}},[C,M,t]),V=(0,n.useCallback)(()=>{D(!1),k(null),w(null),S(null),I(null)},[]),Y=(0,n.useCallback)(()=>{v(new Date)},[]);(0,n.useEffect)(()=>{"true"===sessionStorage.getItem("refreshCalendar")&&(sessionStorage.removeItem("refreshCalendar"),setTimeout(()=>{M()},500));const e=()=>{M()},t=()=>{M()};return window.addEventListener("reservation-created",e),document.addEventListener("reservationComplete",t),()=>{window.removeEventListener("reservation-created",e),document.removeEventListener("reservationComplete",t)}},[M]);const Q=(0,n.useMemo)(()=>C?"Edit Reservation":"New Reservation - ".concat((null===b||void 0===b?void 0:b.name)||"Kennel"),[C,b]);return(0,N.jsxs)(s.A,{sx:{p:{xs:1,sm:2}},children:[(0,N.jsx)(z,{currentDate:l,viewType:x,kennelTypeFilter:p,onDateChange:v,onViewTypeChange:m,onKennelTypeFilterChange:A,onTodayClick:Y}),P&&(0,N.jsx)(i.A,{severity:"warning",sx:{mb:2},children:P}),(0,N.jsx)($,{kennels:R,reservations:L,loading:K,error:U,currentDate:l,viewType:x,availabilityData:F,getDaysToDisplay:E,onCellClick:H,isKennelOccupied:_}),(0,N.jsxs)(o.A,{open:f,onClose:V,maxWidth:!a&&"md",fullWidth:!a,fullScreen:a,PaperProps:{sx:{maxHeight:a?"100vh":"90vh",width:a?"100%":(0,g.ZP)(a,r)}},children:[(0,N.jsx)(c.A,{children:Q}),(0,N.jsxs)(d.A,{children:[T&&(0,N.jsx)(i.A,{severity:"error",sx:{mb:2},children:T}),(0,N.jsx)(B,{selectedKennel:b,selectedDate:j,selectedReservation:C,onSubmit:O,onClose:V,error:T})]})]})]})},X=()=>(0,N.jsxs)(r.A,{maxWidth:"xl",sx:{height:"calc(100vh - 64px)",py:2,display:"flex",flexDirection:"column"},children:[(0,N.jsx)(s.A,{sx:{mb:2},children:(0,N.jsx)(l.A,{variant:"h5",children:"Boarding & Daycare Calendar"})}),(0,N.jsx)(s.A,{sx:{flexGrow:1},children:(0,N.jsx)(Z,{})})]})}}]);