"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[8749],{8749:(e,s,a)=>{a.r(s),a.d(s,{default:()=>L});var r=a(9950),t=a(28429),n=a(43939),o=a(29714),i=a(78317),l=a(46639),d=a(41413),c=a(25333),m=a(82053),u=a(10226),h=a(60899),p=a(48089),x=a(50704),v=a(65429),A=a(8145),f=a(2046),j=a(74745),w=a(20760),y=a(12015),g=a(82092),P=a(50294),b=a(64987),N=a(93472),S=a(72934),C=a(68179),I=a(12714),k=a(91367),W=a(82932),q=a(44414);const z=o.Ik().shape({firstName:o.Yj().required("First name is required"),lastName:o.Yj().required("Last name is required"),email:o.Yj().email("Invalid email").required("Email is required"),phone:o.Yj()}),F=o.Ik().shape({currentPassword:o.Yj().required("Current password is required"),newPassword:o.Yj().min(8,"Password must be at least 8 characters").matches(/[a-z]/,"Password must contain at least one lowercase letter").matches(/[A-Z]/,"Password must contain at least one uppercase letter").matches(/[0-9]/,"Password must contain at least one number").matches(/[^a-zA-Z0-9]/,"Password must contain at least one special character").required("New password is required"),confirmPassword:o.Yj().oneOf([o.KR("newPassword")],"Passwords must match").required("Please confirm your password")}),L=()=>{var e,s;const{user:a,updateUser:o}=(0,k.As)(),[L,B]=((0,t.Zp)(),(0,r.useState)(!0)),[D,T]=(0,r.useState)(null),[Y,R]=(0,r.useState)(null),[E,V]=(0,r.useState)(null),[O,U]=(0,r.useState)(null),[Z,M]=(0,r.useState)(!1),[_,G]=(0,r.useState)(!1),[H,J]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(null),[X,$]=(0,r.useState)(null),[ee,se]=(0,r.useState)(null),[ae,re]=(0,r.useState)({firstName:"",lastName:"",email:"",phone:""}),te=e=>{if(e)try{const s=window.location.origin,a=e.startsWith("/")?e:"/".concat(e);return"".concat(s).concat(a)}catch(s){return void console.error("Error constructing profile photo URL:",s)}};(0,r.useEffect)(()=>{(async()=>{try{if(null!==a&&void 0!==a&&a.id){const e=await W.Ay.get("/api/staff/".concat(a.id)),s=e.data.data||e.data;if(re({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||""}),s.profilePhoto){const e=te(s.profilePhoto);Q(e||null)}o&&o({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone,isActive:s.isActive,lastLogin:s.lastLogin})}}catch(e){console.error("Error fetching profile:",e),a&&re({firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:a.phone||""})}finally{B(!1)}})()},[null===a||void 0===a?void 0:a.id]);return L?(0,q.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,q.jsx)(l.A,{})}):(0,q.jsxs)(i.A,{sx:{maxWidth:1200,mx:"auto",p:3},children:[(0,q.jsxs)(i.A,{sx:{mb:4,display:"flex",alignItems:"center",gap:3},children:[(0,q.jsxs)(i.A,{sx:{position:"relative"},children:[(0,q.jsx)(d.A,{src:ee||K||void 0,sx:{width:120,height:120,bgcolor:"primary.main",fontSize:"2.5rem",border:"4px solid",borderColor:"background.paper",boxShadow:3},children:!ee&&!K&&(0,q.jsxs)(q.Fragment,{children:[null===a||void 0===a||null===(e=a.firstName)||void 0===e?void 0:e[0],null===a||void 0===a||null===(s=a.lastName)||void 0===s?void 0:s[0]]})},K||"no-photo"),(0,q.jsx)("input",{accept:"image/*",style:{display:"none"},id:"profile-photo-upload",type:"file",onChange:e=>{var s;const a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a){if(!a.type.startsWith("image/"))return void R("Please select an image file");if(a.size>5242880)return void R("Image size must be less than 5MB");$(a);const e=new FileReader;e.onloadend=()=>{se(e.result)},e.readAsDataURL(a)}}}),(0,q.jsx)("label",{htmlFor:"profile-photo-upload",children:(0,q.jsx)(c.A,{component:"span",sx:{position:"absolute",bottom:0,right:0,bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},boxShadow:2},children:(0,q.jsx)(N.A,{})})})]}),(0,q.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,q.jsxs)(m.A,{variant:"h4",component:"h1",children:[null===a||void 0===a?void 0:a.firstName," ",null===a||void 0===a?void 0:a.lastName]}),(0,q.jsx)(m.A,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:null===a||void 0===a?void 0:a.email}),(0,q.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Manage your account settings and preferences"}),ee&&(0,q.jsxs)(i.A,{sx:{mt:2,display:"flex",gap:1},children:[(0,q.jsx)(u.A,{size:"small",variant:"contained",onClick:async()=>{if(X)try{var e;R(null);const s=new FormData;s.append("photo",X);const r=await W.Ay.post("/api/staff/".concat(null===a||void 0===a?void 0:a.id,"/photo"),s,{headers:{"Content-Type":"multipart/form-data"}}),t=(null===(e=r.data.data)||void 0===e?void 0:e.profilePhoto)||r.data.profilePhoto,n=te(t);Q(n||null),se(null),$(null),T("Profile photo updated successfully!"),o&&o({profilePhoto:t})}catch(t){var s,r;console.error("Photo upload error:",t);const e=(null===(s=t.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to upload photo";R(e)}},startIcon:(0,q.jsx)(S.A,{}),children:"Save Photo"}),(0,q.jsx)(u.A,{size:"small",variant:"outlined",onClick:()=>{se(null),$(null)},children:"Cancel"})]}),K&&!ee&&(0,q.jsx)(u.A,{size:"small",variant:"outlined",color:"error",onClick:async()=>{try{R(null),await W.Ay.delete("/api/staff/".concat(null===a||void 0===a?void 0:a.id,"/photo")),Q(null),se(null),$(null),T("Profile photo removed successfully!"),o&&o({profilePhoto:null})}catch(r){var e,s;const a=(null===(e=r.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to remove photo";R(a)}},startIcon:(0,q.jsx)(w.A,{}),sx:{mt:2},children:"Remove Photo"})]})]}),(0,q.jsxs)(h.Ay,{container:!0,spacing:3,children:[(0,q.jsx)(h.Ay,{item:!0,xs:12,md:6,children:(0,q.jsx)(p.A,{children:(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,q.jsx)(P.A,{color:"primary"}),(0,q.jsx)(m.A,{variant:"h6",children:"Profile Information"})]}),D&&(0,q.jsx)(v.A,{severity:"success",sx:{mb:2},children:D}),Y&&(0,q.jsx)(v.A,{severity:"error",sx:{mb:2},children:Y}),(0,q.jsx)(n.l1,{initialValues:ae,validationSchema:z,onSubmit:async(e,s)=>{let{setSubmitting:r}=s;try{R(null),T(null);const s=await W.Ay.put("/api/staff/".concat(null===a||void 0===a?void 0:a.id),e);if(o&&s.data){const e=s.data.data||s.data;o({firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone,isActive:e.isActive})}T("Profile updated successfully!")}catch(d){var t,n,i,l;console.error("Profile update error:",d);const e=(null===(t=d.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||(null===(i=d.response)||void 0===i||null===(l=i.data)||void 0===l?void 0:l.message)||d.message||"Failed to update profile";R(e)}finally{r(!1)}},enableReinitialize:!0,children:e=>{let{errors:s,touched:a,isSubmitting:r}=e;return(0,q.jsxs)(n.lV,{children:[(0,q.jsx)(n.D0,{as:A.A,name:"firstName",label:"First Name",fullWidth:!0,margin:"normal",variant:"outlined",error:a.firstName&&Boolean(s.firstName),helperText:a.firstName&&s.firstName,disabled:r}),(0,q.jsx)(n.D0,{as:A.A,name:"lastName",label:"Last Name",fullWidth:!0,margin:"normal",variant:"outlined",error:a.lastName&&Boolean(s.lastName),helperText:a.lastName&&s.lastName,disabled:r}),(0,q.jsx)(n.D0,{as:A.A,name:"email",label:"Email Address",fullWidth:!0,margin:"normal",variant:"outlined",error:a.email&&Boolean(s.email),helperText:a.email&&s.email,disabled:r,InputProps:{startAdornment:(0,q.jsx)(f.A,{position:"start",children:(0,q.jsx)(y.A,{})})}}),(0,q.jsx)(n.D0,{as:A.A,name:"phone",label:"Phone Number",fullWidth:!0,margin:"normal",variant:"outlined",error:a.phone&&Boolean(s.phone),helperText:a.phone&&s.phone,disabled:r,InputProps:{startAdornment:(0,q.jsx)(f.A,{position:"start",children:(0,q.jsx)(b.A,{})})}}),(0,q.jsx)(u.A,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:r,startIcon:r?(0,q.jsx)(l.A,{size:20}):(0,q.jsx)(S.A,{}),sx:{mt:3},children:r?"Saving...":"Save Changes"})]})}})]})})}),(0,q.jsx)(h.Ay,{item:!0,xs:12,md:6,children:(0,q.jsx)(p.A,{children:(0,q.jsxs)(x.A,{children:[(0,q.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,q.jsx)(g.A,{color:"primary"}),(0,q.jsx)(m.A,{variant:"h6",children:"Change Password"})]}),E&&(0,q.jsx)(v.A,{severity:"success",sx:{mb:2},children:E}),O&&(0,q.jsx)(v.A,{severity:"error",sx:{mb:2},children:O}),(0,q.jsx)(n.l1,{initialValues:{currentPassword:"",newPassword:"",confirmPassword:""},validationSchema:F,onSubmit:async(e,s)=>{let{setSubmitting:a,resetForm:r}=s;try{U(null),V(null),await W.Ay.post("/staff/change-password",{currentPassword:e.currentPassword,newPassword:e.newPassword}),V("Password changed successfully!"),r()}catch(o){var t,n;const e=(null===(t=o.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||"Failed to change password";U(e)}finally{a(!1)}},children:e=>{let{errors:s,touched:a,isSubmitting:r}=e;return(0,q.jsxs)(n.lV,{children:[(0,q.jsx)(n.D0,{as:A.A,name:"currentPassword",label:"Current Password",type:Z?"text":"password",fullWidth:!0,margin:"normal",variant:"outlined",error:a.currentPassword&&Boolean(s.currentPassword),helperText:a.currentPassword&&s.currentPassword,disabled:r,InputProps:{endAdornment:(0,q.jsx)(f.A,{position:"end",children:(0,q.jsx)(c.A,{onClick:()=>M(!Z),edge:"end",children:Z?(0,q.jsx)(I.A,{}):(0,q.jsx)(C.A,{})})})}}),(0,q.jsx)(n.D0,{as:A.A,name:"newPassword",label:"New Password",type:_?"text":"password",fullWidth:!0,margin:"normal",variant:"outlined",error:a.newPassword&&Boolean(s.newPassword),helperText:a.newPassword&&s.newPassword,disabled:r,InputProps:{endAdornment:(0,q.jsx)(f.A,{position:"end",children:(0,q.jsx)(c.A,{onClick:()=>G(!_),edge:"end",children:_?(0,q.jsx)(I.A,{}):(0,q.jsx)(C.A,{})})})}}),(0,q.jsx)(n.D0,{as:A.A,name:"confirmPassword",label:"Confirm New Password",type:H?"text":"password",fullWidth:!0,margin:"normal",variant:"outlined",error:a.confirmPassword&&Boolean(s.confirmPassword),helperText:a.confirmPassword&&s.confirmPassword,disabled:r,InputProps:{endAdornment:(0,q.jsx)(f.A,{position:"end",children:(0,q.jsx)(c.A,{onClick:()=>J(!H),edge:"end",children:H?(0,q.jsx)(I.A,{}):(0,q.jsx)(C.A,{})})})}}),(0,q.jsxs)(i.A,{sx:{mt:2,mb:2},children:[(0,q.jsx)(m.A,{variant:"caption",color:"text.secondary",component:"div",children:"Password must contain:"}),(0,q.jsx)(m.A,{variant:"caption",color:"text.secondary",component:"div",children:"\u2022 At least 8 characters"}),(0,q.jsx)(m.A,{variant:"caption",color:"text.secondary",component:"div",children:"\u2022 One uppercase and lowercase letter"}),(0,q.jsx)(m.A,{variant:"caption",color:"text.secondary",component:"div",children:"\u2022 One number and one special character"})]}),(0,q.jsx)(u.A,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:r,startIcon:r?(0,q.jsx)(l.A,{size:20}):(0,q.jsx)(g.A,{}),sx:{mt:3},children:r?"Changing Password...":"Change Password"})]})}})]})})}),(0,q.jsx)(h.Ay,{item:!0,xs:12,children:(0,q.jsx)(p.A,{children:(0,q.jsxs)(x.A,{children:[(0,q.jsx)(m.A,{variant:"h6",gutterBottom:!0,children:"Account Information"}),(0,q.jsx)(j.A,{sx:{my:2}}),(0,q.jsxs)(h.Ay,{container:!0,spacing:2,children:[(0,q.jsxs)(h.Ay,{item:!0,xs:12,sm:4,children:[(0,q.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Account Type"}),(0,q.jsx)(m.A,{variant:"body1",children:(null===a||void 0===a?void 0:a.role)||"Staff"})]}),(0,q.jsxs)(h.Ay,{item:!0,xs:12,sm:4,children:[(0,q.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Status"}),(0,q.jsx)(m.A,{variant:"body1",sx:{color:null!==a&&void 0!==a&&a.isActive?"success.main":"error.main",fontWeight:"medium"},children:null!==a&&void 0!==a&&a.isActive?"Active":"Inactive"})]}),(0,q.jsxs)(h.Ay,{item:!0,xs:12,sm:4,children:[(0,q.jsx)(m.A,{variant:"body2",color:"text.secondary",children:"Last Login"}),(0,q.jsx)(m.A,{variant:"body1",children:null!==a&&void 0!==a&&a.lastLogin?new Date(a.lastLogin).toLocaleString():"Just now"})]})]})]})})})]})]})}}}]);