"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[7896],{87896:(e,n,r)=>{r.r(n),r.d(n,{default:()=>D});var s=r(9950),i=r(9213),t=r(21671),l=r(25333),a=r(82053),c=r(10226),d=r(33738),o=r(78317),h=r(60899),x=r(1320),j=r(2235),A=r(15769),u=r(69780),m=r(34075),g=r(46639),v=r(62999),p=r(25979),y=r(19647),b=r(70006),w=r(23266),f=r(48089),C=r(50704),k=r(8145),S=r(2046),T=r(6258),B=r(14857),P=r(19223),O=r(85970),V=r(47644),I=r(25102),L=r(16335),R=r(81095),z=r(72528),E=r(54203),W=r(67360),F=r(60229),N=r(81298),M=r(28429),Y=r(44414);const _=e=>{let{customer:n,theme:r}=e;const[g,v]=(0,s.useState)(!1),p=(0,M.Zp)(),y=[r.palette.primary.main,r.palette.secondary.main,r.palette.success.main,r.palette.warning.main,r.palette.error.main,r.palette.info.main,"#8884d8","#82ca9d","#ffc658","#ff8042"];return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(i.A,{sx:{"& > *":{borderBottom:"unset"}},children:[(0,Y.jsx)(t.A,{children:(0,Y.jsx)(l.A,{"aria-label":"expand row",size:"small",onClick:()=>v(!g),children:g?(0,Y.jsx)(V.A,{}):(0,Y.jsx)(O.A,{})})}),(0,Y.jsx)(t.A,{component:"th",scope:"row",children:n.name}),(0,Y.jsx)(t.A,{children:n.email}),(0,Y.jsx)(t.A,{align:"right",children:n.invoiceCount}),(0,Y.jsx)(t.A,{align:"right",children:(0,N.vv)(n.totalSpend)}),(0,Y.jsxs)(t.A,{align:"right",children:[(0,Y.jsx)(a.A,{variant:"body2",fontWeight:"bold",color:"primary",children:(0,N.vv)(n.totalSpend)}),(0,Y.jsx)(a.A,{variant:"caption",color:"text.secondary",children:"Lifetime Value"})]}),(0,Y.jsx)(t.A,{align:"right",children:(0,Y.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>{p("/customers/".concat(n.id))},children:"View Details"})})]}),(0,Y.jsx)(i.A,{children:(0,Y.jsx)(t.A,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:(0,Y.jsx)(d.A,{in:g,timeout:"auto",unmountOnExit:!0,children:(0,Y.jsx)(o.A,{sx:{margin:2},children:(0,Y.jsxs)(h.Ay,{container:!0,spacing:3,children:[(0,Y.jsxs)(h.Ay,{item:!0,xs:12,md:6,children:[(0,Y.jsx)(a.A,{variant:"h6",gutterBottom:!0,component:"div",children:"Service Breakdown"}),(0,Y.jsx)(x.A,{component:j.A,variant:"outlined",children:(0,Y.jsxs)(A.A,{size:"small",children:[(0,Y.jsx)(u.A,{children:(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(t.A,{children:"Service"}),(0,Y.jsx)(t.A,{align:"right",children:"Count"}),(0,Y.jsx)(t.A,{align:"right",children:"Revenue"})]})}),(0,Y.jsxs)(m.A,{children:[n.serviceBreakdown.map(e=>(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(t.A,{component:"th",scope:"row",children:e.name}),(0,Y.jsx)(t.A,{align:"right",children:e.count}),(0,Y.jsx)(t.A,{align:"right",children:(0,N.vv)(e.revenue)})]},e.id)),(0,Y.jsxs)(i.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.04)"},children:[(0,Y.jsx)(t.A,{component:"th",scope:"row",children:(0,Y.jsx)("strong",{children:"Total"})}),(0,Y.jsx)(t.A,{align:"right",children:(0,Y.jsx)("strong",{children:n.serviceBreakdown.reduce((e,n)=>e+n.count,0)})}),(0,Y.jsx)(t.A,{align:"right",children:(0,Y.jsx)("strong",{children:(0,N.vv)(n.serviceBreakdown.reduce((e,n)=>e+n.revenue,0))})})]})]})]})})]}),(0,Y.jsxs)(h.Ay,{item:!0,xs:12,md:6,children:[(0,Y.jsx)(a.A,{variant:"h6",gutterBottom:!0,component:"div",children:"Add-On Breakdown"}),(0,Y.jsx)(x.A,{component:j.A,variant:"outlined",children:(0,Y.jsxs)(A.A,{size:"small",children:[(0,Y.jsx)(u.A,{children:(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(t.A,{children:"Add-On"}),(0,Y.jsx)(t.A,{align:"right",children:"Count"}),(0,Y.jsx)(t.A,{align:"right",children:"Revenue"})]})}),(0,Y.jsxs)(m.A,{children:[n.addOnBreakdown.map(e=>(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(t.A,{component:"th",scope:"row",children:e.name}),(0,Y.jsx)(t.A,{align:"right",children:e.count}),(0,Y.jsx)(t.A,{align:"right",children:(0,N.vv)(e.revenue)})]},e.id)),(0,Y.jsxs)(i.A,{sx:{backgroundColor:"rgba(0, 0, 0, 0.04)"},children:[(0,Y.jsx)(t.A,{component:"th",scope:"row",children:(0,Y.jsx)("strong",{children:"Total"})}),(0,Y.jsx)(t.A,{align:"right",children:(0,Y.jsx)("strong",{children:n.addOnBreakdown.reduce((e,n)=>e+n.count,0)})}),(0,Y.jsx)(t.A,{align:"right",children:(0,Y.jsx)("strong",{children:(0,N.vv)(n.addOnTotal)})})]})]})]})})]}),(0,Y.jsx)(h.Ay,{item:!0,xs:12,children:(0,Y.jsx)(o.A,{sx:{height:250},children:(0,Y.jsx)(R.u,{width:"100%",height:"100%",children:(0,Y.jsxs)(W.r,{children:[(0,Y.jsx)(E.F,{data:[...n.serviceBreakdown.map(e=>({name:e.name,value:e.revenue,type:"service"})),...n.addOnBreakdown.map(e=>({name:e.name,value:e.revenue,type:"addon"}))],cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{name:n,percent:r}=e;return r&&r>.05?"".concat(n,": ").concat((100*r).toFixed(0),"%"):""},outerRadius:80,fill:"#8884d8",dataKey:"value",children:[...n.serviceBreakdown.map((e,n)=>(0,Y.jsx)(z.f,{fill:y[n%y.length]},"cell-service-".concat(n))),...n.addOnBreakdown.map((e,r)=>(0,Y.jsx)(z.f,{fill:y[(r+n.serviceBreakdown.length)%y.length]},"cell-addon-".concat(r)))]}),(0,Y.jsx)(L.m,{formatter:e=>(0,N.vv)(Number(e))}),(0,Y.jsx)(I.s,{})]})})})})]})})})})})]})},D=()=>{const e=(0,B.A)(),[n,r]=(0,s.useState)(!0),[l,c]=(0,s.useState)("month"),[d,O]=(0,s.useState)([]),[V,I]=(0,s.useState)([]),[L,R]=(0,s.useState)(""),[z,E]=(0,s.useState)(0),[W,M]=(0,s.useState)(10),[D,K]=(0,s.useState)(null),Z=(0,s.useCallback)(async()=>{r(!0),K(null);try{const e=await F.A.getCustomerValue(l);O(e),I(e)}catch(e){console.error("Error loading customer value data:",e),K("Failed to load customer data. Please try again.")}finally{r(!1)}},[l]),q=(0,s.useCallback)(()=>{if(!L.trim())return void I(d);const e=L.toLowerCase(),n=d.filter(n=>n.name.toLowerCase().includes(e)||n.email.toLowerCase().includes(e));I(n),E(0)},[L,d]);(0,s.useEffect)(()=>{Z()},[Z]),(0,s.useEffect)(()=>{q()},[q]);const G=()=>{switch(l){case"day":return"Today";case"week":return"This Week";case"month":return"This Month";case"year":return"This Year";case"all":return"All Time";default:return"Custom Period"}};return n?(0,Y.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:(0,Y.jsx)(g.A,{})}):D?(0,Y.jsx)(o.A,{sx:{p:3,color:"error.main"},children:(0,Y.jsx)(a.A,{variant:"h6",children:D})}):(0,Y.jsxs)(v.A,{maxWidth:"xl",children:[(0,Y.jsxs)(o.A,{sx:{mb:4},children:[(0,Y.jsx)(a.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Customer Value Report"}),(0,Y.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,Y.jsx)(a.A,{variant:"subtitle1",color:"text.secondary",children:"Track customer spending and identify your most valuable customers"}),(0,Y.jsxs)(p.A,{sx:{minWidth:150},children:[(0,Y.jsx)(y.A,{id:"period-select-label",children:"Time Period"}),(0,Y.jsxs)(b.A,{labelId:"period-select-label",id:"period-select",value:l,label:"Time Period",onChange:e=>{c(e.target.value)},children:[(0,Y.jsx)(w.A,{value:"day",children:"Today"}),(0,Y.jsx)(w.A,{value:"week",children:"This Week"}),(0,Y.jsx)(w.A,{value:"month",children:"This Month"}),(0,Y.jsx)(w.A,{value:"year",children:"This Year"}),(0,Y.jsx)(w.A,{value:"all",children:"All Time"})]})]})]})]}),(0,Y.jsx)(j.A,{elevation:3,sx:{borderRadius:2,mb:4},children:(0,Y.jsx)(o.A,{sx:{p:3},children:(0,Y.jsxs)(h.Ay,{container:!0,spacing:3,children:[(0,Y.jsx)(h.Ay,{item:!0,xs:12,md:3,children:(0,Y.jsx)(f.A,{children:(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(a.A,{variant:"subtitle2",color:"text.secondary",children:"Total Customer Value"}),(0,Y.jsx)(a.A,{variant:"h4",sx:{mt:1,color:"primary.main"},children:(0,N.vv)(d.reduce((e,n)=>e+n.totalSpend,0))}),(0,Y.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:G()})]})})}),(0,Y.jsx)(h.Ay,{item:!0,xs:12,md:3,children:(0,Y.jsx)(f.A,{children:(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(a.A,{variant:"subtitle2",color:"text.secondary",children:"Active Customers"}),(0,Y.jsx)(a.A,{variant:"h4",sx:{mt:1,color:"secondary.main"},children:d.length}),(0,Y.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:G()})]})})}),(0,Y.jsx)(h.Ay,{item:!0,xs:12,md:3,children:(0,Y.jsx)(f.A,{children:(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(a.A,{variant:"subtitle2",color:"text.secondary",children:"Avg. Customer Value"}),(0,Y.jsx)(a.A,{variant:"h4",sx:{mt:1,color:"success.main"},children:(0,N.vv)(d.length>0?d.reduce((e,n)=>e+n.totalSpend,0)/d.length:0)}),(0,Y.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:G()})]})})}),(0,Y.jsx)(h.Ay,{item:!0,xs:12,md:3,children:(0,Y.jsx)(f.A,{children:(0,Y.jsxs)(C.A,{children:[(0,Y.jsx)(a.A,{variant:"subtitle2",color:"text.secondary",children:"Avg. LTV"}),(0,Y.jsx)(a.A,{variant:"h4",sx:{mt:1,color:"warning.main"},children:(0,N.vv)(d.length>0?d.reduce((e,n)=>e+n.totalSpend,0)/d.length:0)}),(0,Y.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"All Time Average"})]})})})]})})}),(0,Y.jsx)(j.A,{elevation:3,sx:{borderRadius:2},children:(0,Y.jsxs)(o.A,{sx:{p:3},children:[(0,Y.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,Y.jsx)(a.A,{variant:"h6",children:"Customer Spending"}),(0,Y.jsx)(k.A,{label:"Search Customers",variant:"outlined",size:"small",value:L,onChange:e=>{R(e.target.value)},InputProps:{startAdornment:(0,Y.jsx)(S.A,{position:"start",children:(0,Y.jsx)(P.A,{})})}})]}),(0,Y.jsx)(x.A,{children:(0,Y.jsxs)(A.A,{"aria-label":"customer value table",children:[(0,Y.jsx)(u.A,{children:(0,Y.jsxs)(i.A,{children:[(0,Y.jsx)(t.A,{}),(0,Y.jsx)(t.A,{children:"Name"}),(0,Y.jsx)(t.A,{children:"Email"}),(0,Y.jsx)(t.A,{align:"right",children:"Invoices"}),(0,Y.jsx)(t.A,{align:"right",children:"Period Spend"}),(0,Y.jsx)(t.A,{align:"right",children:"LTV"}),(0,Y.jsx)(t.A,{align:"right",children:"Actions"})]})}),(0,Y.jsxs)(m.A,{children:[V.slice(z*W,z*W+W).map(n=>(0,Y.jsx)(_,{customer:n,theme:e},n.id)),0===V.length&&(0,Y.jsx)(i.A,{children:(0,Y.jsx)(t.A,{colSpan:7,align:"center",children:"No customers found"})})]})]})}),(0,Y.jsx)(T.A,{rowsPerPageOptions:[5,10,25],component:"div",count:V.length,rowsPerPage:W,page:z,onPageChange:(e,n)=>{E(n)},onRowsPerPageChange:e=>{M(parseInt(e.target.value,10)),E(0)}})]})})]})}}}]);