"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[8215],{48215:(e,t,a)=>{a.d(t,{A:()=>G});var r=a(89379),s=a(9950),n=a(48089),l=a(50704),o=a(78317),i=a(82053),d=a(25333),c=a(65429),u=a(81616),p=a(77922),h=a(8145),A=a(46639),g=a(23266),x=a(10226),m=a(31556),y=a(97916),j=a(7871),v=a(74745),f=a(31769),C=a(25277),R=a(86835),b=a(20760),w=a(93472),S=a(72934),I=a(1673),E=a(63479),P=a(89007),N=a(35286),D=a(44414);const G=e=>{let{petId:t,customerId:a,reservationId:G,onSuccess:k,onCancel:T}=e;const[O,z]=(0,s.useState)(!1),[F,L]=(0,s.useState)(null),[W,U]=(0,s.useState)([]),[B,V]=(0,s.useState)([]),M=(0,s.useRef)(null),[H,_]=(0,s.useState)(t||""),[Y,K]=(0,s.useState)(a||""),[q,Q]=(0,s.useState)("DAYCARE"),[J,X]=(0,s.useState)(""),[Z,$]=(0,s.useState)(""),[ee,te]=(0,s.useState)(4),[ae,re]=(0,s.useState)(4),[se,ne]=(0,s.useState)(4),[le,oe]=(0,s.useState)(4),[ie,de]=(0,s.useState)([]),[ce,ue]=(0,s.useState)(""),[pe,he]=(0,s.useState)(""),[Ae,ge]=(0,s.useState)([]),[xe,me]=(0,s.useState)(""),[ye,je]=(0,s.useState)([]),[ve,fe]=(0,s.useState)([]),[Ce,Re]=(0,s.useState)(null),[be,we]=(0,s.useState)(null),[Se,Ie]=(0,s.useState)(""),[Ee,Pe]=(0,s.useState)(!1),[Ne,De]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=setTimeout(async()=>{if(Se.length<2)je([]);else{Pe(!0);try{const e=await P.m.searchCustomers(Se,1,20);je(e.data||[])}catch(e){console.error("Failed to load customers:",e)}finally{Pe(!1)}}},300);return()=>clearTimeout(e)},[Se]),(0,s.useEffect)(()=>{(async()=>{if(null===Ce||void 0===Ce||!Ce.id)return fe([]),void we(null);De(!0);try{var e;const t=await N.B.getPetsByCustomer(Ce.id);fe(t.data||[]),1===(null===(e=t.data)||void 0===e?void 0:e.length)&&(we(t.data[0]),_(t.data[0].id))}catch(t){console.error("Failed to load pets:",t)}finally{De(!1)}})()},[Ce]),(0,s.useEffect)(()=>{Ce&&K(Ce.id)},[Ce]),(0,s.useEffect)(()=>{be&&_(be.id)},[be]);const Ge=()=>{ce.trim()&&(de([...ie,ce.trim()]),ue(""))},ke=()=>{xe.trim()&&(ge([...Ae,xe.trim()]),me(""))},Te=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(z(!0),L(null),!H||!Y)return void L("Pet and Customer are required");const t={petId:H,customerId:Y,reservationId:G,serviceType:q,title:J||void 0,summary:Z||void 0,moodRating:ee,energyRating:ae,appetiteRating:se,socialRating:le,activities:ie,behaviorNotes:pe||void 0,highlights:Ae},a=await E.G.createReportCard(t);for(let e=0;e<W.length;e++){const t=W[e],r=await E.G.uploadFile(t);await E.G.uploadPhoto(a.id,{url:r.url,thumbnailUrl:r.thumbnailUrl,order:e,mimeType:t.type,fileSize:t.size})}e&&await E.G.sendReportCard(a.id,{sendEmail:!0,sendSMS:!0}),null===k||void 0===k||k()}catch(t){L(t.message||"Failed to create report card")}finally{z(!1)}};return(0,D.jsx)(n.A,{children:(0,D.jsxs)(l.A,{children:[(0,D.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,D.jsx)(i.A,{variant:"h6",children:"Create Report Card"}),T&&(0,D.jsx)(d.A,{onClick:T,size:"small",children:(0,D.jsx)(R.A,{})})]}),F&&(0,D.jsx)(c.A,{severity:"error",sx:{mb:2},onClose:()=>L(null),children:F}),(0,D.jsxs)(u.A,{spacing:3,children:[(0,D.jsx)(p.A,{options:ye,value:Ce,onChange:(e,t)=>Re(t),inputValue:Se,onInputChange:(e,t)=>Ie(t),getOptionLabel:e=>"".concat(e.firstName," ").concat(e.lastName),loading:Ee,renderInput:e=>(0,D.jsx)(h.A,(0,r.A)((0,r.A)({},e),{},{label:"Customer *",placeholder:"Search by name...",helperText:"Type at least 2 characters to search",InputProps:(0,r.A)((0,r.A)({},e.InputProps),{},{endAdornment:(0,D.jsxs)(D.Fragment,{children:[Ee?(0,D.jsx)(A.A,{size:20}):null,e.InputProps.endAdornment]})})})),renderOption:(e,t)=>(0,s.createElement)("li",(0,r.A)((0,r.A)({},e),{},{key:t.id}),(0,D.jsxs)(o.A,{children:[(0,D.jsxs)(i.A,{variant:"body1",children:[t.firstName," ",t.lastName]}),(0,D.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[t.email," \u2022 ",t.phone||"No phone"]})]})),noOptionsText:Se.length<2?"Type to search customers":"No customers found"}),(0,D.jsx)(p.A,{options:ve,value:be,onChange:(e,t)=>we(t),getOptionLabel:e=>e.name,loading:Ne,disabled:!Ce,renderInput:e=>(0,D.jsx)(h.A,(0,r.A)((0,r.A)({},e),{},{label:"Pet *",placeholder:Ce?"Select a pet":"Select customer first",helperText:Ce?0===ve.length?"No pets found for this customer":"".concat(ve.length," pet(s) available"):"Please select a customer first",InputProps:(0,r.A)((0,r.A)({},e.InputProps),{},{endAdornment:(0,D.jsxs)(D.Fragment,{children:[Ne?(0,D.jsx)(A.A,{size:20}):null,e.InputProps.endAdornment]})})})),renderOption:(e,t)=>(0,s.createElement)("li",(0,r.A)((0,r.A)({},e),{},{key:t.id}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(i.A,{variant:"body1",children:t.name}),(0,D.jsxs)(i.A,{variant:"caption",color:"text.secondary",children:[t.breed||t.type," \u2022 ",t.color||"No color specified"]})]})),noOptionsText:Ce?"No pets found":"Select a customer first"}),(0,D.jsxs)(h.A,{select:!0,label:"Service Type",value:q,onChange:e=>Q(e.target.value),fullWidth:!0,children:[(0,D.jsx)(g.A,{value:"DAYCARE",children:"Daycare"}),(0,D.jsx)(g.A,{value:"BOARDING",children:"Boarding"}),(0,D.jsx)(g.A,{value:"GROOMING",children:"Grooming"}),(0,D.jsx)(g.A,{value:"TRAINING",children:"Training"}),(0,D.jsx)(g.A,{value:"GENERAL",children:"General"})]}),(0,D.jsxs)(o.A,{children:[(0,D.jsxs)(i.A,{variant:"subtitle2",gutterBottom:!0,children:["Photos (",W.length,")"]}),(0,D.jsx)(x.A,{variant:"outlined",startIcon:(0,D.jsx)(w.A,{}),onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},fullWidth:!0,sx:{mb:2},children:"Take Photo / Upload"}),(0,D.jsx)("input",{ref:M,type:"file",accept:"image/*",capture:"environment",multiple:!0,style:{display:"none"},onChange:async e=>{const t=e.target.files;if(!t)return;const a=[],r=[];for(let n=0;n<t.length;n++){const e=t[n];try{const t=await E.G.compressImage(e);a.push(t),r.push(URL.createObjectURL(t))}catch(s){console.error("Failed to compress image:",s),a.push(e),r.push(URL.createObjectURL(e))}}U([...W,...a]),V([...B,...r])}}),B.length>0&&(0,D.jsx)(m.A,{cols:3,gap:8,children:B.map((e,t)=>(0,D.jsxs)(y.A,{children:[(0,D.jsx)("img",{src:e,alt:"Photo ".concat(t+1),loading:"lazy",style:{height:120,objectFit:"cover"}}),(0,D.jsx)(j.A,{actionIcon:(0,D.jsx)(d.A,{sx:{color:"white"},onClick:()=>(e=>{const t=W.filter((t,a)=>a!==e),a=B.filter((t,a)=>a!==e);U(t),V(a)})(t),children:(0,D.jsx)(b.A,{})})})]},t))})]}),(0,D.jsx)(v.A,{}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"How was their day?"}),(0,D.jsxs)(o.A,{sx:{mb:2},children:[(0,D.jsxs)(i.A,{variant:"body2",color:"text.secondary",children:["Mood ",E.G.getRatingEmoji(ee)]}),(0,D.jsx)(f.A,{value:ee,onChange:(e,t)=>te(t||3),size:"large"})]}),(0,D.jsxs)(o.A,{sx:{mb:2},children:[(0,D.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Energy Level \u26a1"}),(0,D.jsx)(f.A,{value:ae,onChange:(e,t)=>re(t||3),size:"large"})]}),(0,D.jsxs)(o.A,{sx:{mb:2},children:[(0,D.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Appetite \ud83c\udf56"}),(0,D.jsx)(f.A,{value:se,onChange:(e,t)=>ne(t||3),size:"large"})]}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(i.A,{variant:"body2",color:"text.secondary",children:"Social Behavior \ud83d\udc65"}),(0,D.jsx)(f.A,{value:le,onChange:(e,t)=>oe(t||3),size:"large"})]})]}),(0,D.jsx)(v.A,{}),(0,D.jsx)(h.A,{label:"Quick Summary",value:Z,onChange:e=>$(e.target.value),multiline:!0,rows:2,placeholder:"Had a great day playing with friends!",fullWidth:!0}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Activities"}),(0,D.jsxs)(o.A,{sx:{display:"flex",gap:1,mb:1},children:[(0,D.jsx)(h.A,{size:"small",value:ce,onChange:e=>ue(e.target.value),onKeyPress:e=>"Enter"===e.key&&Ge(),placeholder:"e.g., Played fetch",fullWidth:!0}),(0,D.jsx)(x.A,{onClick:Ge,variant:"outlined",children:"Add"})]}),(0,D.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:ie.map((e,t)=>(0,D.jsx)(C.A,{label:e,onDelete:()=>(e=>{de(ie.filter((t,a)=>a!==e))})(t),size:"small"},t))})]}),(0,D.jsxs)(o.A,{children:[(0,D.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Highlights \u2b50"}),(0,D.jsxs)(o.A,{sx:{display:"flex",gap:1,mb:1},children:[(0,D.jsx)(h.A,{size:"small",value:xe,onChange:e=>me(e.target.value),onKeyPress:e=>"Enter"===e.key&&ke(),placeholder:"e.g., Made a new friend!",fullWidth:!0}),(0,D.jsx)(x.A,{onClick:ke,variant:"outlined",children:"Add"})]}),(0,D.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:Ae.map((e,t)=>(0,D.jsx)(C.A,{label:e,onDelete:()=>(e=>{ge(Ae.filter((t,a)=>a!==e))})(t),color:"primary",size:"small"},t))})]}),(0,D.jsx)(h.A,{label:"Detailed Notes (Optional)",value:pe,onChange:e=>he(e.target.value),multiline:!0,rows:3,placeholder:"Any additional observations...",fullWidth:!0}),(0,D.jsxs)(o.A,{sx:{display:"flex",gap:2,pt:2},children:[(0,D.jsx)(x.A,{variant:"outlined",startIcon:O?(0,D.jsx)(A.A,{size:20}):(0,D.jsx)(S.A,{}),onClick:()=>Te(!1),disabled:O,fullWidth:!0,children:"Save Draft"}),(0,D.jsx)(x.A,{variant:"contained",startIcon:O?(0,D.jsx)(A.A,{size:20}):(0,D.jsx)(I.A,{}),onClick:()=>Te(!0),disabled:O,fullWidth:!0,children:"Send Now"})]})]})]})})}},63479:(e,t,a)=>{a.d(t,{G:()=>n});var r=a(89379),s=a(82932);const n=new class{async createReportCard(e){return(await s.Ay.post("/api/report-cards",e)).data.data}async listReportCards(e){return(await s.Ay.get("/api/report-cards",{params:e})).data.data}async getReportCard(e){return(await s.Ay.get("/api/report-cards/".concat(e))).data.data}async updateReportCard(e,t){return(await s.Ay.patch("/api/report-cards/".concat(e),t)).data.data}async deleteReportCard(e){await s.Ay.delete("/api/report-cards/".concat(e))}async uploadPhoto(e,t){return(await s.Ay.post("/api/report-cards/".concat(e,"/photos"),t)).data.data}async deletePhoto(e,t){await s.Ay.delete("/api/report-cards/".concat(e,"/photos/").concat(t))}async updatePhoto(e,t,a){return(await s.Ay.patch("/api/report-cards/".concat(e,"/photos/").concat(t),a)).data.data}async sendReportCard(e,t){return(await s.Ay.post("/api/report-cards/".concat(e,"/send"),t)).data.data}async bulkCreateReportCards(e){return(await s.Ay.post("/api/report-cards/bulk",{reportCards:e})).data.data}async bulkSendReportCards(e,t){return(await s.Ay.post("/api/report-cards/bulk/send",(0,r.A)({reportCardIds:e},t))).data.data}async getCustomerReportCards(e){return(await s.Ay.get("/api/report-cards/customers/".concat(e))).data.data}async getPetReportCards(e){return(await s.Ay.get("/api/report-cards/pets/".concat(e))).data.data}async getReservationReportCards(e){return(await s.Ay.get("/api/report-cards/reservations/".concat(e))).data.data}formatServiceType(e){return{BOARDING:"Boarding",DAYCARE:"Daycare",GROOMING:"Grooming",TRAINING:"Training",GENERAL:"General"}[e]||e}formatStatus(e){return{DRAFT:"Draft",PENDING_REVIEW:"Pending Review",APPROVED:"Approved",SENT:"Sent",VIEWED:"Viewed",ARCHIVED:"Archived"}[e]||e}getStatusColor(e){return{DRAFT:"default",PENDING_REVIEW:"warning",APPROVED:"info",SENT:"success",VIEWED:"success",ARCHIVED:"default"}[e]||"default"}getRatingEmoji(e){return["\ud83d\ude22","\ud83d\ude15","\ud83d\ude10","\ud83d\ude0a","\ud83d\ude04"][e-1]||"\ud83d\ude10"}getRatingStars(e){return"\u2b50".repeat(e)}async uploadFile(e){return(new FormData).append("file",e),{url:URL.createObjectURL(e),thumbnailUrl:URL.createObjectURL(e)}}async compressImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1200,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1200,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.8;return new Promise((s,n)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=l=>{var o;const i=new Image;i.src=null===(o=l.target)||void 0===o?void 0:o.result,i.onload=()=>{const l=document.createElement("canvas");let o=i.width,d=i.height;o>d?o>t&&(d*=t/o,o=t):d>a&&(o*=a/d,d=a),l.width=o,l.height=d;const c=l.getContext("2d");null===c||void 0===c||c.drawImage(i,0,0,o,d),l.toBlob(t=>{if(t){const a=new File([t],e.name,{type:"image/jpeg",lastModified:Date.now()});s(a)}else n(new Error("Failed to compress image"))},"image/jpeg",r)},i.onerror=n},l.onerror=n})}}}}]);