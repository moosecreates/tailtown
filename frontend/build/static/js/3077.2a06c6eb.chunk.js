"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[3077],{53077:(e,s,t)=>{t.r(s),t.d(s,{default:()=>_});var n=t(89379),r=t(9950),o=t(62999),l=t(78317),i=t(82053),c=t(10226),a=t(8145),d=t(2046),u=t(2235),m=t(65429),x=t(46639),h=t(1320),A=t(15769),p=t(69780),j=t(9213),g=t(21671),f=t(34075),C=t(96583),y=t(40033),v=t(28170),b=t(79739),k=t(98785),w=t(19223),S=t(28429),I=t(95491),N=t.n(I),E=t(89007),L=t(40085),z=t(9540),W=t(41223),D=t(51069),F=t(7762),P=t(33738),B=t(25277),M=t(44414);const _=()=>{const e=(0,S.Zp)(),[s,t]=(0,r.useState)([]),[I,_]=(0,r.useState)([]),[q,H]=(0,r.useState)(""),[K,Q]=(0,r.useState)([]),[R,T]=(0,r.useState)(!1),U=(0,r.useMemo)(()=>N()(async(e,s)=>{console.log("Debounced search triggered:",{query:e,iconFilters:s});try{let n;G(!0),e?(console.log("Using server-side search for:",e),n=await E.m.searchCustomers(e,1,1e3)):(console.log("Loading all customers (first 1000)"),n=await E.m.getAllCustomers(1,1e3));let r=n.data||[];console.log("Server returned:",r.length,"customers"),s.length>0&&(r=r.filter(e=>{const t=e.customerIcons||[];return s.every(e=>t.includes(e))}),console.log("After icon filter:",r.length,"customers")),t(r),_(r)}catch(n){console.error("Error searching customers:",n),O("Failed to search customers")}finally{G(!1)}},300),[]);(0,r.useEffect)(()=>(U(q,K),()=>{U.cancel()}),[q,K,U]);const[Z,G]=(0,r.useState)(!0),[J,O]=(0,r.useState)(null),[V,X]=(0,r.useState)({open:!1,message:"",severity:"success"}),[Y,$]=(0,r.useState)(!1),[ee,se]=(0,r.useState)(null),[te,ne]=(0,r.useState)([]),[re,oe]=(0,r.useState)({}),le=(0,r.useCallback)(async()=>{try{G(!0),O(null);const e=await E.m.getAllCustomers(1,1e3);console.log("Loaded customers:",e),t(e.data||[]),_(e.data||[])}catch(e){console.error("Error loading customers:",e),O("Failed to load customers. Please try again later.")}finally{G(!1)}},[]);(0,r.useEffect)(()=>{le()},[le]);const ie=(0,r.useCallback)(()=>{e("/customers/new")},[e]),ce=(0,r.useCallback)(s=>{e("/customers/".concat(s))},[e]),ae=(0,r.useCallback)((e,s)=>{e.stopPropagation(),se(s),ne(s.customerIcons||[]),oe(s.iconNotes||{}),$(!0)},[]),de=(0,r.useCallback)(async(e,r)=>{if(ee)try{await E.m.updateCustomer(ee.id,{customerIcons:e,iconNotes:r});const o=s.map(s=>s.id===ee.id?(0,n.A)((0,n.A)({},s),{},{customerIcons:e,iconNotes:r}):s);t(o),_(o),X({open:!0,message:"Customer icons updated",severity:"success"})}catch(o){console.error("Error updating customer icons:",o),X({open:!0,message:"Failed to update icons",severity:"error"})}},[ee,s]),ue=(0,r.useCallback)(async(e,s)=>{if(e.stopPropagation(),window.confirm("Are you sure you want to permanently delete this customer? This action cannot be undone."))try{await E.m.deleteCustomer(s);const e=await E.m.getAllCustomers();t(e.data||[]),X({open:!0,message:"Customer permanently deleted",severity:"success"})}catch(n){console.error("Error deleting customer:",n),X({open:!0,message:"Error deleting customer. Please try again.",severity:"error"});const e=await E.m.getAllCustomers();t(e.data||[])}},[t,X]);return(0,M.jsxs)(o.A,{maxWidth:"lg",children:[(0,M.jsxs)(l.A,{sx:{mt:4,mb:4},children:[(0,M.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,M.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,M.jsx)(i.A,{variant:"h4",gutterBottom:!0,children:"Customers"}),(0,M.jsx)(c.A,{variant:"contained",color:"primary",onClick:ie,children:"Add New Customer"})]}),(0,M.jsx)(a.A,{fullWidth:!0,placeholder:"Search by customer name, email, phone, or pet name...",value:q,onChange:e=>H(e.target.value.toLowerCase()),InputProps:{startAdornment:(0,M.jsx)(d.A,{position:"start",children:(0,M.jsx)(w.A,{})})}}),(0,M.jsxs)(l.A,{children:[(0,M.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[(0,M.jsxs)(c.A,{size:"small",startIcon:(0,M.jsx)(D.A,{}),onClick:()=>T(!R),variant:K.length>0?"contained":"outlined",children:["Filter by Icons ",K.length>0&&"(".concat(K.length,")")]}),K.length>0&&(0,M.jsx)(c.A,{size:"small",startIcon:(0,M.jsx)(F.A,{}),onClick:()=>Q([]),color:"secondary",children:"Clear Filters"})]}),(0,M.jsx)(P.A,{in:R,children:(0,M.jsxs)(u.A,{sx:{p:2,mb:2},children:[(0,M.jsx)(i.A,{variant:"subtitle2",gutterBottom:!0,children:"Select icons to filter customers (customers must have ALL selected icons):"}),(0,M.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:W.KQ.map(e=>{const s=K.includes(e.id);return(0,M.jsx)(B.A,{label:(0,M.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,M.jsx)("span",{style:{fontSize:"1rem"},children:e.icon}),(0,M.jsx)(i.A,{variant:"caption",children:e.label})]}),onClick:()=>{Q(s?K.filter(s=>s!==e.id):[...K,e.id])},color:s?"primary":"default",variant:s?"filled":"outlined",sx:{cursor:"pointer","&:hover":{transform:"scale(1.05)"},transition:"transform 0.2s"}},e.id)})})]})}),K.length>0&&!R&&(0,M.jsxs)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[(0,M.jsx)(i.A,{variant:"caption",color:"text.secondary",sx:{mr:1,alignSelf:"center"},children:"Active filters:"}),K.map(e=>{const s=(0,W.k0)(e);return s?(0,M.jsx)(B.A,{label:(0,M.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,M.jsx)("span",{style:{fontSize:"0.9rem"},children:s.icon}),(0,M.jsx)(i.A,{variant:"caption",children:s.label})]}),size:"small",onDelete:()=>Q(K.filter(s=>s!==e)),color:"primary"},e):null})]})]})]}),J&&(0,M.jsx)(m.A,{severity:"error",sx:{mb:2},children:J}),Z?(0,M.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,M.jsx)(x.A,{})}):(0,M.jsx)(h.A,{component:u.A,children:(0,M.jsxs)(A.A,{children:[(0,M.jsx)(p.A,{children:(0,M.jsxs)(j.A,{children:[(0,M.jsx)(g.A,{width:"60",children:"Icon"}),(0,M.jsx)(g.A,{children:"Name"}),(0,M.jsx)(g.A,{children:"Email"}),(0,M.jsx)(g.A,{children:"Phone"}),(0,M.jsx)(g.A,{children:"City"}),(0,M.jsx)(g.A,{children:"State"}),(0,M.jsx)(g.A,{align:"right",children:"Actions"})]})}),(0,M.jsxs)(f.A,{children:[I.map(s=>{var t;return(0,M.jsxs)(j.A,{sx:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[q&&(null===(t=s.pets)||void 0===t?void 0:t.some(e=>e.name.toLowerCase().includes(q.toLowerCase())))&&(0,M.jsx)(g.A,{colSpan:7,sx:{p:0,borderBottom:"none"},children:(0,M.jsxs)(l.A,{sx:{backgroundColor:"#e3f2fd",p:1,m:1,borderRadius:1},children:["Matching pets: ",s.pets.filter(e=>e.name.toLowerCase().includes(q.toLowerCase())).map(e=>e.name).join(", ")]})}),(0,M.jsx)(g.A,{onClick:e=>ae(e,s),sx:{cursor:"pointer",minWidth:120},children:s.customerIcons&&s.customerIcons.length>0?(0,M.jsx)(L.A,{icons:s.customerIcons,maxDisplay:3,size:"small"}):(0,M.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"Click to add"})}),"                    ",(0,M.jsx)(g.A,{onClick:()=>ce(s.id),sx:{cursor:"pointer"},children:"".concat(s.firstName," ").concat(s.lastName)}),(0,M.jsx)(g.A,{onClick:()=>ce(s.id),sx:{cursor:"pointer"},children:s.email}),(0,M.jsx)(g.A,{onClick:()=>ce(s.id),sx:{cursor:"pointer"},children:s.phone}),(0,M.jsx)(g.A,{onClick:()=>ce(s.id),sx:{cursor:"pointer"},children:s.city}),(0,M.jsx)(g.A,{onClick:()=>ce(s.id),sx:{cursor:"pointer"},children:s.state}),(0,M.jsx)(g.A,{align:"right",children:(0,M.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,M.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>e("/customers/".concat(s.id)),children:"Edit"}),(0,M.jsx)(c.A,{variant:"outlined",color:"error",size:"small",onClick:e=>ue(e,s.id),children:"Delete"})]})})]},s.id)}),0===I.length&&(0,M.jsx)(j.A,{children:(0,M.jsx)(g.A,{colSpan:5,align:"center",children:"No customers found"})})]})]})})]}),ee&&(0,M.jsxs)(C.A,{open:Y,onClose:()=>{de(te,re),$(!1),se(null)},maxWidth:"md",fullWidth:!0,children:[(0,M.jsxs)(y.A,{children:["Manage Icons for ",ee.firstName," ",ee.lastName]}),(0,M.jsx)(v.A,{children:(0,M.jsx)(z.A,{selectedIcons:te,iconNotes:re,onChange:(e,s)=>{ne(e),oe(s)}})}),(0,M.jsxs)(b.A,{children:[(0,M.jsx)(c.A,{onClick:()=>{$(!1),se(null)},children:"Cancel"}),(0,M.jsx)(c.A,{onClick:()=>{de(te,re),$(!1),se(null)},variant:"contained",children:"Save"})]})]}),(0,M.jsx)(k.A,{open:V.open,autoHideDuration:6e3,onClose:()=>X(e=>(0,n.A)((0,n.A)({},e),{},{open:!1})),children:(0,M.jsx)(m.A,{onClose:()=>X(e=>(0,n.A)((0,n.A)({},e),{},{open:!1})),severity:V.severity,sx:{width:"100%"},children:V.message})})]})}}}]);