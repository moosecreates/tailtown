"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[9127],{19127:(e,t,r)=>{r.r(t),r.d(t,{default:()=>O});var n=r(89379),s=r(9950),a=r(62999),i=r(78317),o=r(82053),c=r(10226),l=r(2235),d=r(60899),u=r(8145),A=r(2046),h=r(25979),x=r(19647),g=r(70006),j=r(23266),v=r(69019),y=r(84142),m=r(1320),p=r(15769),S=r(69780),k=r(9213),f=r(21671),C=r(34075),b=r(25277),I=r(25333),w=r(96583),P=r(40033),T=r(28170),E=r(16497),W=r(93038),F=r(79739),q=r(65429),N=r(98785),z=r(53256),_=r(20760),U=r(40379),D=r(2507),L=r(49715),Q=r(95699),R=r(44414);const O=()=>{const[e,t]=(0,s.useState)([]),[r,O]=(0,s.useState)([]),[J,M]=(0,s.useState)([]),[K,$]=(0,s.useState)(""),[H,G]=(0,s.useState)("all"),[B,V]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(null),[Z,ee]=(0,s.useState)(0),[te,re]=(0,s.useState)({open:!1,message:"",severity:"success"}),[ne,se]=(0,s.useState)(!1),[ae,ie]=(0,s.useState)(null),[oe,ce]=(0,s.useState)({quantity:"",changeType:"ADJUSTMENT",reason:""}),[le,de]=(0,s.useState)({sku:"",name:"",description:"",categoryId:"",price:"",cost:"",taxable:!0,trackInventory:!0,currentStock:"0",lowStockAlert:"",reorderPoint:"",reorderQuantity:"",isService:!1,isPackage:!1,isFeatured:!1});(0,s.useEffect)(()=>{Ae(),he()},[]),(0,s.useEffect)(()=>{xe()},[e,K,H,Z]);const ue=()=>window.location.origin,Ae=async()=>{try{const e=ue(),r=localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev",n=await fetch("".concat(e,"/api/products"),{headers:{"x-tenant-id":r}}),s=await n.json();"success"===s.status&&t(s.data)}catch(e){console.error("Error loading products:",e)}},he=async()=>{try{const e=ue(),t=localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev",r=await fetch("".concat(e,"/api/products/categories"),{headers:{"x-tenant-id":t}}),n=await r.json();"success"===n.status&&O(n.data)}catch(e){console.error("Error loading categories:",e)}},xe=()=>{let t=e;if(1===Z&&(t=t.filter(e=>!e.isService&&!e.isPackage)),2===Z&&(t=t.filter(e=>e.isService)),3===Z&&(t=t.filter(e=>e.isPackage)),"all"!==H&&(t=t.filter(e=>e.categoryId===H)),K){const e=K.toLowerCase();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.sku&&t.sku.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}M(t)},ge=e=>{var t,r;e?(Y(e),de({sku:e.sku||"",name:e.name,description:e.description||"",categoryId:e.categoryId||"",price:e.price.toString(),cost:(null===(t=e.cost)||void 0===t?void 0:t.toString())||"",taxable:e.taxable,trackInventory:e.trackInventory,currentStock:e.currentStock.toString(),lowStockAlert:(null===(r=e.lowStockAlert)||void 0===r?void 0:r.toString())||"",reorderPoint:"",reorderQuantity:"",isService:e.isService,isPackage:e.isPackage,isFeatured:e.isFeatured})):(Y(null),de({sku:"",name:"",description:"",categoryId:"",price:"",cost:"",taxable:!0,trackInventory:!0,currentStock:"0",lowStockAlert:"",reorderPoint:"",reorderQuantity:"",isService:!1,isPackage:!1,isFeatured:!1}));V(!0)},je=()=>{V(!1),Y(null)},ve=e=>!(!e.trackInventory||e.isService)&&(e.lowStockAlert?e.currentStock<=e.lowStockAlert:0===e.currentStock),ye=()=>{se(!1),ie(null)};return(0,R.jsx)(a.A,{maxWidth:"xl",children:(0,R.jsxs)(i.A,{sx:{mt:4,mb:4},children:[(0,R.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,R.jsx)(o.A,{variant:"h4",children:"Products & Inventory"}),(0,R.jsx)(c.A,{variant:"contained",startIcon:(0,R.jsx)(z.A,{}),onClick:()=>ge(),children:"Add Product"})]}),(0,R.jsx)(l.A,{sx:{p:2,mb:3},children:(0,R.jsxs)(d.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,R.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,R.jsx)(u.A,{fullWidth:!0,placeholder:"Search products...",value:K,onChange:e=>$(e.target.value),InputProps:{startAdornment:(0,R.jsx)(A.A,{position:"start",children:(0,R.jsx)(L.A,{})})}})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,R.jsxs)(h.A,{fullWidth:!0,children:[(0,R.jsx)(x.A,{children:"Category"}),(0,R.jsxs)(g.A,{value:H,onChange:e=>G(e.target.value),label:"Category",children:[(0,R.jsx)(j.A,{value:"all",children:"All Categories"}),r.map(e=>(0,R.jsx)(j.A,{value:e.id,children:e.name},e.id))]})]})})]})}),(0,R.jsxs)(v.A,{value:Z,onChange:(e,t)=>ee(t),sx:{mb:2},children:[(0,R.jsx)(y.A,{label:"All (".concat(e.length,")")}),(0,R.jsx)(y.A,{label:"Physical Products (".concat(e.filter(e=>!e.isService&&!e.isPackage).length,")")}),(0,R.jsx)(y.A,{label:"Services (".concat(e.filter(e=>e.isService).length,")")}),(0,R.jsx)(y.A,{label:"Packages (".concat(e.filter(e=>e.isPackage).length,")")})]}),(0,R.jsx)(m.A,{component:l.A,children:(0,R.jsxs)(p.A,{children:[(0,R.jsx)(S.A,{children:(0,R.jsxs)(k.A,{children:[(0,R.jsx)(f.A,{children:"SKU"}),(0,R.jsx)(f.A,{children:"Name"}),(0,R.jsx)(f.A,{children:"Category"}),(0,R.jsx)(f.A,{align:"right",children:"Price"}),(0,R.jsx)(f.A,{align:"center",children:"Stock"}),(0,R.jsx)(f.A,{children:"Type"}),(0,R.jsx)(f.A,{children:"Status"}),(0,R.jsx)(f.A,{align:"right",children:"Actions"})]})}),(0,R.jsxs)(C.A,{children:[J.map(e=>{var t;return(0,R.jsxs)(k.A,{sx:{"&:hover":{bgcolor:"action.hover"}},children:[(0,R.jsx)(f.A,{children:e.sku||"-"}),(0,R.jsx)(f.A,{children:(0,R.jsxs)(i.A,{children:[(0,R.jsx)(o.A,{variant:"body2",fontWeight:"medium",children:e.name}),e.description&&(0,R.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:[e.description.substring(0,50),"..."]})]})}),(0,R.jsx)(f.A,{children:(null===(t=e.category)||void 0===t?void 0:t.name)||"-"}),(0,R.jsxs)(f.A,{align:"right",children:["$",Number(e.price).toFixed(2)]}),(0,R.jsx)(f.A,{align:"center",children:e.trackInventory&&!e.isService?(0,R.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:.5},children:[ve(e)&&(0,R.jsx)(Q.A,{color:"warning",fontSize:"small"}),(0,R.jsx)(o.A,{variant:"body2",color:ve(e)?"warning.main":"inherit",children:e.currentStock})]}):"-"}),(0,R.jsxs)(f.A,{children:[e.isService&&(0,R.jsx)(b.A,{label:"Service",size:"small",color:"info"}),e.isPackage&&(0,R.jsx)(b.A,{label:"Package",size:"small",color:"secondary"}),!e.isService&&!e.isPackage&&(0,R.jsx)(b.A,{label:"Product",size:"small"})]}),(0,R.jsxs)(f.A,{children:[e.isFeatured&&(0,R.jsx)(b.A,{label:"Featured",size:"small",color:"primary",sx:{mr:.5}}),(0,R.jsx)(b.A,{label:e.isActive?"Active":"Inactive",size:"small",color:e.isActive?"success":"default"})]}),(0,R.jsxs)(f.A,{align:"right",children:[e.trackInventory&&!e.isService&&(0,R.jsx)(I.A,{size:"small",color:"primary",onClick:()=>(e=>{ie(e),ce({quantity:"",changeType:"ADJUSTMENT",reason:""}),se(!0)})(e),title:"Adjust Inventory",children:(0,R.jsx)(D.A,{fontSize:"small"})}),(0,R.jsx)(I.A,{size:"small",onClick:()=>ge(e),children:(0,R.jsx)(U.A,{fontSize:"small"})}),(0,R.jsx)(I.A,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this product?"))try{const t=ue();if(!(await fetch("".concat(t,"/api/products/").concat(e),{method:"DELETE",headers:{"x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"}})).ok)throw new Error("Failed to delete product");re({open:!0,message:"Product deleted!",severity:"success"}),Ae()}catch(t){console.error("Error deleting product:",t),re({open:!0,message:"Failed to delete product",severity:"error"})}})(e.id),children:(0,R.jsx)(_.A,{fontSize:"small"})})]})]},e.id)}),0===J.length&&(0,R.jsx)(k.A,{children:(0,R.jsx)(f.A,{colSpan:8,align:"center",sx:{py:4},children:(0,R.jsx)(o.A,{color:"text.secondary",children:"No products found"})})})]})]})}),(0,R.jsxs)(w.A,{open:B,onClose:je,maxWidth:"md",fullWidth:!0,children:[(0,R.jsx)(P.A,{children:X?"Edit Product":"Add Product"}),(0,R.jsx)(T.A,{children:(0,R.jsxs)(d.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Product Name",value:le.name,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{name:e.target.value})),required:!0})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"SKU",value:le.sku,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{sku:e.target.value}))})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Description",value:le.description,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{description:e.target.value})),multiline:!0,rows:2})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsxs)(h.A,{fullWidth:!0,children:[(0,R.jsx)(x.A,{children:"Category"}),(0,R.jsxs)(g.A,{value:le.categoryId,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{categoryId:e.target.value})),label:"Category",children:[(0,R.jsx)(j.A,{value:"",children:"None"}),r.map(e=>(0,R.jsx)(j.A,{value:e.id,children:e.name},e.id))]})]})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Price",type:"number",value:le.price,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{price:e.target.value})),required:!0,InputProps:{startAdornment:(0,R.jsx)(A.A,{position:"start",children:"$"})}})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Cost",type:"number",value:le.cost,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{cost:e.target.value})),InputProps:{startAdornment:(0,R.jsx)(A.A,{position:"start",children:"$"})}})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Current Stock",type:"number",value:le.currentStock,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{currentStock:e.target.value})),disabled:le.isService||!le.trackInventory})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Low Stock Alert",type:"number",value:le.lowStockAlert,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{lowStockAlert:e.target.value})),disabled:le.isService||!le.trackInventory})}),(0,R.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,R.jsx)(E.A,{control:(0,R.jsx)(W.A,{checked:le.taxable,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{taxable:e.target.checked}))}),label:"Taxable"}),(0,R.jsx)(E.A,{control:(0,R.jsx)(W.A,{checked:le.trackInventory,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{trackInventory:e.target.checked})),disabled:le.isService}),label:"Track Inventory"}),(0,R.jsx)(E.A,{control:(0,R.jsx)(W.A,{checked:le.isService,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{isService:e.target.checked,trackInventory:!e.target.checked}))}),label:"Service (no inventory)"}),(0,R.jsx)(E.A,{control:(0,R.jsx)(W.A,{checked:le.isFeatured,onChange:e=>de((0,n.A)((0,n.A)({},le),{},{isFeatured:e.target.checked}))}),label:"Featured"})]})]})}),(0,R.jsxs)(F.A,{children:[(0,R.jsx)(c.A,{onClick:je,children:"Cancel"}),(0,R.jsx)(c.A,{onClick:async()=>{if(le.name&&le.price)try{const e=ue(),t=X?"".concat(e,"/api/products/").concat(X.id):"".concat(e,"/api/products");if(!(await fetch(t,{method:X?"PUT":"POST",headers:{"Content-Type":"application/json","x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"},body:JSON.stringify((0,n.A)((0,n.A)({},le),{},{price:parseFloat(le.price),cost:le.cost?parseFloat(le.cost):void 0,currentStock:parseInt(le.currentStock),lowStockAlert:le.lowStockAlert?parseInt(le.lowStockAlert):void 0,reorderPoint:le.reorderPoint?parseInt(le.reorderPoint):void 0,reorderQuantity:le.reorderQuantity?parseInt(le.reorderQuantity):void 0}))})).ok)throw new Error("Failed to save product");re({open:!0,message:X?"Product updated!":"Product created!",severity:"success"}),je(),Ae()}catch(e){console.error("Error saving product:",e),re({open:!0,message:"Failed to save product",severity:"error"})}else re({open:!0,message:"Name and price are required",severity:"error"})},variant:"contained",children:X?"Update":"Create"})]})]}),(0,R.jsxs)(w.A,{open:ne,onClose:ye,maxWidth:"sm",fullWidth:!0,children:[(0,R.jsxs)(P.A,{children:["Adjust Inventory - ",null===ae||void 0===ae?void 0:ae.name]}),(0,R.jsx)(T.A,{children:(0,R.jsxs)(i.A,{sx:{mt:2},children:[(0,R.jsxs)(q.A,{severity:"info",sx:{mb:2},children:["Current Stock: ",(0,R.jsx)("strong",{children:(null===ae||void 0===ae?void 0:ae.currentStock)||0})]}),(0,R.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,R.jsx)(d.Ay,{item:!0,xs:12,children:(0,R.jsxs)(h.A,{fullWidth:!0,children:[(0,R.jsx)(x.A,{children:"Change Type"}),(0,R.jsxs)(g.A,{value:oe.changeType,onChange:e=>ce((0,n.A)((0,n.A)({},oe),{},{changeType:e.target.value})),label:"Change Type",children:[(0,R.jsx)(j.A,{value:"PURCHASE",children:"Purchase (Add Stock)"}),(0,R.jsx)(j.A,{value:"SALE",children:"Sale (Remove Stock)"}),(0,R.jsx)(j.A,{value:"ADJUSTMENT",children:"Manual Adjustment"}),(0,R.jsx)(j.A,{value:"RETURN",children:"Customer Return"}),(0,R.jsx)(j.A,{value:"DAMAGE",children:"Damaged/Lost"}),(0,R.jsx)(j.A,{value:"RESTOCK",children:"Restock"})]})]})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Quantity",type:"number",value:oe.quantity,onChange:e=>ce((0,n.A)((0,n.A)({},oe),{},{quantity:e.target.value})),helperText:"Use negative numbers to decrease stock (e.g., -5 for removing 5 items)",required:!0})}),(0,R.jsx)(d.Ay,{item:!0,xs:12,children:(0,R.jsx)(u.A,{fullWidth:!0,label:"Reason (Optional)",value:oe.reason,onChange:e=>ce((0,n.A)((0,n.A)({},oe),{},{reason:e.target.value})),multiline:!0,rows:2,placeholder:"Enter reason for adjustment..."})}),oe.quantity&&(0,R.jsx)(d.Ay,{item:!0,xs:12,children:(0,R.jsxs)(q.A,{severity:parseInt(oe.quantity)>=0?"success":"warning",children:["New Stock: ",(0,R.jsx)("strong",{children:((null===ae||void 0===ae?void 0:ae.currentStock)||0)+parseInt(oe.quantity||"0")})]})})]})]})}),(0,R.jsxs)(F.A,{children:[(0,R.jsx)(c.A,{onClick:ye,children:"Cancel"}),(0,R.jsx)(c.A,{onClick:async()=>{if(ae&&oe.quantity)try{const e=ue(),t=await fetch("".concat(e,"/api/products/").concat(ae.id,"/inventory/adjust"),{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"},body:JSON.stringify({quantity:parseInt(oe.quantity),changeType:oe.changeType,reason:oe.reason||void 0})});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to adjust inventory")}re({open:!0,message:"Inventory adjusted successfully!",severity:"success"}),ye(),Ae()}catch(e){console.error("Error adjusting inventory:",e),re({open:!0,message:e.message||"Failed to adjust inventory",severity:"error"})}else re({open:!0,message:"Quantity is required",severity:"error"})},variant:"contained",color:"primary",children:"Adjust Inventory"})]})]}),(0,R.jsx)(N.A,{open:te.open,autoHideDuration:4e3,onClose:()=>re((0,n.A)((0,n.A)({},te),{},{open:!1})),children:(0,R.jsx)(q.A,{severity:te.severity,onClose:()=>re((0,n.A)((0,n.A)({},te),{},{open:!1})),children:te.message})})]})})}}}]);