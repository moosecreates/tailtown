"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[9212],{99212:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ue});var n=t(89379),i=t(80045),r=t(9950),l=t(78317),a=t(62999),c=t(46639),o=t(2235),d=t(60899),x=t(8145),h=t(82053),u=t(10226),A=t(2046),j=t(249),m=t(26050),p=t(83563),y=t(71378),v=t(25333),g=t(69019),b=t(84142),C=t(96583),f=t(40033),I=t(28170),D=t(79739),S=t(98785),w=t(65429),N=t(19223),P=t(7999),E=t(99532),k=t(82570),B=t(6565),M=t(34879),R=t(28429),W=t(89007),L=t(74745),F=t(1320),z=t(15769),T=t(69780),q=t(9213),_=t(21671),U=t(34075),H=t(25277),O=t(23266),G=t(43974),$=t(69179),K=t(44414);const V=e=>{var s,t,n,i;let{open:a,onClose:x,invoice:A}=e;const[j,m]=(0,r.useState)(null),[p,y]=(0,r.useState)(!1),[v,g]=(0,r.useState)(null);if((0,r.useEffect)(()=>{if(m(null),g(null),A&&A.reservationId&&a){(async()=>{try{y(!0);const e=A.reservationId,s=await $.u.getReservationById(e);m(s)}catch(e){console.error("Error fetching reservation:",e),g("Failed to load reservation details")}finally{y(!1)}})()}else y(!1)},[A,a]),!A)return null;(null===j||void 0===j||null===(s=j.service)||void 0===s?void 0:s.name)||A.lineItems&&A.lineItems.length>0&&A.lineItems[0].description;const b=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),f=(null===(t=A.payments)||void 0===t?void 0:t.reduce((e,s)=>"PAID"===s.status?e+s.amount:e,0))||0,S=A.total-f;return(0,K.jsxs)(C.A,{open:a,onClose:x,maxWidth:"md",fullWidth:!0,children:[(0,K.jsxs)(l.A,{sx:{px:3,pt:2,pb:1},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[(0,K.jsxs)("div",{children:[(0,K.jsxs)(h.A,{variant:"h6",children:["Invoice ",A.invoiceNumber]}),(0,K.jsxs)(h.A,{variant:"subtitle2",color:"text.secondary",children:["Issued: ",(0,G.A)(new Date(A.issueDate||new Date),"MMMM d, yyyy")]})]}),(0,K.jsx)(H.A,{label:A.status,color:(e=>{switch(e){case"PAID":return"success";case"OVERDUE":case"CANCELLED":return"error";case"DRAFT":default:return"default";case"SENT":return"primary"}})(A.status),size:"small"})]}),p&&(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",mt:1},children:[(0,K.jsx)(c.A,{size:20,sx:{mr:1}}),(0,K.jsx)(h.A,{variant:"body2",children:"Loading reservation details..."})]}),v&&(0,K.jsx)(h.A,{variant:"body2",color:"error",sx:{mt:1},children:v})]}),(0,K.jsx)(I.A,{children:(0,K.jsxs)(d.Ay,{container:!0,spacing:3,children:[(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Invoice Date"}),(0,K.jsx)(h.A,{variant:"body1",children:(0,G.A)(new Date(A.issueDate||new Date),"MM/dd/yyyy")})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Due Date"}),(0,K.jsx)(h.A,{variant:"body1",children:(0,G.A)(new Date(A.dueDate),"MM/dd/yyyy")})]}),A.reservation&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,K.jsx)(L.A,{sx:{my:1}}),(0,K.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:"Reservation Details"})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Service"}),(0,K.jsx)(h.A,{variant:"body1",children:(null===(n=A.reservation.service)||void 0===n?void 0:n.name)||"N/A"})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Pet"}),(0,K.jsx)(h.A,{variant:"body1",children:(null===(i=A.reservation.pet)||void 0===i?void 0:i.name)||"N/A"})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Start Date"}),(0,K.jsx)(h.A,{variant:"body1",children:A.reservation.startDate?(0,G.A)(new Date(A.reservation.startDate),"MM/dd/yyyy"):"N/A"})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,md:6,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"End Date"}),(0,K.jsx)(h.A,{variant:"body1",children:A.reservation.endDate?(0,G.A)(new Date(A.reservation.endDate),"MM/dd/yyyy"):"N/A"})]})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,K.jsx)(L.A,{sx:{my:1}}),(0,K.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:"Line Items"})]}),(0,K.jsx)(d.Ay,{item:!0,xs:12,children:(0,K.jsx)(F.A,{component:o.A,variant:"outlined",children:(0,K.jsxs)(z.A,{size:"small",children:[(0,K.jsx)(T.A,{children:(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:"Description"}),(0,K.jsx)(_.A,{align:"right",children:"Quantity"}),(0,K.jsx)(_.A,{align:"right",children:"Price"}),(0,K.jsx)(_.A,{align:"right",children:"Total"})]})}),(0,K.jsx)(U.A,{children:(()=>{const e=[];return A.lineItems&&A.lineItems.length>0?A.lineItems.forEach((s,t)=>{let n=s.description;if(0===t&&("Service"===s.description||"Reservation Service"===s.description))if(j&&j.service&&j.service.name)n=j.service.name;else if(j&&j.serviceId){const e=j.serviceId.split("-");e.length>0&&(n=e.map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "))}e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:n}),(0,K.jsx)(_.A,{align:"right",children:s.quantity}),(0,K.jsx)(_.A,{align:"right",children:b(s.unitPrice)}),(0,K.jsx)(_.A,{align:"right",children:b(s.amount)})]},"item-".concat(t)))}):e.push((0,K.jsx)(q.A,{children:(0,K.jsx)(_.A,{colSpan:4,align:"center",children:"No line items available"})},"no-items")),e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{colSpan:3,align:"right",children:(0,K.jsx)("strong",{children:"Subtotal"})}),(0,K.jsx)(_.A,{align:"right",children:b(A.subtotal)})]},"subtotal")),e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{colSpan:3,align:"right",children:(0,K.jsx)(h.A,{variant:"subtitle2",color:A.discount&&A.discount>0?"error":"text.secondary",children:"Discount"})}),(0,K.jsx)(_.A,{align:"right",children:(0,K.jsx)(h.A,{color:A.discount&&A.discount>0?"error":"text.secondary",children:A.discount&&A.discount>0?"-".concat(b(A.discount)):b(0)})})]},"discount")),e.push((0,K.jsxs)(q.A,{children:[(0,K.jsxs)(_.A,{colSpan:3,align:"right",children:["Tax (",(A.taxRate?100*A.taxRate:0).toFixed(2),"%)"]}),(0,K.jsx)(_.A,{align:"right",children:b(A.taxAmount||0)})]},"tax")),e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{colSpan:3,align:"right",children:(0,K.jsx)("strong",{children:"Total"})}),(0,K.jsx)(_.A,{align:"right",children:(0,K.jsx)("strong",{children:b(A.total)})})]},"total")),f>0&&e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{colSpan:3,align:"right",children:"Paid"}),(0,K.jsxs)(_.A,{align:"right",children:["-",b(f)]})]},"paid")),e.push((0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{colSpan:3,align:"right",children:(0,K.jsx)("strong",{children:"Balance Due"})}),(0,K.jsx)(_.A,{align:"right",children:(0,K.jsx)("strong",{children:b(S)})})]},"balance")),e})()})]})})}),A.notes&&(0,K.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"textSecondary",children:"Notes"}),(0,K.jsx)(h.A,{variant:"body2",children:A.notes})]}),A.payments&&A.payments.length>0&&(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,K.jsx)(L.A,{sx:{my:1}}),(0,K.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:"Payment History"})]}),(0,K.jsx)(d.Ay,{item:!0,xs:12,children:(0,K.jsx)(F.A,{component:o.A,variant:"outlined",children:(0,K.jsxs)(z.A,{size:"small",children:[(0,K.jsx)(T.A,{children:(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:"Date"}),(0,K.jsx)(_.A,{children:"Method"}),(0,K.jsx)(_.A,{align:"right",children:"Amount"}),(0,K.jsx)(_.A,{children:"Status"})]})}),(0,K.jsx)(U.A,{children:A.payments&&0!==A.payments.length?A.payments.map((e,s)=>(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:e.paymentDate?(0,G.A)(new Date(e.paymentDate),"MM/dd/yyyy"):"N/A"}),(0,K.jsx)(_.A,{children:e.method}),(0,K.jsx)(_.A,{align:"right",children:b(e.amount)}),(0,K.jsx)(_.A,{children:(0,K.jsx)(H.A,{label:e.status,color:"PAID"===e.status?"success":"default",size:"small"})})]},"payment-".concat(s))):[(0,K.jsx)(q.A,{children:(0,K.jsx)(_.A,{colSpan:4,align:"center",children:"No payment records found"})},"no-payments")]})]})})})]})]})}),(0,K.jsx)(D.A,{children:(0,K.jsx)(u.A,{onClick:x,children:"Close"})})]})};var Z=t(93182),Q=t(68515),Y=t(85625),J=t(29156),X=t(53256),ee=t(51506),se=t(71812),te=t(45295);const ne=["children","value","index"];function ie(e){const{children:s,value:t,index:r}=e,a=(0,i.A)(e,ne);return(0,K.jsx)("div",(0,n.A)((0,n.A)({role:"tabpanel",hidden:t!==r,id:"account-tabpanel-".concat(r),"aria-labelledby":"account-tab-".concat(r)},a),{},{children:t===r&&(0,K.jsx)(l.A,{sx:{p:3},children:s})}))}const re=e=>{let{customerId:s,onInvoiceCreated:t}=e;const[n,i]=(0,r.useState)(0),[a,A]=(0,r.useState)(!0),[j,m]=(0,r.useState)(null),[p,y]=(0,r.useState)([]),[v,S]=(0,r.useState)([]),[N,P]=(0,r.useState)(null),[E,k]=(0,r.useState)(!1),[B,M]=(0,r.useState)(!1),[R,W]=(0,r.useState)(!1),[$,ne]=(0,r.useState)(!1),[re,le]=(0,r.useState)(null),[ae,ce]=(0,r.useState)(""),[oe,de]=(0,r.useState)(""),[xe,he]=(0,r.useState)("CREDIT_CARD"),[ue,Ae]=(0,r.useState)(""),[je,me]=(0,r.useState)(""),[pe,ye]=(0,r.useState)(""),[ve,ge]=(0,r.useState)(""),be=(0,r.useCallback)(async()=>{try{A(!0),m(null);const[e,t,n]=await Promise.all([se.p.getCustomerInvoices(s),te.M.getCustomerPayments(s),se.p.getCustomerAccountBalance(s)]);y(e),S(t),P(n)}catch(e){console.error("Error fetching account data:",e),m(e.message||"Failed to load account data")}finally{A(!1)}},[s]);(0,r.useEffect)(()=>{s&&be()},[s,be]);const Ce=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),fe=e=>{switch(e){case"PAID":return"success";case"OVERDUE":case"CANCELLED":return"error";case"DRAFT":default:return"default";case"SENT":return"primary"}},Ie=e=>{switch(e){case"PAID":return"success";case"PENDING":return"warning";case"FAILED":return"error";case"REFUNDED":case"PARTIALLY_REFUNDED":return"info";default:return"default"}};return a?(0,K.jsx)(c.A,{}):(0,K.jsxs)(l.A,{sx:{width:"100%"},children:[j&&(0,K.jsx)(w.A,{severity:"error",sx:{mb:2},children:j}),(0,K.jsx)(l.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,K.jsxs)(g.A,{value:n,onChange:(e,s)=>{i(s)},"aria-label":"account history tabs",variant:"scrollable",scrollButtons:"auto",children:[(0,K.jsx)(b.A,{icon:(0,K.jsx)(Z.A,{}),iconPosition:"start",label:"Account Summary"}),(0,K.jsx)(b.A,{icon:(0,K.jsx)(Q.A,{}),iconPosition:"start",label:"Invoices"}),(0,K.jsx)(b.A,{icon:(0,K.jsx)(Y.A,{}),iconPosition:"start",label:"Payments"}),(0,K.jsx)(b.A,{icon:(0,K.jsx)(J.A,{}),iconPosition:"start",label:"Store Credit"})]})}),(0,K.jsxs)(ie,{value:n,index:0,children:[(0,K.jsxs)(o.A,{elevation:3,sx:{p:3,mb:2},children:[(0,K.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:"Account Balance"}),(0,K.jsx)(L.A,{sx:{mb:2}}),N?(0,K.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,K.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,K.jsx)(h.A,{variant:"subtitle1",children:"Total Invoiced:"}),(0,K.jsx)(h.A,{variant:"h6",color:"text.secondary",children:Ce(N.totalInvoiced)})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,K.jsx)(h.A,{variant:"subtitle1",children:"Total Paid:"}),(0,K.jsx)(h.A,{variant:"h6",color:"text.secondary",children:Ce(N.totalPaid)})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,K.jsx)(h.A,{variant:"subtitle1",children:"Current Balance:"}),(0,K.jsxs)(h.A,{variant:"h6",color:N.accountBalance>0?"error.main":"success.main",children:[Ce(N.accountBalance),N.accountBalance>0&&" (Due)",N.accountBalance<0&&" (Overpaid)"]})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,sm:6,children:[(0,K.jsx)(h.A,{variant:"subtitle1",children:"Store Credit:"}),(0,K.jsx)(h.A,{variant:"h6",color:"primary.main",children:Ce(N.storeCredit)})]}),(0,K.jsxs)(d.Ay,{item:!0,xs:12,children:[(0,K.jsx)(h.A,{variant:"subtitle1",children:"Net Balance:"}),(0,K.jsxs)(h.A,{variant:"h4",color:N.netBalance>0?"error.main":"success.main",sx:{mt:1,fontWeight:"bold"},children:[Ce(N.netBalance),N.netBalance>0&&" (Customer Owes)",N.netBalance<0&&" (Store Credit)"]})]})]}):(0,K.jsx)(h.A,{children:"No balance information available"}),(0,K.jsx)(l.A,{sx:{mt:3,display:"flex",gap:2},children:(0,K.jsx)(u.A,{variant:"outlined",startIcon:(0,K.jsx)(Y.A,{}),onClick:()=>k(!0),disabled:0===p.length,children:"Record Payment"})})]}),(0,K.jsxs)(o.A,{elevation:3,sx:{p:3},children:[(0,K.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:"Store Credit"}),(0,K.jsx)(L.A,{sx:{mb:2}}),(0,K.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)(h.A,{variant:"h6",color:"primary.main",children:["Available: ",N?Ce(N.storeCredit):"$0.00"]}),(0,K.jsxs)(l.A,{children:[(0,K.jsx)(u.A,{variant:"outlined",startIcon:(0,K.jsx)(X.A,{}),onClick:()=>M(!0),sx:{mr:1},children:"Add Credit"}),(0,K.jsx)(u.A,{variant:"outlined",startIcon:(0,K.jsx)(ee.A,{}),onClick:()=>W(!0),disabled:!N||N.storeCredit<=0||0===p.length,children:"Apply Credit"})]})]})]})]}),(0,K.jsxs)(ie,{value:n,index:1,children:[(0,K.jsx)(l.A,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,K.jsx)(h.A,{variant:"h6",children:"Invoice History"})}),(0,K.jsx)(F.A,{component:o.A,children:(0,K.jsxs)(z.A,{children:[(0,K.jsx)(T.A,{children:(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:"Invoice #"}),(0,K.jsx)(_.A,{children:"Date"}),(0,K.jsx)(_.A,{children:"Due Date"}),(0,K.jsx)(_.A,{children:"Amount"}),(0,K.jsx)(_.A,{children:"Balance"}),(0,K.jsx)(_.A,{children:"Status"})]})}),(0,K.jsx)(U.A,{children:p.length>0?p.map(e=>{var s;const t=(null===(s=e.payments)||void 0===s?void 0:s.reduce((e,s)=>"PAID"===s.status?e+s.amount:e,0))||0,n=e.total-t;return(0,K.jsxs)(q.A,{hover:!0,onClick:()=>{le(e),ne(!0)},style:{cursor:"pointer"},children:[(0,K.jsx)(_.A,{children:e.invoiceNumber}),(0,K.jsx)(_.A,{children:(0,G.A)(new Date(e.issueDate||new Date),"MM/dd/yyyy")}),(0,K.jsx)(_.A,{children:(0,G.A)(new Date(e.dueDate),"MM/dd/yyyy")}),(0,K.jsx)(_.A,{children:Ce(e.total)}),(0,K.jsx)(_.A,{children:Ce(n)}),(0,K.jsx)(_.A,{children:(0,K.jsx)(H.A,{label:e.status,color:fe(e.status),size:"small"})})]},e.id)}):(0,K.jsx)(q.A,{children:(0,K.jsx)(_.A,{colSpan:6,align:"center",children:"No invoices found"})})})]})})]}),(0,K.jsxs)(ie,{value:n,index:2,children:[(0,K.jsxs)(l.A,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsx)(h.A,{variant:"h6",children:"Payment History"}),(0,K.jsx)(u.A,{variant:"contained",color:"primary",startIcon:(0,K.jsx)(X.A,{}),onClick:()=>k(!0),disabled:0===p.length,children:"Record Payment"})]}),(0,K.jsx)(F.A,{component:o.A,children:(0,K.jsxs)(z.A,{children:[(0,K.jsx)(T.A,{children:(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:"Date"}),(0,K.jsx)(_.A,{children:"Invoice #"}),(0,K.jsx)(_.A,{children:"Method"}),(0,K.jsx)(_.A,{children:"Amount"}),(0,K.jsx)(_.A,{children:"Status"}),(0,K.jsx)(_.A,{children:"Notes"})]})}),(0,K.jsx)(U.A,{children:v.length>0?v.map(e=>(0,K.jsxs)(q.A,{hover:!0,children:[(0,K.jsx)(_.A,{children:(0,G.A)(new Date(e.paymentDate||new Date),"MM/dd/yyyy")}),(0,K.jsx)(_.A,{children:e.invoiceId||"\u2014"}),(0,K.jsx)(_.A,{children:e.method.replace("_"," ")}),(0,K.jsx)(_.A,{children:Ce(e.amount)}),(0,K.jsx)(_.A,{children:(0,K.jsx)(H.A,{label:e.status,color:Ie(e.status),size:"small"})}),(0,K.jsx)(_.A,{children:e.notes||"\u2014"})]},e.id)):(0,K.jsx)(q.A,{children:(0,K.jsx)(_.A,{colSpan:6,align:"center",children:"No payments found"})})})]})})]}),(0,K.jsx)(ie,{value:n,index:3,children:(0,K.jsxs)(l.A,{sx:{mb:3},children:[(0,K.jsxs)(o.A,{elevation:3,sx:{p:3,mb:3},children:[(0,K.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:"Store Credit Balance"}),(0,K.jsx)(L.A,{sx:{mb:2}}),(0,K.jsx)(h.A,{variant:"h4",color:"primary.main",sx:{fontWeight:"bold"},children:N?Ce(N.storeCredit):"$0.00"}),(0,K.jsxs)(l.A,{sx:{mt:3,display:"flex",gap:2},children:[(0,K.jsx)(u.A,{variant:"contained",color:"primary",startIcon:(0,K.jsx)(X.A,{}),onClick:()=>M(!0),children:"Add Credit"}),(0,K.jsx)(u.A,{variant:"outlined",startIcon:(0,K.jsx)(ee.A,{}),onClick:()=>W(!0),disabled:!N||N.storeCredit<=0||0===p.length,children:"Apply to Invoice"})]})]}),(0,K.jsx)(h.A,{variant:"h6",sx:{mb:2},children:"Store Credit Transactions"}),(0,K.jsx)(F.A,{component:o.A,children:(0,K.jsxs)(z.A,{children:[(0,K.jsx)(T.A,{children:(0,K.jsxs)(q.A,{children:[(0,K.jsx)(_.A,{children:"Date"}),(0,K.jsx)(_.A,{children:"Type"}),(0,K.jsx)(_.A,{children:"Amount"}),(0,K.jsx)(_.A,{children:"Notes"})]})}),(0,K.jsx)(U.A,{children:v.filter(e=>"STORE_CREDIT"===e.method).length>0?v.filter(e=>"STORE_CREDIT"===e.method).map(e=>(0,K.jsxs)(q.A,{hover:!0,children:[(0,K.jsx)(_.A,{children:(0,G.A)(new Date(e.paymentDate||new Date),"MM/dd/yyyy")}),(0,K.jsx)(_.A,{children:e.amount>0?"Credit Added":"Credit Used"}),(0,K.jsx)(_.A,{children:Ce(Math.abs(e.amount))}),(0,K.jsx)(_.A,{children:e.notes||"\u2014"})]},e.id)):(0,K.jsx)(q.A,{children:(0,K.jsx)(_.A,{colSpan:4,align:"center",children:"No store credit transactions found"})})})]})})]})}),(0,K.jsxs)(C.A,{open:E,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[(0,K.jsx)(f.A,{children:"Record Payment"}),(0,K.jsx)(I.A,{children:(0,K.jsxs)(l.A,{component:"form",sx:{mt:1,display:"flex",flexDirection:"column",gap:2},children:[(0,K.jsx)(x.A,{select:!0,label:"Invoice",value:ae,onChange:e=>ce(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0},children:p.filter(e=>"PAID"!==e.status&&"CANCELLED"!==e.status).map(e=>(0,K.jsxs)(O.A,{value:e.id,children:[e.invoiceNumber," - ",Ce(e.total)]},e.id))}),(0,K.jsx)(x.A,{label:"Amount",type:"number",value:oe,onChange:e=>de(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0}}),(0,K.jsxs)(x.A,{select:!0,label:"Payment Method",value:xe,onChange:e=>he(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0},children:[(0,K.jsx)(O.A,{value:"CREDIT_CARD",children:"Credit Card"}),(0,K.jsx)(O.A,{value:"DEBIT_CARD",children:"Debit Card"}),(0,K.jsx)(O.A,{value:"CASH",children:"Cash"}),(0,K.jsx)(O.A,{value:"CHECK",children:"Check"}),(0,K.jsx)(O.A,{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,K.jsx)(O.A,{value:"GIFT_CARD",children:"Gift Card"})]}),(0,K.jsx)(x.A,{label:"Notes",multiline:!0,rows:2,value:ue,onChange:e=>Ae(e.target.value),fullWidth:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0}})]})}),(0,K.jsxs)(D.A,{children:[(0,K.jsx)(u.A,{onClick:()=>k(!1),children:"Cancel"}),(0,K.jsx)(u.A,{onClick:async()=>{try{if(!ae||!oe||!xe)return void m("Please fill out all required fields");await te.M.createPayment({invoiceId:ae,customerId:s,amount:parseFloat(oe),method:xe,status:"PAID",notes:ue}),k(!1),ce(""),de(""),he("CREDIT_CARD"),Ae(""),be()}catch(e){console.error("Error creating payment:",e),m(e.message||"Failed to process payment")}},variant:"contained",color:"primary",children:"Save Payment"})]})]}),(0,K.jsxs)(C.A,{open:B,onClose:()=>M(!1),maxWidth:"sm",fullWidth:!0,children:[(0,K.jsx)(f.A,{children:"Add Store Credit"}),(0,K.jsx)(I.A,{children:(0,K.jsxs)(l.A,{component:"form",sx:{mt:1,display:"flex",flexDirection:"column",gap:2},children:[(0,K.jsx)(x.A,{label:"Amount",type:"number",value:je,onChange:e=>me(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0}}),(0,K.jsx)(x.A,{label:"Reason",multiline:!0,rows:2,value:pe,onChange:e=>ye(e.target.value),fullWidth:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0},placeholder:"e.g., Refund for canceled service, Compensation for issue, etc."})]})}),(0,K.jsxs)(D.A,{children:[(0,K.jsx)(u.A,{onClick:()=>M(!1),children:"Cancel"}),(0,K.jsx)(u.A,{onClick:async()=>{try{if(!je)return void m("Please enter an amount");const e={customerId:s,amount:parseFloat(je),reason:pe};await te.M.recordStoreCredit(e),M(!1),me(""),ye(""),be()}catch(e){console.error("Error recording store credit:",e),m(e.message||"Failed to record store credit")}},variant:"contained",color:"primary",children:"Add Credit"})]})]}),(0,K.jsxs)(C.A,{open:R,onClose:()=>W(!1),maxWidth:"sm",fullWidth:!0,children:[(0,K.jsx)(f.A,{children:"Apply Store Credit"}),(0,K.jsx)(I.A,{children:(0,K.jsxs)(l.A,{component:"form",sx:{mt:1,display:"flex",flexDirection:"column",gap:2},children:[(0,K.jsxs)(h.A,{variant:"body1",gutterBottom:!0,children:["Available Credit: ",N?Ce(N.storeCredit):"$0.00"]}),(0,K.jsx)(x.A,{select:!0,label:"Invoice",value:ae,onChange:e=>ce(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0},children:p.filter(e=>"PAID"!==e.status&&"CANCELLED"!==e.status).map(e=>(0,K.jsxs)(O.A,{value:e.id,children:[e.invoiceNumber," - ",Ce(e.total)]},e.id))}),(0,K.jsx)(x.A,{label:"Amount to Apply",type:"number",value:ve,onChange:e=>ge(e.target.value),fullWidth:!0,required:!0,variant:"outlined",size:"small",InputLabelProps:{shrink:!0},inputProps:{max:(null===N||void 0===N?void 0:N.storeCredit)||0},helperText:"Maximum amount: ".concat(N?Ce(N.storeCredit):"$0.00")})]})}),(0,K.jsxs)(D.A,{children:[(0,K.jsx)(u.A,{onClick:()=>W(!1),children:"Cancel"}),(0,K.jsx)(u.A,{onClick:async()=>{try{if(!ae||!ve)return void m("Please fill out all required fields");const e={invoiceId:ae,customerId:s,amount:parseFloat(ve)};await te.M.applyStoreCredit(e),W(!1),ce(""),ge(""),be()}catch(e){console.error("Error applying store credit:",e),m(e.message||"Failed to apply store credit")}},variant:"contained",color:"primary",children:"Apply Credit"})]})]}),(0,K.jsx)(V,{open:$,onClose:()=>ne(!1),invoice:re})]})};var le=t(9540),ae=t(83274),ce=t(41223);const oe=e=>{let{iconIds:s,iconNotes:t={},maxDisplay:n=10,size:i="small"}=e;if(!s||0===s.length)return null;const r=s.slice(0,n),a=s.length-n;return(0,K.jsxs)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[r.map(e=>{const s=(0,ce.k0)(e);if(!s)return null;const n=t[e],r=n?"".concat(s.description,"\n\nNote: ").concat(t[e]):s.description;return(0,K.jsx)(ae.A,{title:r,arrow:!0,children:(0,K.jsx)(H.A,{label:(0,K.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,K.jsx)("span",{style:{fontSize:"small"===i?"0.9rem":"1.1rem"},children:s.icon}),(0,K.jsx)(h.A,{variant:"caption",sx:{fontSize:"small"===i?"0.7rem":"0.8rem"},children:s.label})]}),size:i,sx:{height:"small"===i?24:28,bgcolor:s.color?"".concat(s.color,"20"):void 0,borderColor:s.color,border:n?"2px solid":"1px solid",borderStyle:"solid","& .MuiChip-label":{px:1}},variant:"outlined"})},e)}),a>0&&(0,K.jsx)(H.A,{label:"+".concat(a),size:i,variant:"outlined",sx:{height:"small"===i?24:28}})]})},de=["children","value","index"];function xe(e){const{children:s,value:t,index:r}=e,a=(0,i.A)(e,de);return(0,K.jsx)("div",(0,n.A)((0,n.A)({role:"tabpanel",hidden:t!==r,id:"customer-tabpanel-".concat(r),"aria-labelledby":"customer-tab-".concat(r)},a),{},{children:t===r&&(0,K.jsx)(l.A,{sx:{py:3},children:s})}))}const he={id:"",firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",pets:[]},ue=()=>{const{id:e}=(0,R.g)(),s=(0,R.Zp)(),t=!e||"new"===e,[i,L]=(0,r.useState)(he),[F,z]=(0,r.useState)(!0),[T,q]=(0,r.useState)(t),[_,U]=(0,r.useState)({open:!1,message:"",severity:"success"}),[H,O]=(0,r.useState)(""),[G,$]=(0,r.useState)(0),[V,Z]=(0,r.useState)(!1),[Q,Y]=(0,r.useState)(i.customerIcons||[]),[J,X]=(0,r.useState)(i.iconNotes||{}),ee=(0,r.useCallback)(async()=>{if(t)return L(he),void z(!1);try{const s=await W.m.getCustomerById(e||"");L(s),z(!1)}catch(s){console.error("Error fetching customer:",s),U({open:!0,message:"Failed to load customer data",severity:"error"}),z(!1)}},[e,t]);(0,r.useEffect)(()=>{ee()},[ee]),(0,r.useEffect)(()=>{i.customerIcons&&Y(i.customerIcons),i.iconNotes&&X(i.iconNotes)},[i.customerIcons,i.iconNotes]);const se=e=>{const{name:s,value:t}=e.target,i=document.activeElement,r=i?i.id:null;L(e=>(0,n.A)((0,n.A)({},e),{},{[s]:t})),setTimeout(()=>{if(r){const e=document.getElementById(r);e&&e.focus()}},0)},te=async r=>{r.preventDefault();try{z(!0);const r=(0,n.A)((0,n.A)({},i),{},{customerIcons:Q,iconNotes:J});if(t){await W.m.createCustomer(r);U({open:!0,message:"Customer created successfully",severity:"success"});const e=new URLSearchParams(window.location.search).get("redirect");s(e||"/customers")}else await W.m.updateCustomer(e||"",r),U({open:!0,message:"Customer updated successfully",severity:"success"}),q(!1);z(!1)}catch(l){z(!1);let e="Failed to save customer";l instanceof Error&&(e=l.message),U({open:!0,message:e,severity:"error"})}};if(F)return(0,K.jsx)(a.A,{maxWidth:"lg",children:(0,K.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,K.jsx)(c.A,{})})});const ne=()=>(0,K.jsx)(o.A,{elevation:3,sx:{p:3,mb:3},children:(0,K.jsxs)(d.Ay,{container:!0,spacing:2,children:[(0,K.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-firstName",label:"First Name",name:"firstName",value:i.firstName,onChange:se,disabled:!T,required:!0})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-lastName",label:"Last Name",name:"lastName",value:i.lastName,onChange:se,disabled:!T,required:!0})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-email",label:"Email",name:"email",type:"email",value:i.email,onChange:se,disabled:!T,required:!0})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:6,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-phone",label:"Phone",name:"phone",value:i.phone,onChange:se,disabled:!T,required:!0})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-address",label:"Address",name:"address",value:i.address,onChange:se,disabled:!T})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-city",label:"City",name:"city",value:i.city,onChange:se,disabled:!T})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-state",label:"State",name:"state",value:i.state,onChange:se,disabled:!T})}),(0,K.jsx)(d.Ay,{item:!0,xs:12,md:4,children:(0,K.jsx)(x.A,{fullWidth:!0,id:"customer-zipCode",label:"Zip Code",name:"zipCode",value:i.zipCode,onChange:se,disabled:!T})})]})}),ie=()=>{var t,n;return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsxs)(l.A,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)(h.A,{variant:"subtitle1",color:"textSecondary",children:[(null===(t=i.pets)||void 0===t?void 0:t.length)||0," ",1===(null===(n=i.pets)||void 0===n?void 0:n.length)?"pet":"pets"," associated with this customer"]}),(0,K.jsx)(u.A,{variant:"contained",color:"primary",startIcon:(0,K.jsx)(E.A,{}),onClick:()=>s("/pets/new?customerId=".concat(e)),children:"Add Pet"})]}),(0,K.jsxs)(o.A,{elevation:3,sx:{p:3,mb:3},children:[(0,K.jsx)(x.A,{fullWidth:!0,placeholder:"Search pets...",value:H,onChange:e=>O(e.target.value),sx:{mb:2},InputProps:{startAdornment:(0,K.jsx)(A.A,{position:"start",children:(0,K.jsx)(N.A,{})})}}),i.pets&&i.pets.length>0?(0,K.jsx)(j.A,{children:i.pets.filter(e=>e.name.toLowerCase().includes(H.toLowerCase())||(e.breed||"").toLowerCase().includes(H.toLowerCase())||(e.type||"").toLowerCase().includes(H.toLowerCase())).map(e=>(0,K.jsxs)(m.Ay,{sx:{border:"1px solid #e0e0e0",borderRadius:1,mb:1,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[(0,K.jsx)(p.A,{primary:e.name,secondary:(0,K.jsxs)(K.Fragment,{children:[e.type,e.breed?" \u2022 ".concat(e.breed):""]})}),(0,K.jsx)(y.A,{children:(0,K.jsx)(v.A,{edge:"end","aria-label":"edit",onClick:()=>s("/pets/".concat(e.id)),children:(0,K.jsx)(P.A,{})})})]},e.id))}):(0,K.jsx)(h.A,{variant:"body1",color:"textSecondary",align:"center",children:'No pets found. Click "Add Pet" to add one.'})]})]})};return(0,K.jsx)(a.A,{maxWidth:"lg",children:(0,K.jsxs)(l.A,{sx:{py:4},children:[(0,K.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[(0,K.jsx)(l.A,{sx:{display:"flex",alignItems:"center",gap:2},children:(0,K.jsx)(l.A,{sx:{flexGrow:1},children:(0,K.jsx)(h.A,{variant:"h5",component:"h1",children:t?"New Customer":"".concat(i.firstName," ").concat(i.lastName)})})}),Q.length>0&&(0,K.jsxs)(l.A,{children:[(0,K.jsx)(h.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Customer Icons"}),(0,K.jsx)(oe,{iconIds:Q,iconNotes:J,size:"medium"})]})]}),(0,K.jsx)(l.A,{sx:{display:"flex",gap:2,mb:3},children:T?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(u.A,{variant:"contained",color:"primary",onClick:te,children:"Save"}),(0,K.jsx)(u.A,{variant:"outlined",onClick:()=>Z(!0),startIcon:(0,K.jsx)(k.A,{}),children:"Manage Icons"}),(0,K.jsx)(u.A,{variant:"outlined",color:"secondary",onClick:()=>{t?s("/customers"):q(!1)},children:"Cancel"})]}):(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(u.A,{variant:"contained",color:"primary",onClick:()=>q(!0),children:"Edit Customer"}),(0,K.jsx)(u.A,{variant:"outlined",color:"secondary",onClick:()=>s("/customers"),children:"Back to Customers"})]})}),!t&&!T&&(0,K.jsx)(l.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,K.jsxs)(g.A,{value:G,onChange:(e,s)=>{$(s)},"aria-label":"customer tabs",variant:"scrollable",scrollButtons:"auto",children:[(0,K.jsx)(b.A,{icon:(0,K.jsx)(k.A,{}),iconPosition:"start",label:"Customer Info"}),(0,K.jsx)(b.A,{icon:(0,K.jsx)(B.A,{}),iconPosition:"start",label:"Pets"}),(0,K.jsx)(b.A,{icon:(0,K.jsx)(M.A,{}),iconPosition:"start",label:"Account History"})]})}),T?(0,K.jsx)("form",{onSubmit:te,children:(0,K.jsx)(ne,{})}):(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(xe,{value:G,index:0,children:(0,K.jsx)(ne,{})}),(0,K.jsx)(xe,{value:G,index:1,children:(0,K.jsx)(ie,{})}),(0,K.jsx)(xe,{value:G,index:2,children:(0,K.jsxs)(l.A,{children:[(0,K.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:"Account History & Balance"}),(0,K.jsx)(re,{customerId:e||""})]})})]}),(0,K.jsxs)(C.A,{open:V,onClose:()=>Z(!1),maxWidth:"md",fullWidth:!0,children:[(0,K.jsx)(f.A,{children:"Manage Customer Icons"}),(0,K.jsx)(I.A,{children:(0,K.jsx)(le.A,{selectedIcons:Q,iconNotes:J,onChange:(e,s)=>{Y(e),X(s)}})}),(0,K.jsx)(D.A,{children:(0,K.jsx)(u.A,{onClick:()=>Z(!1),children:"Close"})})]}),(0,K.jsx)(S.A,{open:_.open,autoHideDuration:6e3,onClose:()=>U(e=>(0,n.A)((0,n.A)({},e),{},{open:!1})),children:(0,K.jsx)(w.A,{onClose:()=>U(e=>(0,n.A)((0,n.A)({},e),{},{open:!1})),severity:_.severity,sx:{width:"100%"},children:_.message})})]})})}}}]);