"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[6078],{26078:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G,mapVaccinationData:()=>U,mapVaccinationExpirations:()=>_});var a=n(89379),i=n(9950),r=n(62999),o=n(78317),s=n(46639),l=n(65429),c=n(82053),d=n(2235),u=n(41413),p=n(10226),m=n(25979),h=n(8145),x=n(19647),g=n(70006),v=n(23266),A=n(77922),f=n(16497),y=n(93038),j=n(74745),b=n(29277),C=n(96557),w=n(98785),N=n(28429),I=n(44414);const S=["Rabies","DHPP","Bordetella","FVRCP","Lepto","Influenza"],P=e=>{let{vaccinationStatus:t,vaccineExpirations:n,onVaccinationStatusChange:a,onVaccineExpirationChange:i}=e;return(0,I.jsxs)(o.A,{sx:{display:"grid",gap:2},children:[(0,I.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Vaccination Status"}),S.map(e=>{var r;return(0,I.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:2,alignItems:"start"},children:[(0,I.jsx)(c.A,{variant:"subtitle1",children:e}),(0,I.jsxs)(m.A,{fullWidth:!0,children:[(0,I.jsx)(x.A,{children:"Status"}),(0,I.jsxs)(g.A,{value:(n=>{if(!t||!t[e])return"pending";const a=t[e];return"string"===typeof a?a.toLowerCase():(null===(n=a.status)||void 0===n?void 0:n.toLowerCase())||"pending"})(),label:"Status",onChange:t=>{a(e,t.target.value)},children:[(0,I.jsx)(v.A,{value:"current",children:"Current"}),(0,I.jsx)(v.A,{value:"expired",children:"Expired"}),(0,I.jsx)(v.A,{value:"pending",children:"Pending"})]})]}),(0,I.jsx)(h.A,{label:"Expiration Date",type:"date",value:n&&(null===(r=n[e])||void 0===r?void 0:r.split("T")[0])||"",onChange:t=>{t.target.value&&i(e,new Date(t.target.value).toISOString())},InputLabelProps:{shrink:!0},fullWidth:!0})]},e)})]})};var E=n(60899),T=n(83274),D=n(25277),R=n(54500);const B=e=>{let{selectedIcons:t,onChange:n}=e;const a=e=>{t.includes(e)?n(t.filter(t=>t!==e)):n([...t,e])},i=(0,R.ed)("group"),r=(0,R.ed)("size"),s=(0,R.ed)("behavior"),l=(0,R.ed)("medical"),u=(0,R.ed)("handling"),p=(0,R.ed)("flag"),m=(e,n)=>0===n.length?null:(0,I.jsxs)(o.A,{sx:{mb:3},children:[(0,I.jsx)(c.A,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:e}),(0,I.jsx)(E.Ay,{container:!0,spacing:1,children:n.map(e=>{const n=t.includes(e.id);return(0,I.jsx)(E.Ay,{item:!0,children:(0,I.jsx)(T.A,{title:"".concat(e.label,": ").concat(e.description),arrow:!0,children:(0,I.jsx)(D.A,{label:e.icon,onClick:()=>a(e.id),color:n?"primary":"default",variant:n?"filled":"outlined",sx:{fontSize:"1.5rem",minWidth:"48px",height:"48px",cursor:"pointer","&:hover":{transform:"scale(1.1)",transition:"transform 0.2s"}}})})},e.id)})})]});return(0,I.jsxs)(d.A,{elevation:2,sx:{p:2,mb:3},children:[(0,I.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Pet Icons"}),(0,I.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select icons that apply to this pet. Hover over icons to see descriptions."}),t.length>0&&(0,I.jsxs)(o.A,{sx:{mb:2},children:[(0,I.jsxs)(c.A,{variant:"subtitle2",gutterBottom:!0,children:["Selected (",t.length,"):"]}),(0,I.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(e=>{const t=R.Nr.find(t=>t.id===e);return t?(0,I.jsx)(T.A,{title:t.label,arrow:!0,children:(0,I.jsx)(D.A,{label:t.icon,onDelete:()=>a(e),color:"primary",sx:{fontSize:"1.2rem"}})},e):null})})]}),(0,I.jsx)(j.A,{sx:{my:2}}),m("Group Compatibility",i),m("Size",r),m("Behavioral Alerts",s),m("Medical",l),m("Handling Requirements",u),m("Custom Flags",p)]})};var k=n(33738),L=n(95699),O=n(11227),W=n(99905),V=n(96827);const z=e=>{let{petId:t,serviceType:n,showDetails:a=!1}=e;const[r,d]=(0,i.useState)(null),[u,p]=(0,i.useState)(!0),[m,h]=(0,i.useState)(null),[x,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{v()},[t,n]);const v=async()=>{try{p(!0);const e=await V.A.checkCompliance(t,n);d(e),h(null)}catch(e){h(e.message||"Failed to check vaccine compliance"),console.error(e)}finally{p(!1)}};if(u)return(0,I.jsx)(o.A,{display:"inline-flex",alignItems:"center",children:(0,I.jsx)(s.A,{size:20})});if(m||!r)return(0,I.jsx)(T.A,{title:m||"Unable to check compliance",children:(0,I.jsx)(D.A,{icon:(0,I.jsx)(L.A,{}),label:"Unknown",size:"small",color:"default"})});return(0,I.jsxs)(o.A,{children:[(0,I.jsx)(T.A,{title:(()=>{const e=[];return r.summary.missing>0&&e.push("".concat(r.summary.missing," missing")),r.summary.expired>0&&e.push("".concat(r.summary.expired," expired")),r.summary.expiringSoon>0&&e.push("".concat(r.summary.expiringSoon," expiring soon")),0===e.length?"All required vaccines are current":"Vaccine issues: ".concat(e.join(", "))})(),children:(0,I.jsx)(D.A,{icon:r.isFullyCompliant?(0,I.jsx)(O.A,{}):r.summary.expired>0||r.summary.missing>0?(0,I.jsx)(W.A,{}):r.summary.expiringSoon>0?(0,I.jsx)(L.A,{}):void 0,label:r.isFullyCompliant?"Compliant":r.summary.missing>0?"".concat(r.summary.missing," Missing"):r.summary.expired>0?"".concat(r.summary.expired," Expired"):r.summary.expiringSoon>0?"".concat(r.summary.expiringSoon," Expiring Soon"):"Check Required",size:"small",color:r.isFullyCompliant?"success":r.summary.expired>0?"error":r.summary.expiringSoon>0?"warning":r.summary.missing>0?"error":"default",onClick:a?()=>g(!x):void 0,sx:{cursor:a?"pointer":"default"}})}),a&&(0,I.jsx)(k.A,{in:x,children:(0,I.jsxs)(o.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[(0,I.jsx)(c.A,{variant:"subtitle2",gutterBottom:!0,children:"Vaccine Compliance Details"}),r.missingRequired.length>0&&(0,I.jsxs)(l.A,{severity:"error",sx:{mb:1},children:[(0,I.jsx)(c.A,{variant:"body2",fontWeight:"bold",children:"Missing Required Vaccines:"}),(0,I.jsx)(c.A,{variant:"body2",children:r.missingRequired.join(", ")})]}),r.complianceResults.map(e=>(0,I.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:.5,borderBottom:"1px solid",borderColor:"divider"},children:[(0,I.jsxs)(o.A,{children:[(0,I.jsxs)(c.A,{variant:"body2",children:[e.vaccineName,e.isRequired&&(0,I.jsx)(D.A,{label:"Required",size:"small",color:"error",sx:{ml:1,height:18}})]}),e.expirationDate&&(0,I.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Expires: ",new Date(e.expirationDate).toLocaleDateString(),null!==e.daysUntilExpiration&&void 0!==e.daysUntilExpiration&&e.daysUntilExpiration>0&&(0,I.jsxs)(I.Fragment,{children:[" (",e.daysUntilExpiration," days)"]})]})]}),(0,I.jsx)(D.A,{label:e.status.replace("_"," "),size:"small",color:"CURRENT"===e.status?"success":"EXPIRED"===e.status?"error":"EXPIRING_SOON"===e.status?"warning":"default"})]},e.requirementId)),(0,I.jsxs)(o.A,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[(0,I.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Total: ",r.summary.total," vaccines"]}),(0,I.jsxs)(c.A,{variant:"caption",color:"text.secondary",children:["Compliant: ",r.summary.compliant,"/",r.summary.required," required"]})]})]})})]})};var F=n(35286),q=n(89007),H=n(82932);const M=new class{async getBreeds(e){try{const t=e?{species:e}:{},n=await H.Ay.get("/api/breeds",{params:t});return n.data.data||n.data||[]}catch(t){return console.error("Error fetching breeds:",t),[]}}async getVeterinarians(){try{const e=await H.Ay.get("/api/veterinarians");return e.data.data||e.data||[]}catch(e){return console.error("Error fetching veterinarians:",e),[]}}async getTemperamentTypes(){try{const e=await H.Ay.get("/api/temperament-types");return e.data.data||e.data||[]}catch(e){return console.error("Error fetching temperament types:",e),[]}}async getPetTemperaments(e){try{const t=await H.Ay.get("/api/pets/".concat(e,"/temperaments"));return t.data.data||t.data||[]}catch(t){return console.error("Error fetching pet temperaments:",t),[]}}async updatePetTemperaments(e,t){try{await H.Ay.put("/api/pets/".concat(e,"/temperaments"),{temperaments:t})}catch(n){throw console.error("Error updating pet temperaments:",n),n}}},U=e=>{if(!e)return{};const t={},n={rabies:"Rabies",dhpp:"DHPP",bordetella:"Bordetella",fvrcp:"FVRCP",canine_influenza:"Influenza",feline_leukemia:"Lepto"};return Object.entries(e).forEach(e=>{let[a,i]=e;t[n[a]||a]=i}),t},_=e=>{if(!e)return{};const t={},n={rabies:"Rabies",dhpp:"DHPP",bordetella:"Bordetella",fvrcp:"FVRCP",canine_influenza:"Influenza",feline_leukemia:"Lepto"};return Object.entries(e).forEach(e=>{let[a,i]=e;t[n[a]||a]=i}),t},G=()=>{const{id:e}=(0,N.g)(),t=(0,N.Zp)(),n="new"===e,[S,E]=(0,i.useState)(!0),[T,D]=(0,i.useState)(!1),[R,k]=(0,i.useState)(null),[L,O]=(0,i.useState)([]),[W,V]=(0,i.useState)(null),[H,G]=(0,i.useState)([]),[X,Y]=(0,i.useState)([]),[Z,J]=(0,i.useState)([]),[K,Q]=(0,i.useState)([]),[$,ee]=(0,i.useState)({open:!1,message:"",severity:"success"}),[te,ne]=(0,i.useState)(null),[ae,ie]=(0,i.useState)(Date.now()),[re,oe]=(0,i.useState)({name:"",type:"DOG",breed:null,color:null,birthdate:null,weight:null,gender:null,isNeutered:!1,microchipNumber:null,rabiesTagNumber:null,profilePhoto:null,specialNeeds:null,behaviorNotes:null,foodNotes:null,medicationNotes:null,allergies:null,vetName:null,vetPhone:null,veterinarianId:null,customerId:"",isActive:!0,petIcons:[],iconNotes:{},vaccinationStatus:void 0,vaccineExpirations:void 0}),se=(0,i.useCallback)(async()=>{try{const[a,i,r]=await Promise.all([M.getBreeds(),M.getVeterinarians(),M.getTemperamentTypes()]);if(G(a),Y(i),J(r),console.log("Loaded veterinarians:",i.length),n){const e=await q.m.getAllCustomers(1,100);O(e.data||[])}else{const n=await F.B.getPetById(e);if(n.birthdate&&(n.birthdate=new Date(n.birthdate).toISOString().split("T")[0]),n.medicalRecords&&n.medicalRecords.length>0){const e={},t={},a=new Date;a.setHours(0,0,0,0),n.medicalRecords.forEach(n=>{if("VACCINATION"===n.recordType&&n.description){const i={"Rabies vaccination":"Rabies","DHPP vaccination":"DHPP","Bordetella vaccination":"Bordetella","FVRCP vaccination":"FVRCP","Canine Influenza vaccination":"Influenza","Lepto vaccination":"Lepto","Leptospirosis vaccination":"Lepto"}[n.description];if(i)if(n.expirationDate){const r=new Date(n.expirationDate);r.setHours(0,0,0,0),e[i]=r>=a?{status:"CURRENT"}:{status:"EXPIRED"},t[i]=new Date(n.expirationDate).toISOString().split("T")[0]}else e[i]={status:"CURRENT"}}}),n.vaccinationStatus=e,n.vaccineExpirations=t,console.log("Populated vaccination data from medical records:",{vaccinationStatus:e,vaccineExpirations:t,today:a.toISOString().split("T")[0]})}if(oe(n),console.log("Loaded pet data:",{name:n.name,vetName:n.vetName,vetPhone:n.vetPhone,veterinarianId:n.veterinarianId}),n.customerId)try{const e=await q.m.getCustomerById(n.customerId);if(console.log("Loaded customer data:",e),V(e),console.log("Checking auto-fill conditions:"),console.log("- pet.veterinarianId:",n.veterinarianId),console.log("- pet.vetName:",n.vetName),console.log("- owner.veterinarianId:",e.veterinarianId),n.veterinarianId||n.vetName||!e.veterinarianId)console.log("Auto-fill conditions not met");else{console.log("Auto-populating veterinarian from customer:",e.veterinarianId);const t=i.find(t=>t.id===e.veterinarianId);t?(n.veterinarianId=t.id,n.vetName=t.name,n.vetPhone=t.phone||null,console.log("Auto-filled veterinarian:",t.name)):console.log("Customer veterinarian not found in vets list")}}catch(t){console.error("Error loading pet owner:",t)}try{const t=await M.getPetTemperaments(e);Q(t.map(e=>e.temperament))}catch(t){console.log("No temperaments found for pet")}}}catch(t){console.error("Error loading data:",t),k("Failed to load data")}finally{E(!1)}},[e,n]);(0,i.useEffect)(()=>{se();const e=()=>{document.body.style.overflow="auto",document.body.style.height="auto"};return e(),()=>{e()}},[se]);const le=e=>{const{name:t,value:n}=e.target;t&&oe(e=>{const i="weight"===t?n?parseFloat(n):null:"birthdate"===t?n||null:n;return(0,a.A)((0,a.A)({},e),{},{[t]:i})})},ce=e=>{const{name:t,value:n}=e.target;t&&oe(e=>(0,a.A)((0,a.A)({},e),{},{[t]:n}))};return S?(0,I.jsx)(r.A,{maxWidth:"lg",children:(0,I.jsx)(o.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,I.jsx)(s.A,{})})}):R?(0,I.jsx)(r.A,{maxWidth:"lg",children:(0,I.jsx)(l.A,{severity:"error",sx:{mt:4},children:R})}):(0,I.jsx)(r.A,{maxWidth:"lg",children:(0,I.jsxs)(o.A,{sx:{mt:4,mb:4},children:[(0,I.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,I.jsx)(c.A,{variant:"h4",children:n?"New Pet":re.name}),!n&&e&&(0,I.jsx)(z,{petId:e,showDetails:!0})]}),(0,I.jsxs)(d.A,{elevation:3,sx:{p:3,mb:3},children:[(0,I.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[(0,I.jsx)(u.A,{src:re.profilePhoto?"".concat(window.location.origin).concat(re.profilePhoto,"?t=").concat(ae):void 0,alt:re.name||"Pet",onError:e=>{console.error("Error loading image:",e);const t=e.target,n=t.src;if(n.includes("?")){const e=n.split("?")[0];t.src=e}else t.src=""},sx:{width:150,height:150,border:"2px solid #e0e0e0","& img":{objectFit:"cover",width:"100%",height:"100%"}}}),(0,I.jsxs)(o.A,{children:[(0,I.jsx)("input",{accept:"image/*",style:{display:"none"},id:"photo-upload",type:"file",onChange:async t=>{var i;const r=null===(i=t.target.files)||void 0===i?void 0:i[0];if(r&&!n&&e){if(r.size>5242880)return void ee({open:!0,message:"File size too large. Please upload an image under 5MB.",severity:"error"});try{D(!0);const t=await F.B.uploadPetPhoto(e,r);if(t.profilePhoto){const e="".concat(window.location.origin).concat(t.profilePhoto);(new Image).src=e,oe(e=>(0,a.A)((0,a.A)({},e),{},{profilePhoto:t.profilePhoto}))}ie(Date.now()),ee({open:!0,message:"Photo uploaded successfully",severity:"success"})}catch(R){console.error("Error uploading photo:",R),ee({open:!0,message:"Error uploading photo",severity:"error"})}finally{D(!1)}}}}),(0,I.jsx)("label",{htmlFor:"photo-upload",children:(0,I.jsx)(p.A,{variant:"outlined",component:"span",disabled:T||n,children:re.profilePhoto?"Change Photo":"Add Photo"})}),n&&(0,I.jsx)(c.A,{variant:"caption",color:"textSecondary",sx:{display:"block",mt:1},children:"You can add a photo after creating the pet"})]})]}),(0,I.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:2},children:[(0,I.jsx)(m.A,{fullWidth:!0,required:!0,children:(0,I.jsx)(h.A,{label:"Name",name:"name",value:re.name||"",onChange:le,required:!0})}),(0,I.jsxs)(m.A,{fullWidth:!0,required:!0,children:[(0,I.jsx)(x.A,{children:"Type"}),(0,I.jsxs)(g.A,{name:"type",value:re.type||"DOG",label:"Type",onChange:ce,children:[(0,I.jsx)(v.A,{value:"DOG",children:"Dog"}),(0,I.jsx)(v.A,{value:"CAT",children:"Cat"}),(0,I.jsx)(v.A,{value:"OTHER",children:"Other"})]})]}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(A.A,{options:H.filter(e=>e.species===re.type),getOptionLabel:e=>"string"===typeof e?e:e.name,value:H.find(e=>e.name===re.breed)||null,onChange:(e,t)=>{oe("string"===typeof t?e=>(0,a.A)((0,a.A)({},e),{},{breed:t}):e=>(0,a.A)((0,a.A)({},e),{},{breed:(null===t||void 0===t?void 0:t.name)||null}))},renderInput:e=>(0,I.jsx)(h.A,(0,a.A)((0,a.A)({},e),{},{label:"Breed",placeholder:"Search breeds..."})),freeSolo:!0,onInputChange:(e,t)=>{t&&!H.find(e=>e.name===t)&&oe(e=>(0,a.A)((0,a.A)({},e),{},{breed:t}))}})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Color",name:"color",value:re.color||"",onChange:le})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Weight (lbs)",name:"weight",type:"number",value:re.weight||"",onChange:le})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Birthdate",name:"birthdate",type:"date",value:re.birthdate||"",onChange:le,InputLabelProps:{shrink:!0}})}),(0,I.jsxs)(m.A,{fullWidth:!0,children:[(0,I.jsx)(x.A,{children:"Gender"}),(0,I.jsxs)(g.A,{name:"gender",value:re.gender||"",label:"Gender",onChange:ce,children:[(0,I.jsx)(v.A,{value:"MALE",children:"Male"}),(0,I.jsx)(v.A,{value:"FEMALE",children:"Female"})]})]}),(0,I.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Microchip Number",name:"microchipNumber",value:re.microchipNumber||"",onChange:le})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Rabies Tag Number",name:"rabiesTagNumber",value:re.rabiesTagNumber||"",onChange:le})})]}),(0,I.jsx)(f.A,{control:(0,I.jsx)(y.A,{checked:re.isNeutered||!1,onChange:e=>{const{name:t,checked:n}=e.target;oe(e=>(0,a.A)((0,a.A)({},e),{},{[t]:n}))},name:"isNeutered"}),label:"Neutered/Spayed"})]}),(0,I.jsx)(j.A,{sx:{my:2}}),(0,I.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Owner Information"}),(0,I.jsx)(o.A,{sx:{mb:2},children:n?(0,I.jsx)(A.A,{options:L,getOptionLabel:e=>"".concat(e.firstName," ").concat(e.lastName).concat(e.email?" (".concat(e.email,")"):""),value:L.find(e=>e.id===re.customerId)||null,onChange:(e,t)=>{oe(e=>(0,a.A)((0,a.A)({},e),{},{customerId:(null===t||void 0===t?void 0:t.id)||""}))},renderInput:e=>(0,I.jsx)(h.A,(0,a.A)((0,a.A)({},e),{},{label:"Owner *",placeholder:"Search by name or email...",required:!0})),isOptionEqualToValue:(e,t)=>e.id===t.id}):(0,I.jsxs)(o.A,{children:[(0,I.jsx)(c.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Owner"}),(0,I.jsxs)(d.A,{sx:{p:2,bgcolor:"grey.50"},children:[(0,I.jsx)(c.A,{variant:"body1",children:W?"".concat(W.firstName," ").concat(W.lastName):"Loading owner information..."}),(null===W||void 0===W?void 0:W.email)&&(0,I.jsx)(c.A,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:W.email}),(null===W||void 0===W?void 0:W.phone)&&(0,I.jsx)(c.A,{variant:"body2",color:"text.secondary",children:W.phone})]}),(0,I.jsx)(c.A,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Owner cannot be changed after pet creation. To transfer ownership, please contact support."})]})}),(0,I.jsx)(j.A,{sx:{my:2}}),(0,I.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Additional Information"}),(0,I.jsx)(B,{selectedIcons:re.petIcons||[],onChange:e=>oe((0,a.A)((0,a.A)({},re),{},{petIcons:e}))}),(0,I.jsxs)(o.A,{sx:{display:"grid",gap:2},children:[(0,I.jsx)(c.A,{variant:"h6",gutterBottom:!0,children:"Medical Information"}),(0,I.jsxs)(o.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:2},children:[(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(A.A,{options:X,loading:0===X.length,getOptionLabel:e=>"string"===typeof e?e:e.name||"",value:(()=>{if(re.veterinarianId){const e=X.find(e=>e.id===re.veterinarianId);if(e)return e}if(re.vetName){const e=X.find(e=>e.name===re.vetName);return e||re.vetName}return null})(),onChange:(e,t)=>{console.log("Veterinarian changed:",t),oe("string"===typeof t?e=>(0,a.A)((0,a.A)({},e),{},{vetName:t,vetPhone:null,veterinarianId:null}):t?e=>(0,a.A)((0,a.A)({},e),{},{vetName:t.name,vetPhone:t.phone||null,veterinarianId:t.id}):e=>(0,a.A)((0,a.A)({},e),{},{vetName:null,vetPhone:null,veterinarianId:null}))},renderInput:e=>(0,I.jsx)(h.A,(0,a.A)((0,a.A)({},e),{},{label:"Veterinarian",placeholder:"Type to search or enter custom name...",helperText:X.length>0?"".concat(X.length," veterinarians available"):"Loading veterinarians..."})),renderOption:(e,t)=>(0,I.jsx)("li",(0,a.A)((0,a.A)({},e),{},{children:(0,I.jsxs)(o.A,{children:[(0,I.jsx)(c.A,{variant:"body1",children:t.name}),t.phone&&(0,I.jsxs)(c.A,{variant:"caption",color:"textSecondary",children:[t.phone,t.city&&t.state&&" \u2022 ".concat(t.city,", ").concat(t.state)]})]})})),freeSolo:!0,filterOptions:(e,t)=>e.filter(e=>e.name.toLowerCase().includes(t.inputValue.toLowerCase())).slice(0,100),isOptionEqualToValue:(e,t)=>"string"===typeof t?e.name===t:e.id===t.id})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Veterinarian Phone",name:"vetPhone",value:re.vetPhone||"",onChange:le,helperText:"Auto-filled when selecting from list"})})]}),(0,I.jsx)(o.A,{sx:{mt:2},children:(0,I.jsx)(P,{vaccinationStatus:U(re.vaccinationStatus),vaccineExpirations:_(re.vaccineExpirations),onVaccinationStatusChange:(e,t)=>{const n=e.toLowerCase();oe(e=>(0,a.A)((0,a.A)({},e),{},{vaccinationStatus:(0,a.A)((0,a.A)({},e.vaccinationStatus||{}),{},{[n]:t})}))},onVaccineExpirationChange:(e,t)=>{const n=e.toLowerCase();oe(e=>(0,a.A)((0,a.A)({},e),{},{vaccineExpirations:(0,a.A)((0,a.A)({},e.vaccineExpirations||{}),{},{[n]:t})}))}})}),(0,I.jsxs)(o.A,{sx:{mt:2},children:[(0,I.jsx)(b.A,{component:"legend",children:"Temperament"}),(0,I.jsx)(C.A,{row:!0,children:Z.map(e=>(0,I.jsx)(f.A,{control:(0,I.jsx)(y.A,{checked:K.includes(e.name),onChange:t=>{t.target.checked?Q(t=>[...t,e.name]):Q(t=>t.filter(t=>t!==e.name))}}),label:e.name},e.id))})]}),(0,I.jsxs)(o.A,{sx:{display:"grid",gap:2},children:[(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Allergies",name:"allergies",value:re.allergies||"",onChange:le,multiline:!0,rows:2})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Medication Notes",name:"medicationNotes",value:re.medicationNotes||"",onChange:le,multiline:!0,rows:2})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Food Notes",name:"foodNotes",value:re.foodNotes||"",onChange:le,multiline:!0,rows:2})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Special Needs",name:"specialNeeds",value:re.specialNeeds||"",onChange:le,multiline:!0,rows:2})}),(0,I.jsx)(m.A,{fullWidth:!0,children:(0,I.jsx)(h.A,{label:"Behavior Notes",name:"behaviorNotes",value:re.behaviorNotes||"",onChange:le,multiline:!0,rows:2})})]})]})]}),(0,I.jsxs)(o.A,{sx:{mt:3,display:"flex",gap:2},children:[(0,I.jsx)(p.A,{variant:"contained",color:"primary",onClick:async()=>{try{if(D(!0),!re.name||!re.customerId)return void ee({open:!0,message:"Please fill in all required fields",severity:"error"});const i=re.birthdate?new Date(re.birthdate).toISOString().split("T")[0]:null,r={name:re.name,type:re.type,breed:re.breed,color:re.color,birthdate:i,weight:re.weight,gender:re.gender,isNeutered:re.isNeutered,microchipNumber:re.microchipNumber,specialNeeds:re.specialNeeds,behaviorNotes:re.behaviorNotes,foodNotes:re.foodNotes,medicationNotes:re.medicationNotes,allergies:re.allergies,vetName:re.vetName,vetPhone:re.vetPhone,veterinarianId:re.veterinarianId,petIcons:re.petIcons||[],iconNotes:re.iconNotes||{},vaccinationStatus:re.vaccinationStatus||{},vaccineExpirations:re.vaccineExpirations||{},customerId:re.customerId,isActive:re.isActive};let o=e;if(n){o=(await F.B.createPet(r)).id}else await F.B.updatePet(e,r);if(o&&K.length>0)try{await M.updatePetTemperaments(o,K)}catch(a){console.error("Error saving temperaments:",a)}ee({open:!0,message:"Pet ".concat(n?"created":"updated"," successfully"),severity:"success"}),t("/pets")}catch(a){console.error("Error saving pet:",a),ee({open:!0,message:"Error ".concat(n?"creating":"updating"," pet"),severity:"error"})}finally{D(!1)}},disabled:T,children:T?(0,I.jsx)(s.A,{size:24}):n?"Create Pet":"Save Changes"}),(0,I.jsx)(p.A,{variant:"outlined",color:"secondary",onClick:()=>t("/pets"),disabled:T,children:"Cancel"})]}),(0,I.jsx)(w.A,{open:$.open,autoHideDuration:6e3,onClose:()=>ee(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),children:(0,I.jsx)(l.A,{onClose:()=>ee(e=>(0,a.A)((0,a.A)({},e),{},{open:!1})),severity:$.severity,sx:{width:"100%"},children:$.message})})]})})}}}]);