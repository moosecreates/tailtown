"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[359],{40359:(e,t,l)=>{l.r(t),l.d(t,{default:()=>_});var s=l(89379),a=l(9950),r=l(78317),i=l(46639),n=l(82053),c=l(10226),d=l(65429),o=l(2235),u=l(60899),A=l(25979),h=l(19647),x=l(70006),j=l(23266),m=l(1320),g=l(15769),v=l(69780),p=l(9213),y=l(21671),C=l(34075),f=l(25277),E=l(83274),I=l(25333),S=l(96583),D=l(40033),b=l(28170),P=l(8145),w=l(79739),W=l(53256),k=l(49939),T=l(20760),N=l(40379),O=l(67920),B=l(20227),L=l(28429),R=l(95722),F=l(396),M=l(81831),q=l(46001),G=l(89007),Y=l(35286),z=l(44414);const _=()=>{const e=(0,L.Zp)(),[t,l]=(0,a.useState)([]),[_,V]=(0,a.useState)(!0),[H,U]=(0,a.useState)(null),[$,Z]=(0,a.useState)(!1),[J,K]=(0,a.useState)(null),[Q,X]=(0,a.useState)(0),[ee,te]=(0,a.useState)({name:"",description:"",level:"BEGINNER",category:"OBEDIENCE",instructorId:"",maxCapacity:8,startDate:new Date,totalWeeks:6,daysOfWeek:[1],startTime:"18:00",endTime:"19:00",pricePerSeries:200,notes:""}),[le,se]=(0,a.useState)({status:"",category:"",level:"",isActive:!0}),[ae,re]=(0,a.useState)(!1),[ie,ne]=(0,a.useState)(null),[ce,de]=(0,a.useState)([]),[oe,ue]=(0,a.useState)([]),[Ae,he]=(0,a.useState)({customerId:"",petId:"",amountPaid:0});(0,a.useEffect)(()=>{xe()},[le]);const xe=async()=>{try{V(!0);const e=await q.Ay.trainingClasses.getAll(le);l(e),U(null)}catch(e){U(e.message||"Failed to load training classes"),console.error(e)}finally{V(!1)}},je=e=>{e?(K(e),te({name:e.name,description:e.description||"",level:e.level,category:e.category,instructorId:e.instructorId,maxCapacity:e.maxCapacity,startDate:new Date(e.startDate),totalWeeks:e.totalWeeks,daysOfWeek:e.daysOfWeek,startTime:e.startTime,endTime:e.endTime,pricePerSeries:e.pricePerSeries,pricePerSession:e.pricePerSession,depositRequired:e.depositRequired,minAge:e.minAge,maxAge:e.maxAge,prerequisites:e.prerequisites,notes:e.notes||""})):(K(null),te({name:"",description:"",level:"BEGINNER",category:"OBEDIENCE",instructorId:"",maxCapacity:8,startDate:new Date,totalWeeks:6,daysOfWeek:[1],startTime:"18:00",endTime:"19:00",pricePerSeries:200,notes:""})),Z(!0)},me=()=>{Z(!1),K(null)},ge=()=>{re(!1),ne(null),ue([]),he({customerId:"",petId:"",amountPaid:0})},ve=e=>{switch(e){case"SCHEDULED":return"primary";case"IN_PROGRESS":return"warning";case"COMPLETED":return"success";case"CANCELLED":return"error";default:return"default"}},pe=e=>{switch(e){case"BEGINNER":return"success";case"INTERMEDIATE":return"warning";case"ADVANCED":return"error";default:return"default"}},ye=e=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e];return _&&0===t.length?(0,z.jsx)(r.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,z.jsx)(i.A,{})}):(0,z.jsxs)(r.A,{children:[(0,z.jsxs)(r.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,z.jsx)(n.A,{variant:"h4",children:"Training Classes"}),(0,z.jsx)(c.A,{variant:"contained",color:"primary",startIcon:(0,z.jsx)(W.A,{}),onClick:()=>je(),children:"New Class"})]}),H&&(0,z.jsx)(d.A,{severity:"error",onClose:()=>U(null),sx:{mb:2},children:H}),(0,z.jsx)(o.A,{sx:{p:2,mb:2},children:(0,z.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,z.jsx)(u.Ay,{item:!0,xs:12,md:3,children:(0,z.jsxs)(A.A,{fullWidth:!0,children:[(0,z.jsx)(h.A,{children:"Status"}),(0,z.jsxs)(x.A,{value:le.status,onChange:e=>se((0,s.A)((0,s.A)({},le),{},{status:e.target.value})),label:"Status",children:[(0,z.jsx)(j.A,{value:"",children:"All"}),(0,z.jsx)(j.A,{value:"SCHEDULED",children:"Scheduled"}),(0,z.jsx)(j.A,{value:"IN_PROGRESS",children:"In Progress"}),(0,z.jsx)(j.A,{value:"COMPLETED",children:"Completed"}),(0,z.jsx)(j.A,{value:"CANCELLED",children:"Cancelled"})]})]})}),(0,z.jsx)(u.Ay,{item:!0,xs:12,md:3,children:(0,z.jsxs)(A.A,{fullWidth:!0,children:[(0,z.jsx)(h.A,{children:"Category"}),(0,z.jsxs)(x.A,{value:le.category,onChange:e=>se((0,s.A)((0,s.A)({},le),{},{category:e.target.value})),label:"Category",children:[(0,z.jsx)(j.A,{value:"",children:"All"}),(0,z.jsx)(j.A,{value:"PUPPY",children:"Puppy"}),(0,z.jsx)(j.A,{value:"OBEDIENCE",children:"Obedience"}),(0,z.jsx)(j.A,{value:"AGILITY",children:"Agility"}),(0,z.jsx)(j.A,{value:"BEHAVIOR",children:"Behavior"})]})]})}),(0,z.jsx)(u.Ay,{item:!0,xs:12,md:3,children:(0,z.jsxs)(A.A,{fullWidth:!0,children:[(0,z.jsx)(h.A,{children:"Level"}),(0,z.jsxs)(x.A,{value:le.level,onChange:e=>se((0,s.A)((0,s.A)({},le),{},{level:e.target.value})),label:"Level",children:[(0,z.jsx)(j.A,{value:"",children:"All"}),(0,z.jsx)(j.A,{value:"BEGINNER",children:"Beginner"}),(0,z.jsx)(j.A,{value:"INTERMEDIATE",children:"Intermediate"}),(0,z.jsx)(j.A,{value:"ADVANCED",children:"Advanced"})]})]})}),(0,z.jsx)(u.Ay,{item:!0,xs:12,md:3,children:(0,z.jsx)(c.A,{variant:"outlined",onClick:()=>se({status:"",category:"",level:"",isActive:!0}),fullWidth:!0,sx:{height:"56px"},children:"Clear Filters"})})]})}),(0,z.jsx)(o.A,{children:(0,z.jsx)(m.A,{children:(0,z.jsxs)(g.A,{children:[(0,z.jsx)(v.A,{children:(0,z.jsxs)(p.A,{children:[(0,z.jsx)(y.A,{children:"Class Name"}),(0,z.jsx)(y.A,{children:"Category"}),(0,z.jsx)(y.A,{children:"Level"}),(0,z.jsx)(y.A,{children:"Schedule"}),(0,z.jsx)(y.A,{children:"Instructor"}),(0,z.jsx)(y.A,{children:"Enrollment"}),(0,z.jsx)(y.A,{children:"Status"}),(0,z.jsx)(y.A,{align:"right",children:"Actions"})]})}),(0,z.jsx)(C.A,{children:0===t.length?(0,z.jsx)(p.A,{children:(0,z.jsx)(y.A,{colSpan:8,align:"center",children:(0,z.jsx)(n.A,{color:"textSecondary",py:4,children:'No training classes found. Click "New Class" to create one.'})})}):t.map(t=>{var l;return(0,z.jsxs)(p.A,{children:[(0,z.jsxs)(y.A,{children:[(0,z.jsx)(n.A,{variant:"body1",fontWeight:"medium",children:t.name}),(0,z.jsxs)(n.A,{variant:"caption",color:"textSecondary",children:[t.totalWeeks," weeks \u2022 $",t.pricePerSeries]})]}),(0,z.jsx)(y.A,{children:(0,z.jsx)(f.A,{label:t.category,size:"small",variant:"outlined"})}),(0,z.jsx)(y.A,{children:(0,z.jsx)(f.A,{label:t.level,size:"small",color:pe(t.level)})}),(0,z.jsxs)(y.A,{children:[(0,z.jsx)(n.A,{variant:"body2",children:t.daysOfWeek.map(ye).join(", ")}),(0,z.jsxs)(n.A,{variant:"caption",color:"textSecondary",children:[t.startTime," - ",t.endTime]})]}),(0,z.jsx)(y.A,{children:t.instructor?"".concat(t.instructor.firstName," ").concat(t.instructor.lastName):"TBD"}),(0,z.jsxs)(y.A,{children:[(0,z.jsxs)(n.A,{variant:"body2",children:[t.currentEnrolled," / ",t.maxCapacity]}),(null===(l=t._count)||void 0===l?void 0:l.waitlist)&&t._count.waitlist>0&&(0,z.jsxs)(n.A,{variant:"caption",color:"warning.main",children:["+",t._count.waitlist," waitlist"]})]}),(0,z.jsx)(y.A,{children:(0,z.jsx)(f.A,{label:t.status.replace("_"," "),color:ve(t.status),size:"small"})}),(0,z.jsxs)(y.A,{align:"right",children:[(0,z.jsx)(E.A,{title:"Enroll Pet",children:(0,z.jsx)(I.A,{size:"small",onClick:()=>(async e=>{ne(e),he({customerId:"",petId:"",amountPaid:e.pricePerSeries||0});try{const e=await G.m.getAllCustomers(1,100);de(e.data||[])}catch(t){console.error("Error loading customers:",t)}re(!0)})(t),color:"success",children:(0,z.jsx)(B.A,{})})}),(0,z.jsx)(E.A,{title:"View Enrollments",children:(0,z.jsx)(I.A,{size:"small",onClick:()=>e("/training/classes/".concat(t.id,"/enrollments")),color:"info",children:(0,z.jsx)(O.A,{})})}),(0,z.jsx)(E.A,{title:"Edit",children:(0,z.jsx)(I.A,{size:"small",onClick:()=>je(t),color:"primary",children:(0,z.jsx)(N.A,{})})}),(0,z.jsx)(E.A,{title:"Duplicate",children:(0,z.jsx)(I.A,{size:"small",onClick:()=>(async e=>{const t=prompt("Enter start date for new class (YYYY-MM-DD):");if(t)try{await q.Ay.trainingClasses.duplicate(e,t),await xe()}catch(l){U(l.message||"Failed to duplicate class")}})(t.id),color:"primary",children:(0,z.jsx)(k.A,{})})}),(0,z.jsx)(E.A,{title:"Delete",children:(0,z.jsx)(I.A,{size:"small",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this training class?"))try{await q.Ay.trainingClasses.delete(e),await xe()}catch(t){U(t.message||"Failed to delete class")}})(t.id),color:"error",children:(0,z.jsx)(T.A,{})})})]})]},t.id)})})]})})}),(0,z.jsxs)(S.A,{open:$,onClose:me,maxWidth:"md",fullWidth:!0,children:[(0,z.jsx)(D.A,{children:J?"Edit Training Class":"New Training Class"}),(0,z.jsxs)(b.A,{children:[H&&(0,z.jsx)(d.A,{severity:"error",onClose:()=>U(null),sx:{mb:2},children:H}),(0,z.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,z.jsx)(P.A,{label:"Class Name",value:ee.name,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{name:e.target.value})),required:!0,fullWidth:!0}),(0,z.jsx)(P.A,{label:"Description",value:ee.description,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{description:e.target.value})),multiline:!0,rows:2,fullWidth:!0}),(0,z.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsxs)(A.A,{fullWidth:!0,children:[(0,z.jsx)(h.A,{children:"Category"}),(0,z.jsxs)(x.A,{value:ee.category,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{category:e.target.value})),label:"Category",children:[(0,z.jsx)(j.A,{value:"PUPPY",children:"Puppy"}),(0,z.jsx)(j.A,{value:"OBEDIENCE",children:"Obedience"}),(0,z.jsx)(j.A,{value:"AGILITY",children:"Agility"}),(0,z.jsx)(j.A,{value:"BEHAVIOR",children:"Behavior"})]})]})}),(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsxs)(A.A,{fullWidth:!0,children:[(0,z.jsx)(h.A,{children:"Level"}),(0,z.jsxs)(x.A,{value:ee.level,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{level:e.target.value})),label:"Level",children:[(0,z.jsx)(j.A,{value:"BEGINNER",children:"Beginner"}),(0,z.jsx)(j.A,{value:"INTERMEDIATE",children:"Intermediate"}),(0,z.jsx)(j.A,{value:"ADVANCED",children:"Advanced"})]})]})})]}),(0,z.jsxs)(A.A,{fullWidth:!0,required:!0,children:[(0,z.jsx)(h.A,{id:"instructor-label",children:"Instructor"}),(0,z.jsxs)(x.A,{labelId:"instructor-label",id:"instructor",value:ee.instructorId,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{instructorId:e.target.value})),label:"Instructor",children:[(0,z.jsx)(j.A,{value:"",children:(0,z.jsx)("em",{children:"Select an instructor"})}),(0,z.jsx)(j.A,{value:"default-instructor",children:"Default Instructor"})]})]}),(0,z.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsx)(P.A,{label:"Max Capacity",type:"number",value:ee.maxCapacity,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{maxCapacity:parseInt(e.target.value)})),fullWidth:!0})}),(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsx)(P.A,{label:"Total Weeks",type:"number",value:ee.totalWeeks,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{totalWeeks:parseInt(e.target.value)})),fullWidth:!0})})]}),(0,z.jsx)(M.$,{dateAdapter:F.h,children:(0,z.jsx)(R.l,{label:"Start Date",value:ee.startDate,onChange:e=>{const t=e||new Date,l=t instanceof Date?t.getDay():0;console.log("Start date changed to:",t,"Day of week:",l),te((0,s.A)((0,s.A)({},ee),{},{startDate:t,daysOfWeek:[l]}))},slotProps:{textField:{fullWidth:!0}}})}),(0,z.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsx)(P.A,{label:"Start Time",type:"time",value:ee.startTime,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{startTime:e.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0})}),(0,z.jsx)(u.Ay,{item:!0,xs:6,children:(0,z.jsx)(P.A,{label:"End Time",type:"time",value:ee.endTime,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{endTime:e.target.value})),InputLabelProps:{shrink:!0},fullWidth:!0})})]}),(0,z.jsx)(P.A,{label:"Price Per Series",type:"number",value:ee.pricePerSeries,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{pricePerSeries:parseFloat(e.target.value)})),fullWidth:!0}),(0,z.jsx)(P.A,{label:"Notes",value:ee.notes,onChange:e=>te((0,s.A)((0,s.A)({},ee),{},{notes:e.target.value})),multiline:!0,rows:3,fullWidth:!0})]})]}),(0,z.jsxs)(w.A,{children:[(0,z.jsx)(c.A,{onClick:me,children:"Cancel"}),(0,z.jsx)(c.A,{onClick:async()=>{try{var e;if(!ee.name||!ee.instructorId||!ee.maxCapacity||!ee.startDate||!ee.totalWeeks||null===(e=ee.daysOfWeek)||void 0===e||!e.length||!ee.startTime||!ee.endTime||!ee.pricePerSeries)return void U("Please fill in all required fields (name, instructor, capacity, dates, times, price)");const t=e=>{if("string"===typeof e)return e;const t=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(l,"-").concat(s)},l=(0,s.A)((0,s.A)({},ee),{},{startDate:t(ee.startDate),endDate:ee.endDate?t(ee.endDate):void 0});console.log("Creating training class with data:",l),console.log("Start date formatted as:",l.startDate),J?await q.Ay.trainingClasses.update(J.id,l):await q.Ay.trainingClasses.create(l),await xe(),me()}catch(a){var t,l;console.error("Error saving training class:",a),U((null===(t=a.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.message)||a.message||"Failed to save training class")}},variant:"contained",color:"primary",children:J?"Update":"Create"})]})]}),(0,z.jsxs)(S.A,{open:ae,onClose:ge,maxWidth:"sm",fullWidth:!0,children:[(0,z.jsxs)(D.A,{children:["Enroll Pet in ",null===ie||void 0===ie?void 0:ie.name]}),(0,z.jsxs)(b.A,{children:[H&&(0,z.jsx)(d.A,{severity:"error",onClose:()=>U(null),sx:{mb:2},children:H}),(0,z.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[(0,z.jsxs)(A.A,{fullWidth:!0,required:!0,children:[(0,z.jsx)(h.A,{children:"Customer"}),(0,z.jsxs)(x.A,{value:Ae.customerId,onChange:e=>(async e=>{if(he((0,s.A)((0,s.A)({},Ae),{},{customerId:e,petId:""})),e)try{const t=await Y.B.getPetsByCustomer(e);ue(t.data||[])}catch(t){console.error("Error loading pets:",t),ue([])}else ue([])})(e.target.value),label:"Customer",children:[(0,z.jsx)(j.A,{value:"",children:(0,z.jsx)("em",{children:"Select a customer"})}),ce.map(e=>(0,z.jsxs)(j.A,{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,z.jsxs)(A.A,{fullWidth:!0,required:!0,disabled:!Ae.customerId,children:[(0,z.jsx)(h.A,{children:"Pet"}),(0,z.jsxs)(x.A,{value:Ae.petId,onChange:e=>he((0,s.A)((0,s.A)({},Ae),{},{petId:e.target.value})),label:"Pet",children:[(0,z.jsx)(j.A,{value:"",children:(0,z.jsx)("em",{children:"Select a pet"})}),oe.map(e=>(0,z.jsxs)(j.A,{value:e.id,children:[e.name," (",e.breed||"Pet",")"]},e.id))]})]}),(0,z.jsx)(P.A,{label:"Amount Paid",type:"number",value:Ae.amountPaid,onChange:e=>he((0,s.A)((0,s.A)({},Ae),{},{amountPaid:parseFloat(e.target.value)||0})),fullWidth:!0,helperText:"Class price: $".concat((null===ie||void 0===ie?void 0:ie.pricePerSeries)||0)}),ie&&(0,z.jsx)(r.A,{sx:{p:2,bgcolor:"info.light",borderRadius:1},children:(0,z.jsxs)(n.A,{variant:"body2",color:"info.contrastText",children:[(0,z.jsx)("strong",{children:"Class Details:"}),(0,z.jsx)("br",{}),ie.totalWeeks," weeks \u2022 ",ie.daysOfWeek.length," days/week",(0,z.jsx)("br",{}),"Capacity: ",ie.currentEnrolled," / ",ie.maxCapacity]})})]})]}),(0,z.jsxs)(w.A,{children:[(0,z.jsx)(c.A,{onClick:ge,children:"Cancel"}),(0,z.jsx)(c.A,{onClick:async()=>{if(Ae.customerId&&Ae.petId&&ie)try{await q.Ay.enrollments.enroll(ie.id,{customerId:Ae.customerId,petId:Ae.petId,amountPaid:Ae.amountPaid}),await xe(),ge(),U(null)}catch(l){var e,t;U((null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||l.message||"Failed to enroll pet")}else U("Please select both customer and pet")},variant:"contained",color:"success",disabled:!Ae.customerId||!Ae.petId,children:"Enroll Pet"})]})]})]})}}}]);