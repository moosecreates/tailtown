"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[6463],{96463:(e,t,r)=>{r.d(t,{A:()=>x});var n=r(89379),s=r(9950),o=r(21072),a=r(27758),i=r(57327),l=r(88008),c=r(78317),d=r(82053),v=r(2235),u=r(96583),f=r(40033),g=r(28170),p=r(69179),m=r(46001),h=r(92685),y=r(78114),C=r(44414);const x=e=>{let{onEventUpdate:t,serviceCategories:r,calendarTitle:x,staffId:A}=e;const[I,w]=(0,s.useState)([]),[D,b]=(0,s.useState)(!1),[S,E]=(0,s.useState)(null),[N,j]=(0,s.useState)(null),k=(0,s.useCallback)(async()=>{try{var e;const s=[],o=await p.u.getAllReservations(1,500,"startDate","desc","PENDING,CONFIRMED,CHECKED_IN");if("success"===(null===o||void 0===o?void 0:o.status)&&null!==o&&void 0!==o&&null!==(e=o.data)&&void 0!==e&&e.reservations&&Array.isArray(o.data.reservations)){let e=o.data.reservations;r&&r.length>0&&(e=e.filter(e=>{if(!e.service||"object"!==typeof e.service)return!1;const t=e.service;if(!t.serviceCategory)return!1;t.serviceCategory;return r.includes(t.serviceCategory)})),A&&(console.log("Filtering by staffId:",A),console.log("All reservations:",e.map(e=>{var t,r;return{id:e.id,pet:null===(t=e.pet)||void 0===t?void 0:t.name,staffAssignedId:e.staffAssignedId,service:null===(r=e.service)||void 0===r?void 0:r.name}})),e=e.filter(e=>e.staffAssignedId===A||!e.staffAssignedId),console.log("After filtering:",e.length,"reservations"));const t=e.map(e=>{var t,r,n;const s="GROOMING"===(null===(t=e.service)||void 0===t?void 0:t.serviceCategory)&&!e.staffAssignedId?" (Unassigned)":"";return{id:e.id,title:"".concat((null===(r=e.pet)||void 0===r?void 0:r.name)||"Pet"," - ").concat((null===(n=e.service)||void 0===n?void 0:n.name)||"Service").concat(s),start:e.startDate,end:e.endDate,backgroundColor:T(e.status),borderColor:T(e.status),textColor:"#ffffff",extendedProps:{reservation:e,type:"reservation"}}});s.push(...t)}else console.warn("SpecializedCalendar: Invalid response format or no reservations found");if(r&&r.includes(y.e.TRAINING)){console.log("Loading training classes for calendar...");try{const e=await m.Ay.trainingClasses.getAll({isActive:!0});if(console.log("Training classes response:",e),e&&Array.isArray(e)){console.log("Found ".concat(e.length," training classes"));for(const r of e)try{console.log("Loading sessions for class: ".concat(r.name," (").concat(r.id,")"));const e=await m.Ay.trainingClasses.getSessions(r.id);if(console.log("Sessions for ".concat(r.name,":"),e),e&&Array.isArray(e)){console.log("Creating ".concat(e.length," session events"));const t=e.map(e=>{const t=e.scheduledDate.split("T")[0],[n,s,o]=t.split("-").map(Number),[a,i]=e.scheduledTime.split(":").map(Number),l=new Date(n,s-1,o,a,i,0,0),c=new Date(l);return c.setMinutes(c.getMinutes()+(e.duration||60)),console.log("Session ".concat(e.sessionNumber,": ").concat(t," ").concat(e.scheduledTime," -> ").concat(l.toLocaleString())),{id:"class-session-".concat(e.id),title:"".concat(r.name," - Session ").concat(e.sessionNumber),start:l,end:c,backgroundColor:"#9c27b0",borderColor:"#7b1fa2",textColor:"#ffffff",extendedProps:{type:"trainingClass",trainingClass:r,session:e}}});console.log("Session events created:",t),s.push(...t)}}catch(t){console.error("Error loading sessions for class ".concat(r.id,":"),t)}}}catch(n){console.error("Error loading training classes:",n)}}return console.log("Total events to display:",s.length,s),w(s),s}catch(s){return console.error("SpecializedCalendar: Error loading reservations:",s),w([]),[]}},[r,A]);(0,s.useEffect)(()=>{k()},[k]),(0,s.useEffect)(()=>{const e=e=>{b(!1),j(null),E(null),k()};return document.addEventListener("reservationComplete",e),()=>{document.removeEventListener("reservationComplete",e)}},[k]);const T=e=>{switch(e){case"CONFIRMED":return"#4caf50";case"PENDING":return"#ff9800";case"CHECKED_IN":return"#2196f3";case"CHECKED_OUT":default:return"#9e9e9e";case"CANCELLED":return"#f44336"}};return(0,C.jsxs)(c.A,{sx:{height:"calc(100vh - 200px)",p:2},children:[(0,C.jsx)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,C.jsxs)(d.A,{variant:"h5",component:"h2",children:[x||"Specialized Calendar"," (",I.length," reservations)"]})}),(0,C.jsx)(v.A,{elevation:3,sx:{height:"calc(100% - 60px)",p:2},children:(0,C.jsx)(o.A,{plugins:[a.A,i.A,l.Ay],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},initialView:"timeGridWeek",editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,events:I,select:e=>{const t=e.start,r=e.end;E({start:t,end:r}),b(!0)},eventClick:e=>{const t=e.event.extendedProps.reservation;if(t){const e=(0,n.A)((0,n.A)({},t),{},{customerId:t.customerId,petId:t.petId,serviceId:t.serviceId});j(e),E({start:new Date(t.startDate),end:new Date(t.endDate)}),b(!0)}},eventDrop:async e=>{try{const t=e.event.extendedProps.reservation;if(!t)return console.error("No reservation data found in event"),void e.revert();const r=e.event.start,n=e.event.end;if(!r||!n)return console.error("Invalid dates after drop"),void e.revert();await p.u.updateReservation(t.id,{startDate:r.toISOString(),endDate:n.toISOString()}),await k(),console.log("Reservation updated successfully after drag")}catch(t){console.error("Error updating reservation after drag:",t),e.revert()}},eventResize:async e=>{try{const t=e.event.extendedProps.reservation;if(!t)return console.error("No reservation data found in event"),void e.revert();const r=e.event.start,n=e.event.end;if(!r||!n)return console.error("Invalid dates after resize"),void e.revert();await p.u.updateReservation(t.id,{startDate:r.toISOString(),endDate:n.toISOString()}),await k(),console.log("Reservation updated successfully after resize")}catch(t){console.error("Error updating reservation after resize:",t),e.revert()}},height:"100%",slotMinTime:"06:00:00",slotMaxTime:"20:00:00",eventColor:"#4c8bf5",eventTextColor:"#ffffff",timeZone:"local",locale:"en-US",eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!0},slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!0},buttonText:{today:"Today",month:"Month",week:"Week",day:"Day"},views:{timeGrid:{nowIndicator:!0},timeGridDay:{},timeGridWeek:{}},dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}})}),(0,C.jsxs)(u.A,{open:D,onClose:()=>{b(!1),j(null),E(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh"}},children:[(0,C.jsx)(f.A,{sx:{py:1,px:2,fontSize:"1rem"},children:N?"Edit Reservation":"Create New Reservation"}),(0,C.jsx)(g.A,{sx:{py:1,px:2},children:N||S?(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(h.A,{onSubmit:async e=>{try{let r;if(N)r=await p.u.updateReservation(N.id,e);else{const t=await p.u.createReservation(e);r=t,"object"===typeof t&&null!==t&&"data"in t&&"status"in t&&"success"===t.status&&(r=t.data)}if(r){const e=await k();w([...e]),t&&"object"===typeof r&&null!==r&&t(r);let n="";return"object"===typeof r&&null!==r&&("id"in r?n=r.id:"_id"in r&&(n=r._id)),N&&(b(!1),j(null),E(null)),{reservationId:n}}console.warn("SpecializedCalendar: No reservation returned from server")}catch(r){throw console.error("SpecializedCalendar: Error saving reservation:",r),r}},initialData:N||void 0,defaultDates:S||void 0,showAddOns:!0,serviceCategories:r})}):(0,C.jsx)("div",{children:"Loading reservation form..."})})]})]})}}}]);