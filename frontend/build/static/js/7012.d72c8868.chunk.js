"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[7012],{87012:(e,t,n)=>{n.r(t),n.d(t,{default:()=>se});var o=n(9950),s=n(78317),i=n(82053),a=n(25333),r=n(8145),l=n(10226),c=n(26858),d=n(68476),u=n(52946),h=n(26014),v=n(83337),m=n(4477),g=n(46639),p=n(2235),f=n(44414);const x=o.memo(e=>{let{title:t,value:n,icon:a,onClick:r,isActive:l=!1,isLoading:c=!1}=e;const d=o.useMemo(()=>c||null===n?(0,f.jsx)(g.A,{size:20}):n,[c,n]);return(0,f.jsxs)(p.A,{elevation:2,onClick:r,sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",height:70,borderRadius:2,position:"relative",overflow:"hidden",cursor:r?"pointer":"default",opacity:l?1:.9,border:l?2:0,borderColor:l?"primary.main":"transparent",transition:"all 0.2s ease","&:hover":r?{transform:"translateY(-2px)",boxShadow:3}:{}},children:[(0,f.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,f.jsx)(i.A,{variant:"subtitle2",component:"div",sx:{fontWeight:500,fontSize:"0.875rem"},children:t}),(0,f.jsx)(i.A,{variant:"h4",component:"div",sx:{fontWeight:"bold"},children:d})]}),(0,f.jsx)(s.A,{sx:{transform:"scale(0.8)"},children:a})]})});x.displayName="MetricCard";const A=x,C=e=>{let{inCount:t,outCount:n,overnightCount:o,appointmentFilter:i,onFilterChange:a}=e;const r=[{title:"In",value:t,icon:(0,f.jsx)(h.A,{sx:{fontSize:40,color:"primary.main"}}),onClick:()=>a("in"),isActive:"in"===i},{title:"Out",value:n,icon:(0,f.jsx)(v.A,{sx:{fontSize:40,color:"secondary.main"}}),onClick:()=>a("out"),isActive:"out"===i},{title:"Overnight",value:o,icon:(0,f.jsx)(m.A,{sx:{fontSize:40,color:"success.main"}}),onClick:void 0,isActive:!1}];return(0,f.jsx)(s.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr",md:"repeat(3, 1fr)"},gap:2},children:r.map((e,t)=>(0,f.jsx)(A,{title:e.title,value:e.value,icon:e.icon,onClick:e.onClick,isActive:e.isActive,isLoading:null===e.value},t))})};var D=n(48089),y=n(45180),j=n(25277),S=n(50704),b=n(2046),w=n(249),k=n(26050),E=n(83274),N=n(28429),I=n(42074),R=n(4983),z=n(16632),F=n(19223),M=n(7762),O=n(82508),W=n(71891);const U=e=>{let{reservations:t,loading:n,error:c,filter:d,onFilterChange:u}=e;const h=(0,N.Zp)(),[v,m]=(0,o.useState)(""),[p,x]=(0,o.useState)(null),A=(0,o.useMemo)(()=>{if(!v.trim())return t;const e=v.toLowerCase();return t.filter(t=>{var n,o,s,i,a,r,l,c,d,u;const h=(null===(n=t.pet)||void 0===n||null===(o=n.name)||void 0===o?void 0:o.toLowerCase())||"",v=(null===(s=t.customer)||void 0===s||null===(i=s.firstName)||void 0===i?void 0:i.toLowerCase())||"",m=(null===(a=t.customer)||void 0===a||null===(r=a.lastName)||void 0===r?void 0:r.toLowerCase())||"",g="".concat(v," ").concat(m).trim(),p=(null===(l=t.resource)||void 0===l||null===(c=l.name)||void 0===c?void 0:c.toLowerCase())||"",f=(null===(d=t.service)||void 0===d||null===(u=d.name)||void 0===u?void 0:u.toLowerCase())||"";return h.includes(e)||v.includes(e)||m.includes(e)||g.includes(e)||p.includes(e)||f.includes(e)})},[t,v]),C=e=>{switch(e){case"CONFIRMED":return"success";case"PENDING":return"warning";case"CHECKED_IN":return"info";case"CANCELLED":return"error";default:return"default"}};return(0,f.jsxs)(D.A,{children:[(0,f.jsx)(y.A,{title:(0,f.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(()=>{switch(d){case"in":return"Check-Ins Today";case"out":return"Check-Outs Today";default:return"Upcoming Appointments"}})(),t.length>0&&(0,f.jsx)(j.A,{label:v?"".concat(A.length," of ").concat(t.length):t.length,size:"small",color:"primary",variant:"outlined"})]}),action:(0,f.jsxs)(s.A,{sx:{display:"flex",gap:1},children:[(0,f.jsx)(l.A,{size:"small",variant:"all"===d?"contained":"outlined",onClick:()=>u("all"),children:"All"}),(0,f.jsx)(l.A,{size:"small",variant:"in"===d?"contained":"outlined",onClick:()=>u("in"),children:"Check-Ins"}),(0,f.jsx)(l.A,{size:"small",variant:"out"===d?"contained":"outlined",onClick:()=>u("out"),children:"Check-Outs"})]})}),(0,f.jsxs)(S.A,{children:[(0,f.jsx)(r.A,{fullWidth:!0,size:"small",placeholder:"Search by pet name, customer name, kennel, or service...",value:v,onChange:e=>m(e.target.value),sx:{mb:2},InputProps:{startAdornment:(0,f.jsx)(b.A,{position:"start",children:(0,f.jsx)(F.A,{})}),endAdornment:v&&(0,f.jsx)(b.A,{position:"end",children:(0,f.jsx)(a.A,{size:"small",onClick:()=>{m("")},children:(0,f.jsx)(M.A,{fontSize:"small"})})})}}),n?(0,f.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,f.jsx)(g.A,{})}):c?(0,f.jsx)(i.A,{color:"error",children:c}):0===t.length?(0,f.jsxs)(i.A,{color:"text.secondary",children:["No ","in"===d?"check-ins":"out"===d?"check-outs":"appointments"," scheduled"]}):0===A.length?(0,f.jsxs)(i.A,{color:"text.secondary",children:['No reservations match your search "',v,'"']}):(0,f.jsx)(w.A,{sx:{maxHeight:500,overflow:"auto",p:0,"& .MuiListItem-root":{borderBottom:1,borderColor:"divider","&:last-child":{borderBottom:0}}},children:A.map(e=>{var t,n,o,r,l,c,u,v,m,g;return(0,f.jsx)(k.Ay,{sx:{py:1,px:2,bgcolor:(g=null===(t=e.service)||void 0===t?void 0:t.serviceCategory,"DAYCARE"===g?"rgba(255, 152, 0, 0.08)":"rgba(25, 118, 210, 0.08)"),"&:hover":{bgcolor:"DAYCARE"===(null===(n=e.service)||void 0===n?void 0:n.serviceCategory)?"rgba(255, 152, 0, 0.15)":"rgba(25, 118, 210, 0.15)"}},secondaryAction:(0,f.jsxs)(s.A,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[(0,f.jsx)(E.A,{title:"Print Kennel Card",children:(0,f.jsx)(a.A,{size:"small",color:"primary",onClick:t=>{t.stopPropagation(),(e=>{x(e.id),setTimeout(()=>{window.print(),x(null)},100)})(e)},children:(0,f.jsx)(z.A,{fontSize:"small"})})}),"in"===d&&"CONFIRMED"===e.status?(0,f.jsx)(E.A,{title:"Start Check-In",children:(0,f.jsx)(a.A,{edge:"end",color:"primary",onClick:t=>{t.stopPropagation(),h("/check-in/".concat(e.id))},children:(0,f.jsx)(R.A,{})})}):(0,f.jsx)(j.A,{label:e.status,color:C(e.status),size:"small"})]}),children:(0,f.jsxs)(s.A,{sx:{flex:1,display:"flex",flexDirection:"column",gap:.25,cursor:"pointer"},onClick:()=>h("/reservations/".concat(e.id)),children:[(0,f.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,f.jsx)(O.A,{petName:(null===(o=e.pet)||void 0===o?void 0:o.name)||"Unknown Pet",petIcons:null===(r=e.pet)||void 0===r?void 0:r.petIcons}),(0,f.jsxs)(i.A,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["\u2022 ",(null===(l=e.customer)||void 0===l?void 0:l.firstName)||""," ",(null===(c=e.customer)||void 0===c?void 0:c.lastName)||"Unknown"]})]}),(0,f.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[(null===(u=e.resource)||void 0===u?void 0:u.name)&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(j.A,{label:e.resource.name.length>1?e.resource.name.slice(0,-1)+" "+e.resource.name.slice(-1):e.resource.name,size:"small",variant:"outlined",sx:{height:18,fontSize:"0.75rem",fontWeight:600,backgroundColor:"white"}}),(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"\u2022"})]}),(null===(v=e.service)||void 0===v?void 0:v.name)&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:e.service.name}),(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:"\u2022"})]}),(0,f.jsx)(i.A,{variant:"caption",color:"text.secondary",children:(m=e.startDate,new Date(m).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}))})]})]})},e.id)})}),t.length>0&&(0,f.jsx)(s.A,{sx:{mt:2,textAlign:"center"},children:(0,f.jsx)(l.A,{component:I.N_,to:"/calendar",variant:"outlined",size:"small",children:"View All Reservations"})})]}),p&&(0,f.jsx)(s.A,{sx:{display:"none","@media print":{display:"block"}},children:((e,n)=>{const o=t.find(e=>e.id===p);return o&&o.pet&&o.customer?(0,f.jsx)(W.A,{kennelNumber:(null===(e=o.resource)||void 0===e?void 0:e.name)||"N/A",suiteType:(null===(n=o.resource)||void 0===n?void 0:n.type)||"STANDARD",petName:o.pet.name,petBreed:o.pet.breed,petIconIds:o.pet.petIcons||[],petType:o.pet.type,ownerName:"".concat(o.customer.firstName||""," ").concat(o.customer.lastName||"").trim(),startDate:new Date(o.startDate),endDate:new Date(o.endDate)}):null})()})]})};var L=n(6693),T=n(89379),P=n(80045),Y=n(62999),B=n(37027);const G=["children","padding","customPadding","center","backgroundColor","fullWidth","sx"],_=e=>{var t,n,o;let{children:s,padding:i=!0,customPadding:a,center:r=!1,backgroundColor:l,fullWidth:c=!1,sx:d}=e,u=(0,P.A)(e,G);const{isMobile:h,isTablet:v}=(0,B.Qs)(),m={mobile:null!==(t=null===a||void 0===a?void 0:a.mobile)&&void 0!==t?t:2,tablet:null!==(n=null===a||void 0===a?void 0:a.tablet)&&void 0!==n?n:3,desktop:null!==(o=null===a||void 0===a?void 0:a.desktop)&&void 0!==o?o:4};!c&&(0,B.$g)(h,v);return(0,f.jsx)(Y.A,(0,T.A)((0,T.A)({maxWidth:!c&&"lg",sx:(0,T.A)((0,T.A)((0,T.A)((0,T.A)({},i&&{p:(0,B.yB)(m.mobile,m.tablet,m.desktop)}),r&&{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),l&&{backgroundColor:l}),d)},u),{},{children:s}))};var H=n(69179);let K=function(e){return e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.SUCCESS=3]="SUCCESS",e[e.DEBUG=4]="DEBUG",e}({});const Q={ERROR:"#f44336",WARN:"#ff9800",INFO:"#2196f3",SUCCESS:"#4caf50",DEBUG:"#9e9e9e"},V={level:K.WARN,enableColors:!0,includeTimestamps:!1};class Z{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.config=(0,T.A)((0,T.A)({},V),e)}formatMessage(e,t,n){const o=[];return this.config.includeTimestamps&&o.push((new Date).toISOString()),this.config.prefix&&o.push("[".concat(this.config.prefix,"]")),o.push("[".concat(e,"]")),o.push(t),o.join(" ")}logWithColor(e,t,n){this.config.enableColors&&"undefined"!==typeof window?console.log("%c".concat(t),"color: ".concat(Q[e],"; font-weight: bold"),void 0!==n?n:""):console.log(t,void 0!==n?n:"")}error(e,t){if(this.config.level>=K.ERROR){const n=this.formatMessage("ERROR",e,t);this.config.enableColors?console.error("%c".concat(n),"color: ".concat(Q.ERROR,"; font-weight: bold"),void 0!==t?t:""):console.error(n,void 0!==t?t:"")}}warn(e,t){if(this.config.level>=K.WARN){const n=this.formatMessage("WARN",e,t);this.config.enableColors?console.warn("%c".concat(n),"color: ".concat(Q.WARN,"; font-weight: bold"),void 0!==t?t:""):console.warn(n,void 0!==t?t:"")}}info(e,t){if(this.config.level>=K.INFO){const n=this.formatMessage("INFO",e,t);this.logWithColor("INFO",n,t)}}success(e,t){if(this.config.level>=K.SUCCESS){const n=this.formatMessage("SUCCESS",e,t);this.logWithColor("SUCCESS",n,t)}}debug(e,t){if(this.config.level>=K.DEBUG){const n=this.formatMessage("DEBUG",e,t);this.logWithColor("DEBUG",n,t)}}setLevel(e){this.config.level=e}child(e){return new Z((0,T.A)((0,T.A)({},this.config),{},{prefix:this.config.prefix?"".concat(this.config.prefix,":").concat(e):e}))}}const $=new Z,q={api:{customerServiceUrl:"http://localhost:4004",reservationServiceUrl:"http://localhost:4003",timeout:3e4,defaultTenantId:"dev",includeTenantId:!0},calendar:{defaultView:"week",dayStartTime:"06:00:00",dayEndTime:"20:00:00",slotDuration:30,showWeekends:!0,statusColors:{CONFIRMED:"#4caf50",PENDING:"#ff9800",CHECKED_IN:"#2196f3",CHECKED_OUT:"#9e9e9e",COMPLETED:"#673ab7",CANCELLED:"#f44336",NO_SHOW:"#d32f2f",default:"#9e9e9e"}},pagination:{defaultPageSize:10,pageSizes:[5,10,20,50]},dateFormat:{displayDate:"MM/DD/YYYY",displayTime:"h:mm A",displayDateTime:"MM/DD/YYYY h:mm A",apiDate:"YYYY-MM-DD"},features:{enableDarkMode:!1,showDebugPanel:!0,mockApi:!1,useNewCalendarComponents:!0}};(0,T.A)((0,T.A)({},q),{},{api:(0,T.A)((0,T.A)({},q.api),{},{customerServiceUrl:"http://localhost:4004",reservationServiceUrl:"http://localhost:4003",defaultTenantId:""}),features:(0,T.A)((0,T.A)({},q.features),{},{showDebugPanel:!1,mockApi:!1,useNewCalendarComponents:!0})});var J=n(88225);const X=e=>{if(!e)return e;const t=(e=>{if(!e)return["vaccinations-overdue"];try{const{expired:t,missing:n,current:o}=(0,J.P5)(e);return t>0||n>0?["vaccinations-overdue"]:o>0?["vaccinations-current"]:["vaccinations-overdue"]}catch(t){return console.warn("Error processing vaccination status:",t),["vaccinations-overdue"]}})(e),n=[...Array.isArray(e.petIcons)?e.petIcons:[],...t],o=n.filter((e,t)=>n.indexOf(e)===t);return(0,T.A)((0,T.A)({},e),{},{petIcons:o})},ee=()=>{const[e,t]=(0,o.useState)({inCount:null,outCount:null,overnightCount:null}),[n,s]=(0,o.useState)([]),[i,a]=(0,o.useState)([]),[r,l]=(0,o.useState)(!0),[c,d]=(0,o.useState)(null),[u,h]=(0,o.useState)("in"),[v,m]=(0,o.useState)(new Date),g=(0,o.useCallback)(e=>{const t=new Date(e),n=(()=>{try{const e=localStorage.getItem("tenant_timezone");if(e&&e.trim())return e.trim()}catch(e){}return"America/Denver"})(),o=new Date(t.toLocaleString("en-US",{timeZone:n}));return"".concat(o.getFullYear(),"-").concat(String(o.getMonth()+1).padStart(2,"0"),"-").concat(String(o.getDate()).padStart(2,"0"))},[]),p=(0,o.useCallback)((e,t)=>{const o=t||n,s="".concat(v.getFullYear(),"-").concat(String(v.getMonth()+1).padStart(2,"0"),"-").concat(String(v.getDate()).padStart(2,"0"));let i=o;"in"===e?i=o.filter(e=>g(e.startDate)===s):"out"===e?i=o.filter(e=>g(e.endDate)===s):"all"===e&&(i=o.filter(e=>{const t=g(e.startDate),n=g(e.endDate);return t===s||n===s})),a(i),h(e)},[n,v,g]),f=(0,o.useCallback)(async()=>{l(!0),d(null);try{var e,n;const o="".concat(v.getFullYear(),"-").concat(String(v.getMonth()+1).padStart(2,"0"),"-").concat(String(v.getDate()).padStart(2,"0"));console.log("[Dashboard] Loading data for date:",o);const i="PENDING,CONFIRMED,CHECKED_IN";console.log("[Dashboard] Fetching reservations...");const r=await H.u.getAllReservations(1,250,"startDate","asc",i);console.log("[Dashboard] Reservations response:",r);let l=[];const c=r;null!==c&&void 0!==c&&c.data&&Array.isArray(c.data)?l=c.data:null!==c&&void 0!==c&&null!==(e=c.data)&&void 0!==e&&e.data&&Array.isArray(c.data.data)?l=c.data.data:null!==c&&void 0!==c&&null!==(n=c.data)&&void 0!==n&&n.reservations&&Array.isArray(c.data.reservations)&&(l=c.data.reservations),console.log("[Dashboard] Extracted reservations:",l.length,"reservations");const d=(e=>Array.isArray(e)?e.map(e=>(0,T.A)((0,T.A)({},e),{},{pet:e.pet?X(e.pet):e.pet})):e)(l);console.log("[Dashboard] Enhanced reservations with vaccination icons");const u=d.filter(e=>g(e.startDate)===o).length,h=d.filter(e=>g(e.endDate)===o).length,m=d.filter(e=>{const t=g(e.startDate),n=g(e.endDate);return t<o&&n>=o}).length;console.log("[Dashboard] Calculated metrics:",{checkIns:u,checkOuts:h,overnight:m,totalReservations:d.length}),t({inCount:u,outCount:h,overnightCount:m}),s(d);const p=d.filter(e=>g(e.startDate)===o);a(p)}catch(o){$.error("Failed to load dashboard data",{error:o.message}),d("Failed to load dashboard data. Please try again.")}finally{l(!1)}},[v,g]);return(0,o.useEffect)(()=>{f()},[v]),(0,o.useEffect)(()=>{const e=()=>{$.debug("Window focused, refreshing dashboard"),f()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[]),(0,T.A)((0,T.A)({},e),{},{allReservations:n,filteredReservations:i,loading:r,error:c,appointmentFilter:u,selectedDate:v,setSelectedDate:m,filterReservations:p,refreshData:f})};var te=n(43466);var ne=n(68734),oe=n(19890);const se=()=>{(e=>{const{setPageContent:t}=(0,te.L)();(0,o.useEffect)(()=>(t(e),()=>{t(void 0)}),[e,t])})(oe.g);const{isMobile:e}=(0,B.Qs)(),{inCount:t,outCount:n,overnightCount:h,filteredReservations:v,loading:m,error:g,appointmentFilter:p,selectedDate:x,setSelectedDate:A,filterReservations:D}=ee(),[y,j]=(0,o.useState)([]),[S,b]=(0,o.useState)(!1);(0,o.useEffect)(()=>{w()},[]);const w=async()=>{const e=await ne.Ay.getActiveAnnouncements();j(e),e.length>0&&b(!0)};return(0,f.jsxs)(_,{children:[(0,f.jsx)(L.A,{open:S,announcements:y,onClose:()=>b(!1),onDismiss:async e=>{try{await ne.Ay.dismissAnnouncement(e),j(t=>t.filter(t=>t.id!==e)),console.log("Announcement dismissed successfully")}catch(g){console.error("Failed to dismiss announcement:",g),alert("Unable to dismiss announcement. Please try again later.")}}}),(0,f.jsxs)(s.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},mb:2,gap:{xs:2,sm:0}},children:[(0,f.jsx)(i.A,{variant:e?"h6":"h5",component:"h1",children:"Dashboard"}),(0,f.jsxs)(s.A,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap",justifyContent:{xs:"flex-start",sm:"flex-end"}},children:[(0,f.jsx)(a.A,{size:(0,B.Qz)(e),onClick:()=>{const e=new Date(x);e.setDate(e.getDate()-1),A(e)},sx:{border:"1px solid",borderColor:"divider",borderRadius:1,flexShrink:0},title:"Previous day",children:(0,f.jsx)(c.A,{})}),(0,f.jsx)(r.A,{type:"date",size:e?"small":"medium",value:(e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(o)})(x),onChange:e=>{const t=new Date(e.target.value+"T00:00:00");A(t)},InputLabelProps:{shrink:!0},sx:{width:{xs:140,sm:180},minWidth:"fit-content",flexShrink:1}}),(0,f.jsx)(a.A,{size:(0,B.Qz)(e),onClick:()=>{const e=new Date(x);e.setDate(e.getDate()+1),A(e)},sx:{border:"1px solid",borderColor:"divider",borderRadius:1,flexShrink:0},title:"Next day",children:(0,f.jsx)(d.A,{})}),(0,f.jsx)(l.A,{variant:"outlined",size:(0,B.Qz)(e),startIcon:e?void 0:(0,f.jsx)(u.A,{}),onClick:()=>{A(new Date)},sx:{whiteSpace:"nowrap",flexShrink:0,display:{xs:"none",sm:"inline-flex"}},children:e?(0,f.jsx)(u.A,{}):"Today"})]})]}),(0,f.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:{xs:2,md:3}},children:[(0,f.jsx)(C,{inCount:t,outCount:n,overnightCount:h,appointmentFilter:p,onFilterChange:D}),(0,f.jsx)(U,{reservations:v,loading:m,error:g,filter:p,onFilterChange:D})]})]})}}}]);