"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[2685],{92685:(e,t,i)=>{i.d(t,{A:()=>ce});var s=i(89379),n=i(9950),r=i(82053),a=i(2235),l=i(78317),o=i(65429),c=i(77922),d=i(8145),u=i(46639),m=i(2046),h=i(25979),v=i(19647),p=i(70006),A=i(23266),g=i(10226),x=i(96583),f=i(40033),y=i(28170),j=i(6493),b=i(79739),I=i(19223),S=i(57988),D=i(95722),C=i(22580),w=i(81831),N=i(396),k=i(60899),T=i(89007),E=i(35286),O=i(41976),P=i(92383),R=i(37027),z=i(69019),q=i(84142),U=i(1320),G=i(15769),M=i(69780),_=i(9213),F=i(21671),W=i(34075),B=i(25333),H=i(25277),L=i(74745),V=i(59943),K=i(64085),Q=i(53256),Y=i(2507),Z=i(2599),$=i(20760),J=i(28429),X=i(2831),ee=i(69179),te=i(87687),ie=i(44414);const se=e=>{let{open:t,onClose:i,reservationId:s,serviceId:c,onAddOnsAdded:d,redirectToCheckout:m=!1}=e;const[h,v]=(0,n.useState)([]),[p,A]=(0,n.useState)([]),[j,I]=(0,n.useState)([]),[S,D]=(0,n.useState)(!1),[C,w]=(0,n.useState)(!1),[N,k]=(0,n.useState)(null),[T,E]=(0,n.useState)(null),[O,P]=(0,n.useState)(!1),[R,se]=(0,n.useState)(0),ne=(0,J.Zp)(),{addItem:re}=(0,X.U)(),ae=j.reduce((e,t)=>e+t.price*t.quantity,0),le=(0,n.useCallback)(async()=>{if(c&&t)try{D(!0),k(null);const e=await te.A.getAllAddOns(c);if(0===e.length){const e=await te.A.getAllAddOns();v(e)}else v(e)}catch(e){console.error("Error loading add-ons:",e),k("Failed to load add-on services.")}finally{D(!1)}},[c,t]),oe=(0,n.useCallback)(async()=>{if(t)try{w(!0);const e=window.location.origin,t=await fetch("".concat(e,"/api/products?isActive=true&isService=false"),{headers:{"x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"}});if(!t.ok)throw new Error("Failed to load products");const i=await t.json();A(i.data||[])}catch(e){console.error("Error loading products:",e)}finally{w(!1)}},[t]);(0,n.useEffect)(()=>{t&&(c&&le(),oe(),I([]),k(null),E(null))},[t,c,le,oe]);const ce=(e,t)=>{if(t<1)return;const i=j[e];if("product"===i.type){const e=p.find(e=>e.id===i.productId);if(e&&t>e.currentStock)return k("Only ".concat(e.currentStock," units available in stock")),void setTimeout(()=>k(null),3e3)}const s=[...j];s[e].quantity=t,I(s)},de=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e),ue=()=>{O||i()};return(0,ie.jsxs)(x.A,{open:t,onClose:ue,maxWidth:"md",fullWidth:!0,disableRestoreFocus:!0,children:[(0,ie.jsx)(f.A,{children:"Add Services & Products to Your Reservation"}),(0,ie.jsxs)(y.A,{dividers:!0,children:[N&&(0,ie.jsx)(o.A,{severity:"error",sx:{mb:2},children:N}),T&&(0,ie.jsx)(o.A,{severity:"success",sx:{mb:2},children:T}),(0,ie.jsxs)(z.A,{value:R,onChange:(e,t)=>se(t),sx:{mb:2},children:[(0,ie.jsx)(q.A,{icon:(0,ie.jsx)(V.A,{}),label:"Service Add-Ons"}),(0,ie.jsx)(q.A,{icon:(0,ie.jsx)(K.A,{}),label:"Retail Products"})]}),0===R&&(0,ie.jsxs)(l.A,{children:[(0,ie.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Add-On Services"}),S?(0,ie.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,ie.jsx)(u.A,{})}):0===h.length?(0,ie.jsx)(o.A,{severity:"info",children:"No add-on services available for this reservation."}):(0,ie.jsx)(U.A,{component:a.A,variant:"outlined",children:(0,ie.jsxs)(G.A,{size:"small",children:[(0,ie.jsx)(M.A,{children:(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:"Service"}),(0,ie.jsx)(F.A,{children:"Description"}),(0,ie.jsx)(F.A,{align:"right",children:"Price"}),(0,ie.jsx)(F.A,{align:"center",children:"Action"})]})}),(0,ie.jsx)(W.A,{children:h.map(e=>(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:e.name}),(0,ie.jsx)(F.A,{children:e.description}),(0,ie.jsx)(F.A,{align:"right",children:de(e.price)}),(0,ie.jsx)(F.A,{align:"center",children:(0,ie.jsx)(B.A,{size:"small",color:"primary",onClick:()=>(e=>{const t=j.findIndex(t=>"service"===t.type&&t.addOnId===e.id);if(t>=0){const e=[...j];e[t].quantity+=1,I(e)}else I([...j,{id:e.id,name:e.name,description:e.description,price:e.price,quantity:1,type:"service",addOnId:e.id,serviceId:e.serviceId}])})(e),children:(0,ie.jsx)(Q.A,{})})})]},e.id))})]})})]}),1===R&&(0,ie.jsxs)(l.A,{children:[(0,ie.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Available Retail Products"}),C?(0,ie.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,ie.jsx)(u.A,{})}):0===p.length?(0,ie.jsx)(o.A,{severity:"info",children:"No retail products available."}):(0,ie.jsx)(U.A,{component:a.A,variant:"outlined",children:(0,ie.jsxs)(G.A,{size:"small",children:[(0,ie.jsx)(M.A,{children:(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:"Product"}),(0,ie.jsx)(F.A,{children:"Category"}),(0,ie.jsx)(F.A,{align:"right",children:"Price"}),(0,ie.jsx)(F.A,{align:"center",children:"Stock"}),(0,ie.jsx)(F.A,{align:"center",children:"Action"})]})}),(0,ie.jsx)(W.A,{children:p.map(e=>{var t;return(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:(0,ie.jsxs)(l.A,{children:[(0,ie.jsx)(r.A,{variant:"body2",children:e.name}),e.description&&(0,ie.jsx)(r.A,{variant:"caption",color:"text.secondary",children:e.description})]})}),(0,ie.jsx)(F.A,{children:(null===(t=e.category)||void 0===t?void 0:t.name)||"-"}),(0,ie.jsx)(F.A,{align:"right",children:de(Number(e.price))}),(0,ie.jsx)(F.A,{align:"center",children:(0,ie.jsx)(H.A,{icon:(0,ie.jsx)(Y.A,{}),label:e.currentStock,size:"small",color:e.currentStock>10?"success":e.currentStock>0?"warning":"error"})}),(0,ie.jsx)(F.A,{align:"center",children:(0,ie.jsx)(B.A,{size:"small",color:"primary",onClick:()=>(e=>{const t=j.findIndex(t=>"product"===t.type&&t.productId===e.id);if((t>=0?j[t].quantity:0)>=e.currentStock)return k("Only ".concat(e.currentStock," units available in stock")),void setTimeout(()=>k(null),3e3);if(t>=0){const e=[...j];e[t].quantity+=1,I(e)}else I([...j,{id:e.id,name:e.name,description:e.description,price:Number(e.price),quantity:1,type:"product",productId:e.id}])})(e),disabled:0===e.currentStock,children:(0,ie.jsx)(Q.A,{})})})]},e.id)})})]})})]}),(0,ie.jsx)(L.A,{sx:{my:2}}),(0,ie.jsxs)(l.A,{children:[(0,ie.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Selected Items"}),0===j.length?(0,ie.jsx)(o.A,{severity:"info",children:"No items selected yet."}):(0,ie.jsx)(U.A,{component:a.A,variant:"outlined",children:(0,ie.jsxs)(G.A,{size:"small",children:[(0,ie.jsx)(M.A,{children:(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:"Item"}),(0,ie.jsx)(F.A,{children:"Type"}),(0,ie.jsx)(F.A,{align:"right",children:"Price"}),(0,ie.jsx)(F.A,{align:"center",children:"Quantity"}),(0,ie.jsx)(F.A,{align:"right",children:"Total"}),(0,ie.jsx)(F.A,{align:"center",children:"Actions"})]})}),(0,ie.jsxs)(W.A,{children:[j.map((e,t)=>(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{children:e.name}),(0,ie.jsx)(F.A,{children:(0,ie.jsx)(H.A,{label:"service"===e.type?"Service":"Product",size:"small",color:"service"===e.type?"primary":"secondary"})}),(0,ie.jsx)(F.A,{align:"right",children:de(e.price)}),(0,ie.jsx)(F.A,{align:"center",children:(0,ie.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,ie.jsx)(B.A,{size:"small",onClick:()=>ce(t,e.quantity-1),children:(0,ie.jsx)(Z.A,{fontSize:"small"})}),(0,ie.jsx)(r.A,{sx:{mx:1},children:e.quantity}),(0,ie.jsx)(B.A,{size:"small",onClick:()=>ce(t,e.quantity+1),children:(0,ie.jsx)(Q.A,{fontSize:"small"})})]})}),(0,ie.jsx)(F.A,{align:"right",children:de(e.price*e.quantity)}),(0,ie.jsx)(F.A,{align:"center",children:(0,ie.jsx)(B.A,{size:"small",color:"error",onClick:()=>(e=>{I(j.filter((t,i)=>i!==e))})(t),children:(0,ie.jsx)($.A,{})})})]},t)),(0,ie.jsxs)(_.A,{children:[(0,ie.jsx)(F.A,{colSpan:4,align:"right",children:(0,ie.jsx)("strong",{children:"Subtotal"})}),(0,ie.jsx)(F.A,{align:"right",children:(0,ie.jsx)("strong",{children:de(ae)})}),(0,ie.jsx)(F.A,{})]})]})]})})]})]}),(0,ie.jsxs)(b.A,{sx:{px:3,pb:2},children:[(0,ie.jsx)(g.A,{onClick:ue,disabled:O,children:"Cancel"}),0===j.length?(0,ie.jsx)(g.A,{variant:"outlined",color:"secondary",onClick:async()=>{try{var e,t,n,r,a,l;const o=await ee.u.getReservationById(s),c={id:"reservation-".concat(s),price:(null===(e=o.service)||void 0===e?void 0:e.price)||0,quantity:1,serviceName:(null===(t=o.service)||void 0===t?void 0:t.name)||"Unknown Service",serviceId:o.serviceId,customerId:o.customerId,customerName:"".concat((null===(n=o.customer)||void 0===n?void 0:n.firstName)||""," ").concat((null===(r=o.customer)||void 0===r?void 0:r.lastName)||"").trim(),petId:o.petId,petName:(null===(a=o.pet)||void 0===a?void 0:a.name)||"Unknown Pet",startDate:new Date(o.startDate),endDate:new Date(o.endDate),suiteType:"STANDARD_SUITE",resourceId:(null===(l=o.resource)||void 0===l?void 0:l.id)||void 0,notes:o.notes||"",addOns:[],products:[]};re(c),ne("/checkout"),i()}catch(N){console.error("Error preparing checkout:",N),i()}},disabled:O,children:"Continue to Checkout"}):(0,ie.jsx)(g.A,{variant:"contained",color:"primary",onClick:async()=>{try{var e,t,n,r,a,l;P(!0),k(null);const o=j.filter(e=>"service"===e.type),c=j.filter(e=>"product"===e.type);if(o.length>0){const e=o.map(e=>({serviceId:e.addOnId,quantity:e.quantity}));await ee.u.addAddOnsToReservation(s,e),E("Services added successfully!")}const u=await ee.u.getReservationById(s),m={id:"reservation-".concat(s),price:(null===(e=u.service)||void 0===e?void 0:e.price)||0,quantity:1,serviceName:(null===(t=u.service)||void 0===t?void 0:t.name)||"Unknown Service",serviceId:u.serviceId,customerId:u.customerId,customerName:"".concat((null===(n=u.customer)||void 0===n?void 0:n.firstName)||""," ").concat((null===(r=u.customer)||void 0===r?void 0:r.lastName)||"").trim(),petId:u.petId,petName:(null===(a=u.pet)||void 0===a?void 0:a.name)||"Unknown Pet",startDate:new Date(u.startDate),endDate:new Date(u.endDate),suiteType:"STANDARD_SUITE",resourceId:(null===(l=u.resource)||void 0===l?void 0:l.id)||void 0,notes:u.notes||"",addOns:o.map(e=>({id:e.addOnId,name:e.name,price:e.price,quantity:e.quantity})),products:c.map(e=>({id:e.productId,name:e.name,price:e.price,quantity:e.quantity}))};re(m),d(!0),ne("/checkout"),i()}catch(u){var o,c;console.error("Error saving items:",u),k((null===(o=u.response)||void 0===o||null===(c=o.data)||void 0===c?void 0:c.message)||"Failed to add items. Please try again."),d(!1)}finally{P(!1)}},disabled:O,children:O?(0,ie.jsx)(u.A,{size:24}):"Add Items & Checkout"})]})]})};var ne=i(43974),re=i(94856),ae=i(77702),le=i(8959);const oe=e=>{let{selectedGroomerId:t,onGroomerChange:i,appointmentDate:s,appointmentStartTime:a,appointmentEndTime:c,disabled:d=!1,required:m=!1}=e;const[g,x]=(0,n.useState)([]),[f,y]=(0,n.useState)(!0),[j,b]=(0,n.useState)(""),[I,S]=(0,n.useState)({}),[D,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{y(!0),b("");const e=(await le.Ay.getAllStaff()).filter(e=>e.isActive&&e.specialties&&e.specialties.includes("GROOMING"));e.sort((e,t)=>{const i=e.lastName.localeCompare(t.lastName);return 0!==i?i:e.firstName.localeCompare(t.firstName)}),x(e)}catch(e){console.error("Error loading groomers:",e),b("Failed to load groomers")}finally{y(!1)}})()},[]),(0,n.useEffect)(()=>{if(!s||0===g.length)return;(async()=>{C(!0);const e={};for(const t of g){const i=await w(t.id,s,a,c);e[t.id]=i}S(e),C(!1)})()},[s,a,c,g]);const w=async(e,t,i,s)=>{try{(0,ne.A)(t,"yyyy-MM-dd");const n=t.getDay(),r=(await le.Ay.getStaffTimeOff(e)).filter(e=>"APPROVED"===e.status);for(const e of r){const i=(0,re.A)(e.startDate),s=(0,re.A)(e.endDate);if((0,ae.A)(t,{start:i,end:s}))return{available:!1,reason:"Off (".concat(e.type,")"),status:"off"}}const a=(await le.Ay.getStaffAvailability(e)).find(e=>e.dayOfWeek===n&&e.isAvailable&&e.isRecurring);if(!a)return{available:!1,reason:"Not scheduled",status:"off"};if(i&&s){const e=(0,ne.A)(i,"HH:mm"),t=(0,ne.A)(s,"HH:mm");if(e<a.startTime||t>a.endTime)return{available:!1,reason:"Works ".concat(a.startTime,"-").concat(a.endTime),status:"off"}}return{available:!0,reason:"Available ".concat(a.startTime,"-").concat(a.endTime),status:"available"}}catch(n){return console.error("Error checking availability for groomer ".concat(e,":"),n),{available:!1,reason:"Unable to check",status:"unknown"}}},N=e=>{switch(e.status){case"available":return"success";case"busy":case"off":return"error";case"unknown":return"warning";default:return"default"}};return f?(0,ie.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ie.jsx)(u.A,{size:20}),(0,ie.jsx)(r.A,{variant:"body2",children:"Loading groomers..."})]}):j?(0,ie.jsx)(o.A,{severity:"error",sx:{mb:2},children:j}):0===g.length?(0,ie.jsx)(o.A,{severity:"warning",sx:{mb:2},children:"No groomers available. Please add staff with GROOMING specialty."}):(0,ie.jsxs)(h.A,{fullWidth:!0,size:"small",sx:{mb:2},required:m,children:[(0,ie.jsx)(v.A,{id:"groomer-select-label",children:"Assign Groomer"}),(0,ie.jsxs)(p.A,{labelId:"groomer-select-label",id:"groomer-select",value:t,label:"Assign Groomer",onChange:e=>i(e.target.value),disabled:d,MenuProps:{PaperProps:{style:{maxWidth:"400px"}},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},renderValue:e=>{if(!e)return(0,ie.jsx)("em",{children:"Select a groomer"});const t=g.find(t=>t.id===e);if(!t)return e;const i=I[e];return(0,ie.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,ie.jsxs)("span",{children:[t.firstName," ",t.lastName]}),i&&(0,ie.jsx)(H.A,{size:"small",label:i.reason||i.status,color:N(i),sx:{height:20,fontSize:"0.7rem"}})]})},children:[(0,ie.jsx)(A.A,{value:"",children:(0,ie.jsx)("em",{children:"Auto-assign (any available groomer)"})}),g.map(e=>{const t=I[e.id],i=!1!==(null===t||void 0===t?void 0:t.available);return(0,ie.jsx)(A.A,{value:e.id,disabled:!i&&null!==s,children:(0,ie.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[(0,ie.jsxs)("span",{children:[e.firstName," ",e.lastName,e.specialties&&e.specialties.length>1&&(0,ie.jsxs)(r.A,{component:"span",variant:"caption",sx:{ml:1,color:"text.secondary"},children:["(",e.specialties.filter(e=>"GROOMING"!==e).join(", "),")"]})]}),D?(0,ie.jsx)(u.A,{size:16}):t?(0,ie.jsx)(H.A,{size:"small",label:t.reason||t.status,color:N(t),sx:{ml:1}}):null]})},e.id)})]}),!s&&(0,ie.jsx)(r.A,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:"Select an appointment date to check groomer availability"})]})},ce=e=>{let{onSubmit:t,initialData:i,defaultDates:z,showAddOns:q=!1,serviceCategories:U,onClose:G}=e;const{isMobile:M,isTablet:_}=(0,R.Qs)(),[F,W]=(0,n.useState)([]),[B,H]=(0,n.useState)([]),[L,V]=(0,n.useState)([]),[K,Q]=(0,n.useState)(""),[Y,Z]=(0,n.useState)(null),[$,ee]=(0,n.useState)(""),[te,ne]=(0,n.useState)([]),[re,ae]=(0,n.useState)([]),[le,ce]=(0,n.useState)(!1),[de,ue]=(0,n.useState)(""),[me,he]=(0,n.useState)([]),[ve,pe]=(0,n.useState)({}),[Ae,ge]=(0,n.useState)(new Set),[xe,fe]=(0,n.useState)(""),[ye,je]=(0,n.useState)(""),[be,Ie]=(0,n.useState)(""),[Se,De]=(0,n.useState)("CONFIRMED"),[Ce,we]=(0,n.useState)((null===z||void 0===z?void 0:z.start)||null),[Ne,ke]=(0,n.useState)((null===z||void 0===z?void 0:z.end)||null),[Te,Ee]=(0,n.useState)(null),[Oe,Pe]=(0,n.useState)(""),[Re,ze]=(0,n.useState)(!1),{addItem:qe}=(0,X.U)(),Ue=(0,J.Zp)(),[Ge,Me]=(0,n.useState)([]),[_e,Fe]=(0,n.useState)(!1),[We,Be]=(0,n.useState)(""),[He,Le]=(0,n.useState)(""),Ve=n.useRef(!1),Ke=n.useRef({customer:!1,pet:!1,service:!1,suiteType:!1,suiteId:!1}),[Qe,Ye]=(0,n.useState)(!1),[Ze,$e]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(!Ve.current){console.log("ReservationForm initialData:",i);try{ze(!0);const t={limit:100};U&&1===U.length&&(t.category=U[0]);const[s,n]=await Promise.all([T.m.getAllCustomers(1,100),O.V.getAllServices(t)]);W(s.data||[]),Ke.current.customer=(s.data||[]).length>0;let r=n.data||[];if(U&&U.length>1&&(r=r.filter(e=>U.includes(e.serviceCategory))),V(r),Ke.current.service=r.length>0,Ke.current.suiteType=!0,i){i.startDate&&we(new Date(i.startDate)),i.endDate&&ke(new Date(i.endDate)),i.status&&De(i.status);const t=s.data||[];if(i.customerId){let s=t.some(e=>e.id===i.customerId);if(!s&&i.customer){const e=i.customer;t.push(e),W(t),s=!0}if(s){Q(i.customerId);const s=t.find(e=>e.id===i.customerId);s&&Z(s),Ke.current.customer=!0;try{let e=(await E.B.getPetsByCustomer(i.customerId)).data||[];console.log("Loaded pets:",e.length,"Looking for petId:",i.petId);let t=i.petId&&e.some(e=>e.id===i.petId);!t&&i.pet&&(console.log("Adding pet from initialData:",i.pet),e.push(i.pet),t=!0),H(e),Ke.current.pet=e.length>0,t&&i.petId?(console.log("Setting selected pet:",i.petId),ue(i.petId),he([i.petId])):t||console.warn("Pet not found in list and no pet object in initialData:",i.petId)}catch(e){console.error("Error loading pets:",e),H([])}}else console.warn("Customer not found:",i.customerId)}const r=n.data||[];if(console.log("Services loaded:",r.length,"Looking for serviceId:",i.serviceId),i.serviceId){let e=r.some(e=>e.id===i.serviceId);!e&&i.service&&(console.log("Adding service from initialData:",i.service),r.push(i.service),V(r),e=!0),e?(console.log("Setting selected service:",i.serviceId),fe(i.serviceId)):console.warn("Service not found in list and no service object in initialData:",i.serviceId)}if(i.staffAssignedId&&je(i.staffAssignedId),Ve.current=!0,i.resourceId||i.kennelId){const t=i.resourceId||i.kennelId;Le(t);try{const e=await P.c.getResource(t);if(e.data){const t=e.data.type;t?Ie(t):i.suiteType&&Ie(i.suiteType)}}catch(e){console.error("Error fetching resource details:",e),i.suiteType&&Ie(i.suiteType)}}else i.suiteType&&Ie(i.suiteType)}}catch(e){Pe("Failed to load initial data"),console.error("Error loading initial data:",e)}finally{ze(!1)}}})()},[i,U]);const Je=async(e,t)=>{if(Q(e),Z(t||null),ue(""),he([]),pe({}),e)try{const t=await E.B.getPetsByCustomer(e);let i=[];if(Array.isArray(t.data))i=t.data;else if(t.data&&"object"===typeof t.data){const e=t.data;"data"in e&&Array.isArray(e.data)&&(i=e.data)}H(i),Ke.current.pet=i.length>0,1===i.length&&ue(i[0].id)}catch(i){console.error("Error loading pets:",i),H([])}else H([])};(0,n.useEffect)(()=>{Ve.current&&i&&(async()=>{if(K&&null!==i&&void 0!==i&&i.petId)try{const e=await E.B.getPetsByCustomer(K);let t=[];if(Array.isArray(e.data))t=e.data;else if(e.data&&"object"===typeof e.data){const i=e.data;"data"in i&&Array.isArray(i.data)&&(t=i.data)}t.length>0&&0===B.length&&(H(t),Ke.current.pet=!0),null!==i&&void 0!==i&&i.petId&&t.some(e=>e.id===i.petId)&&ue(i.petId)}catch(e){console.error("Error loading initial pets:",e)}})()},[i,K,B]),(0,n.useEffect)(()=>{if(!xe)return;const e=L.find(e=>e.id===xe);e&&("DAYCARE"===e.serviceCategory||"BOARDING"===e.serviceCategory)||(Ie(""),Le(""),Me([]))},[xe,L]);const[Xe,et]=(0,n.useState)(!1),[tt,it]=(0,n.useState)(!1),[st,nt]=(0,n.useState)(""),[rt,at]=(0,n.useState)("");(0,n.useEffect)(()=>{},[tt,st,rt]),(0,n.useEffect)(()=>{(async()=>{if(be){et(!1);try{Fe(!0);let s=[];if(me.length>1){const e=["STANDARD_SUITE","STANDARD_PLUS_SUITE","VIP_SUITE"];(await Promise.all(e.map(e=>P.c.getAllResources(1,500,"name","asc",e)))).forEach(e=>{"success"===(null===e||void 0===e?void 0:e.status)&&null!==e&&void 0!==e&&e.data&&(s=[...s,...e.data])})}else{const e=await P.c.getAllResources(1,500,"name","asc",be);"success"===(null===e||void 0===e?void 0:e.status)&&null!==e&&void 0!==e&&e.data&&(s=e.data)}const n=(null===i||void 0===i?void 0:i.resourceId)||(null===i||void 0===i?void 0:i.kennelId);if(n){if(!s.some(e=>e.id===n))try{const t=await P.c.getResource(n);if("success"===(null===t||void 0===t?void 0:t.status)&&null!==t&&void 0!==t&&t.data){var e;const i=t.data;(i.type||(null===(e=i.attributes)||void 0===e?void 0:e.suiteType))===be&&s.push(i)}}catch(t){console.error("Error fetching specific resource:",t)}}Me(s),Ke.current.suiteId=s.length>0;const r=(null===i||void 0===i?void 0:i.resourceId)||(null===i||void 0===i?void 0:i.kennelId);if(r){s.some(e=>e.id===r)?(Le(r),setTimeout(()=>{et(!0)},100)):(Le(""),et(!0))}else Le(""),et(!0)}catch(Oe){console.error("Error loading available suites:",Oe),Me([]),Be("Error loading available suites"),Ke.current.suiteId=!1,et(!0)}finally{Fe(!1)}}})()},[be,i,me.length]),(0,n.useEffect)(()=>{(async()=>{if(Ce&&Ne&&0!==Ge.length)try{var e;const t=Ge.map(e=>e.id),s=e=>{const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(i,"-").concat(s)},n=await P.c.batchCheckResourceAvailability(t,s(Ce),s(Ne));if("success"===(null===n||void 0===n?void 0:n.status)&&null!==n&&void 0!==n&&null!==(e=n.data)&&void 0!==e&&e.resources){const e=new Set;n.data.resources.forEach(t=>{if(!t.isAvailable){var s;(null===i||void 0===i?void 0:i.id)&&(null===(s=t.conflictingReservations)||void 0===s?void 0:s.some(e=>e.id===i.id))||e.add(t.resourceId)}}),ge(e)}}catch(Oe){console.error("Error checking suite availability:",Oe),ge(new Set)}else ge(new Set)})()},[Ce,Ne,Ge,null===i||void 0===i?void 0:i.id]);if(Re)return(0,ie.jsx)(r.A,{children:"Loading..."});const lt=()=>{i||(ue(""),he([]),fe(""),Ie(""),Le(""),we((null===z||void 0===z?void 0:z.start)||null),ke((null===z||void 0===z?void 0:z.end)||null)),Pe("")};return(0,ie.jsxs)(w.$,{dateAdapter:N.h,children:[(0,ie.jsx)(a.A,{elevation:3,sx:{p:2},children:(0,ie.jsxs)(l.A,{component:"form",onSubmit:async e=>{if(e.preventDefault(),Pe(""),ze(!0),!K||0===me.length&&!de||!xe||!Ce||!Ne)return Pe("Please fill in all required fields"),void ze(!1);const s=L.find(e=>e.id===xe);if(s&&("DAYCARE"===s.serviceCategory||"BOARDING"===s.serviceCategory)){const e=me.length>0?me:[de];if(e.length>1){const t=e.filter(e=>void 0===ve[e]);if(t.length>0){const e=t.map(e=>{const t=B.find(t=>t.id===e);return(null===t||void 0===t?void 0:t.name)||"Unknown"}).join(", ");return Pe('Please assign kennels for all pets or select "Auto-assign": '.concat(e)),void ze(!1)}}}if(s&&"GROOMING"===s.serviceCategory&&!ye)return Pe("Please select a groomer for this grooming service"),void ze(!1);xe&&at(xe);try{const e=me.length>0?me:[de],s=e.length>1,n=L.find(e=>e.id===xe),r=n&&("DAYCARE"===n.serviceCategory||"BOARDING"===n.serviceCategory);let a=be;r&&!be&&(a="STANDARD_SUITE");const l=[];for(let c=0;c<e.length;c++){const o=e[c],d=s?ve[o]:He,u={customerId:K,petId:o,serviceId:xe,startDate:Ce?Ce.toISOString():null,endDate:Ne?Ne.toISOString():null,status:Se,notes:s?"Multi-pet reservation (".concat(c+1," of ").concat(e.length,")"):""};ye&&"GROOMING"===(null===n||void 0===n?void 0:n.serviceCategory)&&(u.staffAssignedId=ye),r&&(u.suiteType=a,d&&""!==d.trim()&&(u.resourceId=d),null!==i&&void 0!==i&&i.kennelId&&i.kennelId);const m=await t(u);m&&l.push(m)}const o=l[0];if(void 0===o)return void ze(!1);if(q&&null!==o&&void 0!==o&&o.reservationId){if(nt(o.reservationId),xe)return at(xe),void it(!0);console.warn("No selected service ID for add-ons dialog"),lt()}else lt()}catch(Oe){console.error("Error in form submission:",Oe),Pe(Oe.message||"An error occurred. Please try again.")}finally{ze(!1)}},sx:{display:"flex",flexDirection:"column",gap:1},children:[Oe&&(0,ie.jsx)(o.A,{severity:"error",sx:{mb:1},children:Oe}),i&&i.orderNumber&&(0,ie.jsxs)(l.A,{sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[(0,ie.jsx)(r.A,{variant:"subtitle1",children:"Order Number:"}),(0,ie.jsx)(r.A,{variant:"body1",sx:{fontWeight:"bold",color:"primary.main"},children:i.orderNumber})]}),(0,ie.jsx)(c.A,{id:"customer-search",filterOptions:e=>e,options:$.length>=2?[...te.map(e=>({type:"customer",data:e})),...re.map(e=>({type:"pet",data:e}))]:F.map(e=>({type:"customer",data:e})),getOptionLabel:e=>{if(!e||!e.data)return"";if("customer"===e.type){const t=e.data;return"".concat(t.firstName," ").concat(t.lastName)}{const t=e.data,i=t.owner;return"".concat(t.name," (").concat(i?"".concat(i.firstName," ").concat(i.lastName):"Unknown Owner",") - ").concat(t.breed||t.type)}},isOptionEqualToValue:(e,t)=>!(!e||!t)&&(e.type===t.type&&e.data.id===t.data.id),groupBy:e=>"customer"===e.type?"\ud83d\udc64 Customers":"\ud83d\udc15 Pets",loading:le,onInputChange:(e,t)=>{(async e=>{if(ee(e),!e||e.length<2)return ne([]),void ae([]);try{ce(!0);const[t,i]=await Promise.all([T.m.searchCustomers(e),E.B.searchPets(e)]);t&&t.data?ne(t.data||[]):ne([]),i&&i.data?ae(i.data||[]):ae([])}catch(Oe){console.error("Error searching for customers/pets:",Oe),ne([]),ae([])}finally{ce(!1)}})(t)},onChange:(e,t)=>{if(t)if("customer"===t.type){const e=t.data;Je(e.id,e)}else{const e=t.data;if(e.owner){const t={id:e.customerId,firstName:e.owner.firstName,lastName:e.owner.lastName,email:"",isActive:!0};Je(e.customerId,t),ue(e.id),he([e.id])}}else Je("",null)},value:Y?{type:"customer",data:Y}:null,renderInput:e=>(0,ie.jsx)(d.A,(0,s.A)((0,s.A)({},e),{},{label:"Customer or Pet",size:"small",required:!0,placeholder:"Search by customer name, pet name, email, or phone",InputLabelProps:{shrink:!0},InputProps:(0,s.A)((0,s.A)({},e.InputProps),{},{endAdornment:(0,ie.jsxs)(n.Fragment,{children:[le?(0,ie.jsx)(u.A,{color:"primary",size:20}):null,e.InputProps.endAdornment]}),startAdornment:(0,ie.jsx)(m.A,{position:"start",children:(0,ie.jsx)(I.A,{color:"action"})})})})),noOptionsText:"No customers or pets found. Try a different search term.",loadingText:"Searching for customers and pets...",size:"small",sx:{mb:1}}),(0,ie.jsx)(c.A,{multiple:!0,id:"pet-select",options:B,getOptionLabel:e=>"".concat(e.name," (").concat(e.type,")"),value:B.filter(e=>me.includes(e.id)),isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(e,t)=>{const i=t.map(e=>e.id);if(he(i),i.length>0?ue(i[0]):ue(""),i.length>1){const e={};if(He){e[i[0]]=He;const t=Ge.findIndex(e=>e.id===He);for(let s=1;s<i.length;s++){const n=t+s;n<Ge.length?e[i[s]]=Ge[n].id:e[i[s]]=""}}else i.forEach(t=>{e[t]=""});pe(e)}else 0===i.length&&pe({})},renderInput:e=>(0,ie.jsx)(d.A,(0,s.A)((0,s.A)({},e),{},{label:"Pet(s)",size:"small",placeholder:B.length>0?"Select one or more pets":"No pets available",InputLabelProps:{shrink:!0},helperText:"You can select multiple pets for the same reservation",error:0===me.length&&""===de})),size:"small",sx:{mb:1},noOptionsText:"No pets available for this customer"}),(0,ie.jsxs)(h.A,{fullWidth:!0,size:"small",sx:{mb:1},children:[(0,ie.jsx)(v.A,{id:"service-label",shrink:!0,children:"Service"}),(0,ie.jsxs)(p.A,{labelId:"service-label",id:"service-select",value:Ke.current.service&&L.some(e=>e.id===xe)?xe:"",label:"Service",inputProps:{"aria-label":"Select a service","aria-hidden":"false"},onChange:e=>{const t=e.target.value;if(fe(t),t){const e=L.find(e=>e.id===t);if(e&&e.duration&&(Ee(e.duration),Ce)){const t=new Date(Ce.getTime());"BOARDING"===e.serviceCategory?(t.setDate(t.getDate()+1),t.setHours(17,0,0,0)):t.setMinutes(t.getMinutes()+e.duration),ke(t)}}},required:!0,displayEmpty:!0,notched:!0,children:[(0,ie.jsx)(A.A,{value:"",disabled:!0,children:"Select a service"}),L.map(e=>(0,ie.jsx)(A.A,{value:e.id,children:e.name},e.id))]})]}),(()=>{const e=L.find(e=>e.id===xe);return"GROOMING"===(null===e||void 0===e?void 0:e.serviceCategory)?(0,ie.jsx)(oe,{selectedGroomerId:ye,onGroomerChange:je,appointmentDate:Ce,appointmentStartTime:Ce,appointmentEndTime:Ne,disabled:Re}):null})(),(()=>{const e=L.find(e=>e.id===xe),t=e&&("DAYCARE"===e.serviceCategory||"BOARDING"===e.serviceCategory);return t?(t&&!be&&setTimeout(()=>Ie("STANDARD_SUITE"),0),(0,ie.jsxs)(ie.Fragment,{children:[!He&&(0,ie.jsxs)(h.A,{fullWidth:!0,required:!0,size:"small",sx:{mb:1},children:[(0,ie.jsx)(v.A,{id:"kennel-type-label",shrink:!0,children:"Kennel Type"}),(0,ie.jsxs)(p.A,{labelId:"kennel-type-label",id:"kennel-type-select",value:be&&["STANDARD_SUITE","STANDARD_PLUS_SUITE","VIP_SUITE"].includes(be)?be:"",label:"Kennel Type",inputProps:{"aria-label":"Select kennel type","aria-hidden":"false"},onChange:e=>{const t=e.target.value;if(Ie(t),He){const e=Ge.find(e=>e.id===He);e&&e.type!==t&&Le("")}},required:!0,displayEmpty:!0,notched:!0,children:[(0,ie.jsx)(A.A,{value:"",disabled:!0,children:"Select kennel type"}),(0,ie.jsx)(A.A,{value:"VIP_SUITE",children:"VIP Suite"}),(0,ie.jsx)(A.A,{value:"STANDARD_PLUS_SUITE",children:"Standard Plus Suite"}),(0,ie.jsx)(A.A,{value:"STANDARD_SUITE",children:"Standard Suite"})]})]}),t&&be&&me.length>1&&(0,ie.jsxs)(l.A,{sx:{mt:2,mb:2,p:2,border:"1px solid #e0e0e0",borderRadius:1},children:[(0,ie.jsx)(r.A,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Assign Kennels for Each Pet:"}),(0,ie.jsx)(r.A,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"The first pet is pre-assigned to the initially selected kennel. Subsequent pets are suggested to adjacent kennels."}),(0,ie.jsx)(r.A,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"\ud83d\udfe2 Available \u2022 \ud83d\udfe1 Selected for another pet \u2022 \ud83d\udd34 Occupied by existing reservation"}),"                    ",me.map((e,t)=>{const i=B.find(t=>t.id===e),n=0===t;return(0,ie.jsx)(c.A,{size:"small",options:[{id:"",name:"Auto-assign"},...Ge],value:Ge.find(t=>t.id===ve[e])||{id:"",name:"Auto-assign"},isOptionEqualToValue:(e,t)=>e.id===t.id,onChange:(t,i)=>{const n=(null===i||void 0===i?void 0:i.id)||"";pe(t=>(0,s.A)((0,s.A)({},t),{},{[e]:n}))},getOptionLabel:e=>{var t;return e.id?e.name||"Suite #".concat((null===(t=e.attributes)||void 0===t?void 0:t.suiteNumber)||e.id.substring(0,8)):"Auto-assign"},getOptionDisabled:t=>{if(!t.id)return!1;const i=Object.entries(ve).some(i=>{let[s,n]=i;return s!==e&&n===t.id}),s=Ae.has(t.id);return i||s},renderOption:(t,i)=>{var n;if(!i.id)return(0,ie.jsx)("li",(0,s.A)((0,s.A)({},t),{},{children:(0,ie.jsx)("em",{children:"Auto-assign"})}));const r=Object.entries(ve).some(t=>{let[s,n]=t;return s!==e&&n===i.id}),a=Ae.has(i.id),l=i.name||"Suite #".concat((null===(n=i.attributes)||void 0===n?void 0:n.suiteNumber)||i.id.substring(0,8));return(0,ie.jsxs)("li",(0,s.A)((0,s.A)({},t),{},{style:{color:a?"#d32f2f":r?"#ff9800":"#2e7d32",opacity:r||a?.6:1},children:[a&&"\ud83d\udd34 ",r&&!a&&"\ud83d\udfe1 ",!a&&!r&&"\ud83d\udfe2 ",l,a&&" (Occupied)",r&&!a&&" (Selected for another pet)"]}))},disabled:_e,loading:_e,renderInput:e=>(0,ie.jsx)(d.A,(0,s.A)((0,s.A)({},e),{},{label:"Kennel for ".concat((null===i||void 0===i?void 0:i.name)||"Pet ".concat(t+1)).concat(n?" (Initially selected)":""),placeholder:"Type to search...",InputLabelProps:{shrink:!0}})),sx:{mt:1,mb:1}},e)})]}),t&&be&&me.length<=1&&(0,ie.jsxs)(h.A,{fullWidth:!0,required:!0,margin:"normal",children:[(0,ie.jsx)(v.A,{id:"kennel-number-label",children:"Kennel/Suite Number"}),_e?(0,ie.jsx)(p.A,{labelId:"kennel-number-label",id:"kennel-number-select",value:"",label:"Kennel/Suite Number",disabled:!0,children:(0,ie.jsx)(A.A,{disabled:!0,children:"Loading suites..."})}):Xe?(0,ie.jsxs)(p.A,{labelId:"kennel-number-label",id:"kennel-number-select",value:He||"",label:"Kennel/Suite Number",onChange:e=>{const t=e.target.value||"";Le(t)},inputProps:{"aria-label":"Select kennel number","aria-hidden":"false"},renderValue:e=>{if(!e)return"Auto-assign (recommended)";const t=Ge.find(t=>t.id===e);if(t){var i;const e=null===(i=t.attributes)||void 0===i?void 0:i.suiteNumber,s=t.name||"Suite";return e?"#".concat(e," - ").concat(s):s}return"Suite ID: ".concat(e.substring(0,8),"...")},children:[(0,ie.jsx)(A.A,{value:"",children:"Auto-assign (recommended)"}),We?(0,ie.jsx)(A.A,{disabled:!0,children:We}):Ge.length>0?Ge.map(e=>{var t;const i=Ae.has(e.id),s=e.name||"Suite #".concat((null===(t=e.attributes)||void 0===t?void 0:t.suiteNumber)||e.id.substring(0,8));return(0,ie.jsxs)(A.A,{id:"suite-option-".concat(e.id),value:e.id,disabled:i,sx:{color:i?"#d32f2f":"#2e7d32",opacity:i?.6:1},children:[i?"\ud83d\udd34 ":"\ud83d\udfe2 ",s,i&&" (Occupied)"]},e.id)}):(0,ie.jsx)(A.A,{disabled:!0,children:"No suites available"}),He&&!Ge.some(e=>e.id===He)&&(0,ie.jsxs)(A.A,{id:"suite-option-".concat(He),value:He,children:["Suite ID: ",He.substring(0,8),"..."]})]}):(0,ie.jsx)(p.A,{labelId:"kennel-number-label",id:"kennel-number-select",value:"",label:"Kennel/Suite Number",disabled:!0,children:(0,ie.jsx)(A.A,{disabled:!0,children:"Preparing options..."})})]})]})):null})(),(0,ie.jsx)(r.A,{variant:"subtitle2",sx:{mt:1,mb:.5},children:"Start Date & Time"}),(0,ie.jsxs)(k.Ay,{container:!0,spacing:2,children:[(0,ie.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,ie.jsx)(D.l,{label:"Start Date",value:Ce,onChange:e=>{if(e){if(Ce){const t=Ce.getHours(),i=Ce.getMinutes();e.setHours(t,i)}else e.setHours(9,0,0,0);if(we(e),Te){const t=new Date(e.getTime()),i=L.find(e=>e.id===xe);"BOARDING"===(null===i||void 0===i?void 0:i.serviceCategory)?(t.setDate(t.getDate()+1),t.setHours(17,0,0,0)):t.setMinutes(t.getMinutes()+Te),ke(t)}}},slotProps:{textField:{fullWidth:!0,size:"small",sx:{mb:1}}}})}),(0,ie.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,ie.jsx)(C.A,{label:"Start Time",value:Ce,onChange:e=>{if(!e)return;const t=Ce?new Date(Ce):new Date;if(t.setHours(e.getHours(),e.getMinutes()),we(t),Te){const e=new Date(t.getTime()),i=L.find(e=>e.id===xe);"BOARDING"===(null===i||void 0===i?void 0:i.serviceCategory)?(e.setDate(e.getDate()+1),e.setHours(17,0,0,0)):e.setMinutes(e.getMinutes()+Te),ke(e)}},slotProps:{textField:{fullWidth:!0,size:"small",sx:{mb:1}}}})})]}),(0,ie.jsx)(r.A,{variant:"subtitle2",sx:{mt:1,mb:.5},children:"End Date & Time"}),(0,ie.jsxs)(k.Ay,{container:!0,spacing:2,children:[(0,ie.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,ie.jsx)(D.l,{label:"End Date",value:Ne,onChange:e=>{if(e){if(Ne){const t=Ne.getHours(),i=Ne.getMinutes();e.setHours(t,i)}else e.setHours(17,0,0,0);ke(e)}},slotProps:{textField:{fullWidth:!0,size:"small",sx:{mb:1}}},minDate:Ce||void 0})}),(0,ie.jsx)(k.Ay,{item:!0,xs:12,sm:6,children:(0,ie.jsx)(C.A,{label:"End Time",value:Ne,onChange:e=>{if(!e)return;const t=Ne?new Date(Ne):new Date;t.setHours(e.getHours(),e.getMinutes()),ke(t)},slotProps:{textField:{fullWidth:!0,size:"small",sx:{mb:1}}}})})]}),i&&(0,ie.jsx)(ie.Fragment,{children:(0,ie.jsxs)(h.A,{fullWidth:!0,size:"small",sx:{mb:1},children:[(0,ie.jsx)(v.A,{id:"status-select-label",children:"Reservation Status"}),(0,ie.jsxs)(p.A,{labelId:"status-select-label",id:"status-select",value:Se||"CONFIRMED",label:"Reservation Status",onChange:e=>De(e.target.value),displayEmpty:!0,inputProps:{"aria-label":"Select reservation status","aria-hidden":"false"},children:[(0,ie.jsx)(A.A,{value:"PENDING",children:"Pending"}),(0,ie.jsx)(A.A,{value:"CONFIRMED",children:"Confirmed"}),(0,ie.jsx)(A.A,{value:"CHECKED_IN",children:"Checked In"}),(0,ie.jsx)(A.A,{value:"CHECKED_OUT",children:"Checked Out"}),(0,ie.jsx)(A.A,{value:"COMPLETED",children:"Completed"}),(0,ie.jsx)(A.A,{value:"CANCELLED",children:"Cancelled"}),(0,ie.jsx)(A.A,{value:"NO_SHOW",children:"No Show"})]})]})}),!i&&(0,ie.jsx)(l.A,{sx:{mb:2,p:2,bgcolor:"warning.light",borderRadius:1,border:"2px solid",borderColor:"warning.main"},children:(0,ie.jsxs)(r.A,{variant:"body2",color:"warning.contrastText",sx:{fontWeight:"bold"},children:["\u26a0\ufe0f ",(0,ie.jsx)("strong",{children:"IMPORTANT:"}),' Use "Proceed to Checkout" below to create reservations with proper invoicing and payment processing. This ensures accurate financial records and analytics.']})}),(0,ie.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:1,flexDirection:{xs:"column",sm:"row"}},children:[!i&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsxs)(g.A,{variant:"contained",color:"primary",size:M?"medium":"large",onClick:async()=>{Pe(""),ze(!0);try{if(!K||!de||!xe||!Ce||!Ne)return Pe("Please fill in all required fields"),void ze(!1);const e=F.find(e=>e.id===K),i=B.find(e=>e.id===de),s=L.find(e=>e.id===xe),n=Ge.find(e=>e.id===He);if(!e||!i||!s)return Pe("Invalid selection. Please try again."),void ze(!1);let r;if(("GROOMING"===s.serviceCategory||"TRAINING"===s.serviceCategory)&&t){const e={customerId:K,petId:de,serviceId:xe,startDate:Ce?Ce.toISOString():null,endDate:Ne?Ne.toISOString():null,status:"PENDING",notes:""};try{const i=await t(e);if(null===i||void 0===i||!i.reservationId)throw new Error("Failed to create reservation");r=i.reservationId}catch(Oe){throw console.error("Error creating reservation:",Oe),Oe}}const a={id:"reservation-".concat(r||Date.now()),price:s.price||0,quantity:1,serviceName:s.name,serviceId:s.id,serviceCategory:s.serviceCategory,customerId:e.id,customerName:"".concat(e.firstName," ").concat(e.lastName),petId:i.id,petName:i.name,startDate:Ce,endDate:Ne,suiteType:be||"STANDARD_SUITE",resourceId:He||void 0,resourceName:(null===n||void 0===n?void 0:n.name)||void 0,notes:"",addOns:[]};qe(a),Ue("/checkout")}catch(Oe){console.error("Error preparing checkout:",Oe),Pe(Oe.message||"An error occurred. Please try again.")}finally{ze(!1)}},disabled:Re,fullWidth:M,sx:{mr:{xs:0,sm:1},px:{xs:2,sm:3},py:{xs:1,sm:1.5},fontSize:{xs:"1rem",sm:"1.1rem"},fontWeight:"bold"},children:["\ud83d\uded2 ",M?"Checkout":"Proceed to Checkout (Recommended)"]}),(0,ie.jsx)(g.A,{type:"submit",variant:"outlined",color:"secondary",size:(0,R.Qz)(M),disabled:Re,fullWidth:M,children:Re?"Processing...":M?"Quick Create":"Quick Create (Staff Only)"})]}),i&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(g.A,{variant:"outlined",color:"error",size:(0,R.Qz)(M),startIcon:M?void 0:(0,ie.jsx)(S.A,{}),onClick:()=>Ye(!0),disabled:Re||Ze,fullWidth:M,sx:{mr:{xs:0,sm:1},mb:{xs:1,sm:0}},children:M?(0,ie.jsx)(S.A,{}):"Delete"}),(0,ie.jsx)(g.A,{type:"submit",variant:"contained",color:"primary",size:(0,R.Qz)(M),disabled:Re,fullWidth:M,children:Re?"Processing...":M?"Update":"Update Reservation"})]})]})]})}),(0,ie.jsx)(se,{open:tt&&!!st&&!!rt,onClose:()=>{it(!1),lt(),G&&G()},reservationId:st,serviceId:rt,onAddOnsAdded:e=>{if(it(!1),e){lt();const e=new CustomEvent("reservationComplete",{detail:{success:!0}});document.dispatchEvent(e)}}}),(0,ie.jsxs)(x.A,{open:Qe,onClose:()=>!Ze&&Ye(!1),children:[(0,ie.jsx)(f.A,{children:"Delete Reservation?"}),(0,ie.jsx)(y.A,{children:(0,ie.jsx)(j.A,{children:"Are you sure you want to delete this reservation? This action cannot be undone."})}),(0,ie.jsxs)(b.A,{children:[(0,ie.jsx)(g.A,{onClick:()=>Ye(!1),disabled:Ze,children:"Cancel"}),(0,ie.jsx)(g.A,{onClick:async()=>{if(null===i||void 0===i||!i.id)return void Pe("No reservation ID found");console.log("Deleting reservation:",i.id),$e(!0);try{const e=await fetch("".concat(window.location.origin,"/api/reservations/").concat(i.id),{method:"DELETE",headers:{"x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"}});if(!e.ok){const t=await e.text();throw console.error("Delete failed:",e.status,t),new Error("Failed to delete: ".concat(e.status," - ").concat(t))}console.log("Delete successful"),Ye(!1),G&&G(),window.location.reload()}catch(e){console.error("Delete error:",e),Pe(e.message||"Failed to delete reservation"),Ye(!1)}finally{$e(!1)}},color:"error",variant:"contained",disabled:Ze,children:Ze?"Deleting...":"Delete"})]})]})]})}}}]);