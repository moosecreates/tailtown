"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[7063],{37063:(e,s,r)=>{r.r(s),r.d(s,{default:()=>M});var i=r(89379),n=r(9950),t=r(28429),l=r(62999),a=r(78317),c=r(82053),o=r(10226),d=r(2235),x=r(8145),h=r(2046),A=r(93125),j=r(39919),v=r(1320),u=r(15769),g=r(69780),y=r(9213),p=r(21671),m=r(34075),f=r(25277),C=r(83274),S=r(25333),b=r(96583),w=r(40033),I=r(28170),G=r(79739),k=r(98785),D=r(65429),L=r(99532),z=r(7999),N=r(57988),R=r(19223),O=r(58531),E=r(16250),P=r(73175),W=r(41976),B=r(44414);const M=()=>{const e=(0,t.Zp)(),[s,r]=(0,n.useState)([]),[M,T]=(0,n.useState)(!0),[V]=(0,n.useState)(null),[F,Y]=(0,n.useState)(!1),[_,H]=(0,n.useState)(null),[Z,$]=(0,n.useState)("ALL"),[q,J]=(0,n.useState)(""),[K,Q]=(0,n.useState)({open:!1,message:"",severity:"success"}),U=(0,n.useCallback)(async()=>{try{var e;const s=await W.V.getAllServices({limit:100});Array.isArray(s)?r(s):null!==s&&void 0!==s&&null!==(e=s.data)&&void 0!==e&&e.data&&Array.isArray(s.data.data)?r(s.data.data):null!==s&&void 0!==s&&s.data&&Array.isArray(s.data)?r(s.data):(console.error("Invalid services response format:",s),r([])),T(!1)}catch(s){console.error("Error loading services:",s),s.response&&console.error("Response error:",s.response.data),Q({open:!0,message:"Failed to load services",severity:"error"}),r([]),T(!1)}},[]);(0,n.useEffect)(()=>{U()},[U]);const X=()=>{Y(!1),H(null)},ee=()=>{Q((0,i.A)((0,i.A)({},K),{},{open:!1}))},se=s.filter(e=>{if("ALL"!==Z&&e.serviceCategory!==Z)return!1;if(q){const s=q.toLowerCase();return e.name.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s)}return!0}),re={total:s.length,withGingrId:s.filter(e=>e.externalId).length,withoutPrice:s.filter(e=>0===e.price).length,byCategory:s.reduce((e,s)=>(e[s.serviceCategory]=(e[s.serviceCategory]||0)+1,e),{})};return M?(0,B.jsx)(l.A,{maxWidth:"lg",children:(0,B.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,B.jsx)(c.A,{children:"Loading services..."})})}):V?(0,B.jsx)(l.A,{maxWidth:"lg",children:(0,B.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,B.jsx)(c.A,{color:"error",children:V})})}):(0,B.jsxs)(l.A,{maxWidth:"lg",children:[(0,B.jsxs)(a.A,{sx:{py:4},children:[(0,B.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,B.jsx)(c.A,{variant:"h4",component:"h1",children:"Services"}),(0,B.jsx)(o.A,{variant:"contained",color:"primary",startIcon:(0,B.jsx)(L.A,{}),onClick:()=>{e("/services/new")},children:"Add Service"})]}),(0,B.jsxs)(a.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2,mb:3},children:[(0,B.jsxs)(d.A,{sx:{p:2},children:[(0,B.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"Total Services"}),(0,B.jsx)(c.A,{variant:"h4",children:re.total})]}),(0,B.jsx)(d.A,{sx:{p:2},children:(0,B.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(O.A,{color:"primary"}),(0,B.jsxs)(a.A,{children:[(0,B.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"Linked to Gingr"}),(0,B.jsx)(c.A,{variant:"h4",children:re.withGingrId})]})]})}),(0,B.jsx)(d.A,{sx:{p:2},children:(0,B.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,B.jsx)(P.A,{color:"warning"}),(0,B.jsxs)(a.A,{children:[(0,B.jsx)(c.A,{variant:"body2",color:"textSecondary",children:"Need Pricing"}),(0,B.jsx)(c.A,{variant:"h4",children:re.withoutPrice})]})]})})]}),(0,B.jsx)(d.A,{sx:{p:2,mb:3},children:(0,B.jsxs)(a.A,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[(0,B.jsx)(x.A,{placeholder:"Search services...",value:q,onChange:e=>J(e.target.value),size:"small",sx:{minWidth:300},InputProps:{startAdornment:(0,B.jsx)(h.A,{position:"start",children:(0,B.jsx)(R.A,{})})}}),(0,B.jsxs)(A.A,{value:Z,exclusive:!0,onChange:(e,s)=>s&&$(s),size:"small",children:[(0,B.jsxs)(j.A,{value:"ALL",children:["All (",re.total,")"]}),(0,B.jsxs)(j.A,{value:"BOARDING",children:["Boarding (",re.byCategory.BOARDING||0,")"]}),(0,B.jsxs)(j.A,{value:"DAYCARE",children:["Daycare (",re.byCategory.DAYCARE||0,")"]}),(0,B.jsxs)(j.A,{value:"GROOMING",children:["Grooming (",re.byCategory.GROOMING||0,")"]})]})]})}),(0,B.jsx)(v.A,{component:d.A,children:(0,B.jsxs)(u.A,{children:[(0,B.jsx)(g.A,{children:(0,B.jsxs)(y.A,{children:[(0,B.jsx)(p.A,{children:"Name"}),(0,B.jsx)(p.A,{children:"Category"}),(0,B.jsx)(p.A,{children:"Description"}),(0,B.jsx)(p.A,{children:"Price"}),(0,B.jsx)(p.A,{children:"Duration"}),(0,B.jsx)(p.A,{children:"Gingr"}),(0,B.jsx)(p.A,{children:"Status"}),(0,B.jsx)(p.A,{align:"right",children:"Actions"})]})}),(0,B.jsx)(m.A,{children:0===se.length?(0,B.jsx)(y.A,{children:(0,B.jsx)(p.A,{colSpan:8,align:"center",children:(0,B.jsx)(c.A,{variant:"body2",color:"textSecondary",sx:{py:3},children:"No services found"})})}):se.map(s=>(0,B.jsxs)(y.A,{children:[(0,B.jsx)(p.A,{children:s.name}),(0,B.jsx)(p.A,{children:(0,B.jsx)(f.A,{label:s.serviceCategory,color:"primary",variant:"outlined",size:"small"})}),(0,B.jsx)(p.A,{children:s.description}),(0,B.jsx)(p.A,{children:(0,B.jsx)(f.A,{label:"$".concat(s.price),color:"primary",variant:"outlined",size:"small"})}),(0,B.jsx)(p.A,{children:(0,B.jsx)(f.A,{label:(()=>{const e=Math.floor(s.duration/60),r=s.duration%60;return 0===e&&0===r?"0m":0===e?"".concat(r,"m"):0===r?"".concat(e,"h"):"".concat(e,"h ").concat(r,"m")})(),color:"secondary",variant:"outlined",size:"small"})}),(0,B.jsx)(p.A,{children:(0,B.jsx)(C.A,{title:s.externalId?"Gingr ID: ".concat(s.externalId):"Not linked to Gingr",children:s.externalId?(0,B.jsx)(O.A,{color:"primary",fontSize:"small"}):(0,B.jsx)(E.A,{color:"disabled",fontSize:"small"})})}),(0,B.jsx)(p.A,{children:(0,B.jsx)(f.A,{label:s.isActive?"Active":"Inactive",color:s.isActive?"success":"error",size:"small"})}),(0,B.jsxs)(p.A,{align:"right",children:[(0,B.jsx)(S.A,{size:"small",onClick:()=>{return r=s.id,void e("/services/".concat(r));var r},"aria-label":"edit",title:"Edit service",children:(0,B.jsx)(z.A,{})}),(0,B.jsx)(S.A,{size:"small",onClick:()=>(e=>{H(e),Y(!0)})(s),"aria-label":"delete",title:"Delete service",children:(0,B.jsx)(N.A,{})})]})]},s.id))})]})}),(0,B.jsxs)(b.A,{open:F,onClose:X,children:[(0,B.jsx)(w.A,{children:"Delete Service"}),(0,B.jsx)(I.A,{children:(0,B.jsxs)(c.A,{children:["Are you sure you want to delete ",null===_||void 0===_?void 0:_.name,"? This action cannot be undone."]})}),(0,B.jsxs)(G.A,{children:[(0,B.jsx)(o.A,{onClick:X,children:"Cancel"}),(0,B.jsx)(o.A,{onClick:async()=>{if(_){try{try{const e=await W.V.deleteService(_.id),s=(null===e||void 0===e?void 0:e.message)||"Service deleted successfully";Q({open:!0,message:s,severity:"success"}),U()}catch(e){if(!e.message||!e.message.includes("active reservations")&&!e.message.includes("deactivate"))throw e;console.log("Service could not be deleted, automatically deactivating instead"),await W.V.deactivateService(_.id),Q({open:!0,message:"Service has been deactivated instead of deleted because it has reservations",severity:"success"}),U()}}catch(s){const e=s.message||"Failed to delete service";Q({open:!0,message:e,severity:"error"})}Y(!1),H(null)}},color:"error",children:"Delete"})]})]})]}),(0,B.jsx)(k.A,{open:K.open,autoHideDuration:6e3,onClose:ee,children:(0,B.jsx)(D.A,{onClose:ee,severity:K.severity,sx:{width:"100%"},children:K.message})})]})}}}]);