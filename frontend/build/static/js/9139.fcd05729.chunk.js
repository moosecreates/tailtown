"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[9139],{59139:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var a=s(9950),n=s(62999),r=s(78317),i=s(2235),o=s(82053),l=s(60899),c=s(25979),d=s(19647),u=s(70006),p=s(23266),h=s(10226),m=s(46639),y=s(65429),g=s(74745),A=s(95722),x=s(396),v=s(81831),b=s(8321),f=s(73684),C=s(71891),j=s(69179),N=s(99107),I=s(43974),w=s(44414);const k=()=>{const[e,t]=(0,a.useState)(()=>new Date),[s,k]=(0,a.useState)("ALL"),[D,E]=(0,a.useState)(!0),[S,O]=(0,a.useState)(null),[L,T]=(0,a.useState)(!1),[M,z]=(0,a.useState)(!1),R=(0,a.useRef)(!1),[G,P]=(0,a.useState)([]),[_,F]=(0,a.useState)([]),[K,W]=(0,a.useState)({}),[B,H]=(0,a.useState)({}),[U,q]=(0,a.useState)("America/Denver");(0,a.useEffect)(()=>{L&&e&&X()},[e,s,L]),(0,a.useEffect)(()=>{if(M||L||R.current)return;R.current=!0,z(!0);const e=new Date;t(e);(async()=>{try{E(!0),O(null);const t=(0,I.A)(e,"yyyy-MM-dd");console.log("Initial load: Loading kennel cards for check-in date: ".concat(t));const s=await N.y.getCurrentTenantTimezone();q(s),console.log("Using tenant timezone: ".concat(s));const a=await j.u.getAllReservations(1,500,"startDate","asc","",void 0,t,s);let n=[];if(a&&a.data&&(Array.isArray(a.data)?n=a.data:"object"===typeof a.data&&"items"in a.data&&Array.isArray(a.data.items)?n=a.data.items:"object"===typeof a.data&&"reservations"in a.data&&Array.isArray(a.data.reservations)&&(n=a.data.reservations)),P(n),n.length>0){const e=$(n);J(n,e.pets,e.customers)}else F([])}catch(t){console.error("Error in initial load:",t),O("Failed to load reservations. "+(t.message||""))}finally{E(!1),z(!1),T(!0)}})()},[]);const X=(0,a.useCallback)(async()=>{if(e)try{E(!0),O(null);const t=(0,I.A)(e,"yyyy-MM-dd");console.log("Loading kennel cards for check-in date: ".concat(t)),console.log("Using tenant timezone: ".concat(U));const a=await j.u.getAllReservations(1,500,"startDate","asc","ALL"===s?"":s,void 0,t,U);let n=[];a&&a.data&&(Array.isArray(a.data)?n=a.data:"object"===typeof a.data&&"items"in a.data&&Array.isArray(a.data.items)?n=a.data.items:"object"===typeof a.data&&"reservations"in a.data&&Array.isArray(a.data.reservations)?n=a.data.reservations:(console.warn("Unexpected response structure:",a.data),n=[])),n.length,P(n);const r=$(n);J(n,r.pets,r.customers)}catch(a){console.error("Error loading reservations:",a),O("Failed to load reservations. "+(a.message||""))}finally{E(!1)}else t(new Date)},[e,s,U]),$=(0,a.useCallback)(e=>{try{const t={},s={};return e.forEach(e=>{e.pet&&e.petId&&(t[e.petId]=e.pet),e.customer&&e.customerId&&(s[e.customerId]=e.customer)}),W(t),H(s),console.log("Extracted ".concat(Object.keys(t).length," pets and ").concat(Object.keys(s).length," customers from reservations")),{pets:t,customers:s}}catch(t){return console.error("Error extracting additional data:",t),{pets:{},customers:{}}}},[]),J=(0,a.useCallback)((e,t,s)=>{const a=e||G,n=t||K,r=s||B;if(!Array.isArray(a))return console.error("reservationsData is not an array:",a),void F([]);console.log("Filtering ".concat(a.length," reservations with ").concat(Object.keys(n).length," pets and ").concat(Object.keys(r).length," customers"));const i=a.filter(e=>e.petId&&e.customerId?n[e.petId]?!!r[e.customerId]||(console.log("Reservation ".concat(e.id," missing customer data for customerId: ").concat(e.customerId)),!1):(console.log("Reservation ".concat(e.id," missing pet data for petId: ").concat(e.petId)),!1):(console.log("Reservation ".concat(e.id," missing petId or customerId")),!1));console.log("Filtered to ".concat(i.length," reservations")),F(i)},[G,K,B]),Q=(0,a.useCallback)(e=>{const t=[];return e.vaccinationStatus&&Object.entries(e.vaccinationStatus).forEach(e=>{let[s,a]=e;"EXPIRED"===a.status&&t.push("".concat(s," vaccination expired"))}),e.specialNeeds&&t.push(e.specialNeeds),e.behaviorNotes&&(e.behaviorNotes.toLowerCase().includes("caution")||e.behaviorNotes.toLowerCase().includes("warning")||e.behaviorNotes.toLowerCase().includes("alert"))&&t.push(e.behaviorNotes),t},[]);return(0,w.jsxs)(v.$,{dateAdapter:x.h,children:[(0,w.jsx)("style",{type:"text/css",media:"print",children:"\n          @page { \n            size: letter portrait; \n            margin: 0.25in; \n          }\n          body * {\n            visibility: hidden;\n          }\n          .kennel-card-container, .kennel-card-container * {\n            visibility: visible;\n          }\n          .kennel-card-container {\n            position: absolute;\n            left: 0;\n            top: 0;\n          }\n          nav, header, footer, button, .MuiAppBar-root, .MuiDrawer-root {\n            display: none !important;\n          }\n        "}),(0,w.jsx)(n.A,{maxWidth:"lg",children:(0,w.jsxs)(r.A,{sx:{py:4},children:[(0,w.jsx)(i.A,{sx:{p:3,mb:4},className:"no-print",children:(0,w.jsx)(o.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Print Kennel Cards"})}),(0,w.jsxs)(i.A,{sx:{p:3,mb:4,"@media print":{display:"none"}},children:[(0,w.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,w.jsx)(b.A,{sx:{mr:1}}),(0,w.jsx)(o.A,{variant:"h6",children:"Filters"})]}),(0,w.jsxs)(l.Ay,{container:!0,spacing:3,children:[(0,w.jsx)(l.Ay,{item:!0,xs:12,md:4,children:(0,w.jsx)(A.l,{label:"Date",value:e,onChange:e=>{t(e)},slotProps:{textField:{fullWidth:!0,size:"small",helperText:"Select date to filter reservations"}}})}),(0,w.jsx)(l.Ay,{item:!0,xs:12,md:4,children:(0,w.jsxs)(c.A,{fullWidth:!0,children:[(0,w.jsx)(d.A,{id:"status-select-label",children:"Status"}),(0,w.jsxs)(u.A,{labelId:"status-select-label",id:"status-select",value:s,label:"Status",onChange:e=>{k(e.target.value)},size:"small",children:[(0,w.jsx)(p.A,{value:"ALL",children:"All Statuses"}),(0,w.jsx)(p.A,{value:"PENDING",children:"Pending"}),(0,w.jsx)(p.A,{value:"CONFIRMED",children:"Confirmed"}),(0,w.jsx)(p.A,{value:"CHECKED_IN",children:"Checked In"}),(0,w.jsx)(p.A,{value:"CHECKED_OUT",children:"Checked Out"}),(0,w.jsx)(p.A,{value:"COMPLETED",children:"Completed"}),(0,w.jsx)(p.A,{value:"CANCELLED",children:"Cancelled"}),(0,w.jsx)(p.A,{value:"NO_SHOW",children:"No Show"})]})]})}),(0,w.jsx)(l.Ay,{item:!0,xs:12,md:4,children:(0,w.jsx)(h.A,{variant:"contained",color:"primary",startIcon:(0,w.jsx)(f.A,{}),onClick:()=>{setTimeout(()=>{window.print()},300)},fullWidth:!0,size:"large",disabled:0===_.length,sx:{py:1.5,fontSize:"1.1rem"},children:"Print Kennel Cards"})})]})]}),D&&(0,w.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",my:4,"@media print":{display:"none"}},children:(0,w.jsx)(m.A,{})}),S&&(0,w.jsx)(y.A,{severity:"error",sx:{mb:4,"@media print":{display:"none"}},children:S}),!D&&0===_.length&&(0,w.jsx)(y.A,{severity:"info",sx:{mb:4,"@media print":{display:"none"}},children:"No reservations found with the selected filters."}),(0,w.jsxs)(r.A,{sx:{display:"none","@media print":{display:"block",mb:2}},children:[(0,w.jsxs)(o.A,{variant:"h5",align:"center",children:["Kennel Cards - ",e?(0,I.A)(e,"MMMM d, yyyy"):""]}),(0,w.jsxs)(o.A,{variant:"subtitle1",align:"center",gutterBottom:!0,children:["Status: ","ALL"===s?"All Statuses":"CHECKED_IN"===s?"Checked In":"CONFIRMED"===s?"Confirmed":"CHECKED_OUT"===s?"Checked Out":"COMPLETED"===s?"Completed":"CANCELLED"===s?"Cancelled":"NO_SHOW"===s?"No Show":"Pending"]}),(0,w.jsx)(g.A,{sx:{my:2}})]}),(0,w.jsx)(r.A,{className:"kennel-card-container",sx:{display:"flex",flexDirection:"column",gap:4,"@media print":{gap:0,"& > *":{pageBreakAfter:"always",marginBottom:"0.5in"}}},children:_.map(e=>{const t=K[e.petId],s=B[e.customerId],a=e.resource;let n=0,i="STANDARD_SUITE";if(a?(a.attributes&&a.attributes.suiteType?i=a.attributes.suiteType:a.type&&(i=a.type),a.attributes&&a.attributes.suiteNumber?n=a.attributes.suiteNumber:a.name&&(n=a.name)):e.resourceId&&(n=1),!n&&e.serviceType&&("GROOMING"===e.serviceType?(n="G".charCodeAt(0),i="GROOMING"):"TRAINING"===e.serviceType?(n="T".charCodeAt(0),i="TRAINING"):n=1),0===n){const t=e.id.replace(/[^0-9]/g,"");n=t.length>0?parseInt(t.slice(-2))||1:Math.abs(e.id.split("").reduce((e,t)=>e+t.charCodeAt(0),0))%100+1}let o=[];if(t.petIcons&&Array.isArray(t.petIcons)&&t.petIcons.length>0)o=[...t.petIcons];else if("vader"===t.name.toLowerCase())o=["small-size","medium-group","resource-guarder","medication-required","advanced-handling"];else{t.weight?t.weight<20?o.push("small-size"):t.weight>=20&&t.weight<=50?o.push("medium-size"):o.push("large-size"):"DOG"===t.type?o.push("medium-size"):"CAT"===t.type&&o.push("small-size");const e=t.name.length%4;if(0===e?o.push("small-group"):1===e?o.push("medium-group"):2===e?o.push("large-group"):o.push("solo-only"),t.behaviorNotes){const e=t.behaviorNotes.toLowerCase();(e.includes("bark")||e.includes("vocal"))&&o.push("barker"),(e.includes("chew")||e.includes("destroy")||e.includes("bed"))&&o.push("no-bedding"),(e.includes("jump")||e.includes("escape"))&&o.push("escape-artist"),(e.includes("resource")||e.includes("guard")||e.includes("food aggression"))&&o.push("resource-guarder")}else{const e=(t.name.charCodeAt(0)||0)%4;0===e?o.push("barker"):1===e?o.push("digger"):2===e?o.push("mouthy"):o.push("fence-fighter")}t.medicationNotes&&o.push("medication-required"),t.specialNeeds&&o.push("medical-monitoring"),t.allergies&&o.push("special-diet");const s=t.id.charCodeAt(0)%3;0===s?o.push("advanced-handling"):1===s?o.push("approach-slowly"):o.push("harness-only")}0===o.length&&console.warn("No pet icons generated for:",t.name);const l=Q(t);return(0,w.jsx)(r.A,{sx:{mb:4},className:"kennel-card-container",children:(0,w.jsx)(C.A,{kennelNumber:n,suiteType:i,petName:t.name,petBreed:t.breed,petWeight:t.weight,petIconIds:o,petType:t.type||"DOG",customNotes:t.iconNotes||{},petNotes:t.behaviorNotes||"",ownerName:"".concat(s.firstName," ").concat(s.lastName),ownerPhone:s.phone,startDate:new Date(e.startDate),endDate:new Date(e.endDate),alerts:l})},e.id)})})]})})]})}}}]);