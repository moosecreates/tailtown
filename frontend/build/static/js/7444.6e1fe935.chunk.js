"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[7444],{27444:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var a=s(89379),l=s(9950),n=s(28429),i=s(66699),o=s(65429),r=s(78317),c=s(48089),d=s(50704),h=s(82053),x=s(25277),u=s(16497),m=s(93038),p=s(8145),A=s(31769),j=s(10226),g=s(96557),b=s(39972),y=s(11227),f=s(40379),C=s(44414);function v(){var e,t;const{id:s}=(0,n.g)(),[v,E]=(0,l.useState)(null),[I,T]=(0,l.useState)(!0),[k,S]=(0,l.useState)(!1),w=l.useCallback(async()=>{try{const e=await fetch("/api/checklists/instances/".concat(s),{headers:{"x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"}}),t=await e.json();E(t.data)}catch(e){console.error("Failed to load checklist:",e)}finally{T(!1)}},[s]);(0,l.useEffect)(()=>{w()},[w]);const O=async(e,t)=>{if(v){S(!0);try{await fetch("/api/checklists/instances/".concat(s,"/item"),{method:"PUT",headers:{"Content-Type":"application/json","x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"},body:JSON.stringify((0,a.A)({templateItemId:e.templateItemId},t))});const l=v.items.map(s=>s.templateItemId===e.templateItemId?(0,a.A)((0,a.A)((0,a.A)({},s),t),{},{isCompleted:!0}):s);E((0,a.A)((0,a.A)({},v),{},{items:l}))}catch(l){console.error("Failed to update item:",l)}finally{S(!1)}}};if(I)return(0,C.jsx)(i.A,{});if(!v)return(0,C.jsx)(o.A,{severity:"error",children:"Checklist not found"});const P=v.items.filter(e=>e.isCompleted).length,M=v.items.length,L=P/M*100;return(0,C.jsxs)(r.A,{sx:{p:2,maxWidth:600,mx:"auto"},children:[(0,C.jsx)(c.A,{sx:{mb:2},children:(0,C.jsxs)(d.A,{children:[(0,C.jsx)(h.A,{variant:"h5",gutterBottom:!0,children:null===(e=v.template)||void 0===e?void 0:e.name}),(0,C.jsx)(h.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:null===(t=v.template)||void 0===t?void 0:t.description}),(0,C.jsxs)(r.A,{sx:{mt:2,mb:1},children:[(0,C.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,C.jsxs)(h.A,{variant:"body2",children:["Progress: ",P," / ",M]}),(0,C.jsxs)(h.A,{variant:"body2",children:[Math.round(L),"%"]})]}),(0,C.jsx)(i.A,{variant:"determinate",value:L})]}),"COMPLETED"===v.status&&(0,C.jsx)(x.A,{icon:(0,C.jsx)(y.A,{}),label:"Completed",color:"success",sx:{mt:1}})]})}),v.items.map((e,t)=>(0,C.jsx)(c.A,{sx:{mb:2},children:(0,C.jsxs)(d.A,{children:[(0,C.jsxs)(r.A,{sx:{display:"flex",alignItems:"start",mb:1},children:[(0,C.jsxs)(h.A,{variant:"h6",sx:{flex:1},children:[e.label,e.isRequired&&(0,C.jsx)(x.A,{label:"Required",size:"small",color:"error",sx:{ml:1}})]}),e.isCompleted&&(0,C.jsx)(y.A,{color:"success"})]}),e.description&&(0,C.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:e.description}),"CHECKBOX"===e.type&&(0,C.jsx)(u.A,{control:(0,C.jsx)(m.A,{checked:e.checkboxValue||!1,onChange:t=>O(e,{checkboxValue:t.target.checked}),disabled:"COMPLETED"===v.status}),label:"Complete"}),"TEXT"===e.type&&(0,C.jsx)(p.A,{fullWidth:!0,multiline:!0,rows:2,value:e.textValue||"",onChange:t=>O(e,{textValue:t.target.value}),placeholder:"Enter text...",disabled:"COMPLETED"===v.status}),"NUMBER"===e.type&&(0,C.jsx)(p.A,{fullWidth:!0,type:"number",value:e.numberValue||"",onChange:t=>O(e,{numberValue:parseFloat(t.target.value)}),placeholder:"Enter number...",disabled:"COMPLETED"===v.status}),"RATING"===e.type&&(0,C.jsx)(r.A,{children:(0,C.jsx)(A.A,{value:e.ratingValue||0,onChange:(t,s)=>O(e,{ratingValue:s||0}),disabled:"COMPLETED"===v.status})}),"PHOTO"===e.type&&(0,C.jsxs)(r.A,{children:[(0,C.jsx)(j.A,{variant:"outlined",startIcon:(0,C.jsx)(b.A,{}),disabled:"COMPLETED"===v.status,children:"Take Photo"}),e.photoUrls&&e.photoUrls.length>0&&(0,C.jsxs)(h.A,{variant:"body2",sx:{mt:1},children:[e.photoUrls.length," photo(s) attached"]})]}),"SIGNATURE"===e.type&&(0,C.jsxs)(r.A,{children:[(0,C.jsx)(j.A,{variant:"outlined",startIcon:(0,C.jsx)(f.A,{}),disabled:"COMPLETED"===v.status,children:"Add Signature"}),e.signatureUrl&&(0,C.jsx)(h.A,{variant:"body2",sx:{mt:1},color:"success.main",children:"\u2713 Signed"})]}),"MULTI_SELECT"===e.type&&(0,C.jsx)(g.A,{children:(0,C.jsx)(h.A,{variant:"body2",color:"text.secondary",children:"Multi-select options would go here"})}),e.notes&&(0,C.jsx)(o.A,{severity:"info",sx:{mt:2},children:e.notes})]})},t)),"COMPLETED"!==v.status&&(0,C.jsx)(j.A,{fullWidth:!0,variant:"contained",size:"large",onClick:async()=>{if(!v)return;const e=v.items.filter(e=>e.isRequired);if(e.filter(e=>e.isCompleted).length<e.length)alert("Please complete all required items before finishing.");else try{await fetch("/api/checklists/instances/".concat(s,"/complete"),{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId")||"dev"},body:JSON.stringify({notes:""})}),alert("Checklist completed!"),w()}catch(t){console.error("Failed to complete checklist:",t)}},disabled:k,sx:{mt:2},children:"Complete Checklist"})]})}}}]);