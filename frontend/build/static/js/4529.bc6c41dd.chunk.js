"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[4529],{46162:(e,n,o)=>{o.r(n),o.d(n,{default:()=>pe});var t=o(9950),r=o(28429),i=o(42074);const a=o.p+"static/media/tail town logo.2d6c1ab0193074ddfc1c.jpg";var s=o(78317),l=o(46639),c=o(83239),d=o(74745),h=o(249),x=o(26050),m=o(57357),p=o(14195),A=o(83563),u=o(74489),g=o(88060),j=o(25333),b=o(82053),y=o(41413),f=o(86817),v=o(23266),k=o(39694),C=o(76787),w=o(98692),S=o(7168),I=o(64258),T=o(67920),z=o(73753),E=o(93472),M=o(80801),P=o(64085),N=o(4477),L=o(73684),R=o(83456),W=o(24783),D=o(29156),O=o(95050),B=o(35834),_=o(59086),U=o(73212),G=o(91348),H=o(83337),F=o(91367),K=o(65429),V=o(10226),J=o(95699),Y=o(37319),Z=o(26910),q=o(44414);const Q=e=>{let{onExit:n}=e;const[o,r]=(0,t.useState)(null),[i,a]=(0,t.useState)(0),[l,c]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const e=localStorage.getItem("impersonationSession");if(e){const n=JSON.parse(e);r(n)}},[]),(0,t.useEffect)(()=>{if(!o)return;const e=()=>{const e=new Date(o.expiresAt).getTime(),n=Date.now(),t=Math.max(0,Math.floor((e-n)/1e3));a(t),t<=300&&t>0&&c(!0),0===t&&d()};e();const n=setInterval(e,1e3);return()=>clearInterval(n)},[o]);const d=async()=>{try{const e=localStorage.getItem("superAdminAccessToken"),n=()=>window.location.origin;o&&e&&await Z.A.post("".concat(n(),"/api/super-admin/impersonate/end/").concat(o.id),{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Error ending impersonation:",e)}finally{localStorage.removeItem("impersonationToken"),localStorage.removeItem("impersonationSession");const e=localStorage.getItem("superAdminAccessToken");e?(localStorage.setItem("accessToken",e),localStorage.setItem("token",e),localStorage.setItem("tokenTimestamp",Date.now().toString())):(localStorage.removeItem("accessToken"),localStorage.removeItem("token"),localStorage.removeItem("tokenTimestamp")),localStorage.removeItem("tailtown_tenant_id"),localStorage.removeItem("tenantId"),localStorage.removeItem("user"),window.location.href="/admin/tenants"}};return o?(0,q.jsx)(K.A,{severity:l?"warning":"info",icon:l?(0,q.jsx)(J.A,{}):void 0,sx:{borderRadius:0,position:"sticky",top:0,zIndex:1200,"& .MuiAlert-message":{width:"100%"}},action:(0,q.jsx)(V.A,{color:"inherit",size:"small",startIcon:(0,q.jsx)(Y.A,{}),onClick:d,children:"Exit Impersonation"}),children:(0,q.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,q.jsxs)(b.A,{variant:"body2",sx:{fontWeight:"bold"},children:["\ud83d\udd10 Impersonating: ",o.businessName," (",o.subdomain,")"]}),(0,q.jsxs)(b.A,{variant:"body2",sx:{ml:2},children:[l?"\u26a0\ufe0f ":"","Time Remaining: ",(e=>{const n=Math.floor(e/60),o=e%60;return"".concat(n,":").concat(o.toString().padStart(2,"0"))})(i)]})]})}):null};var X=o(89379),$=o(28810),ee=o(25277),ne=o(73647),oe=o(67991),te=o(73175),re=o(4983),ie=o(1589),ae=o(99532);const se=e=>{let{announcements:n,onAnnouncementClick:o,onCreateClick:r}=e;const[i,a]=(0,t.useState)(null),l=Boolean(i),c=()=>{a(null)},h=()=>{c(),o()},x=()=>{c(),r&&r()},m=e=>{const n={fontSize:"small"};switch(e){case"WARNING":return(0,q.jsx)(te.A,(0,X.A)((0,X.A)({},n),{},{color:"warning"}));case"SUCCESS":return(0,q.jsx)(re.A,(0,X.A)((0,X.A)({},n),{},{color:"success"}));case"ERROR":return(0,q.jsx)(ie.A,(0,X.A)((0,X.A)({},n),{},{color:"error"}));default:return(0,q.jsx)(oe.A,(0,X.A)((0,X.A)({},n),{},{color:"info"}))}},u=e=>{switch(e){case"URGENT":return"error";case"HIGH":return"warning";case"NORMAL":return"primary";default:return"default"}},g=n.filter(e=>"URGENT"===e.priority).length>0?"error":"primary";return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(j.A,{color:"inherit",onClick:e=>{a(e.currentTarget)},"aria-label":"announcements",sx:{ml:1},children:(0,q.jsx)($.A,{badgeContent:n.length,color:g,children:(0,q.jsx)(ne.A,{})})}),(0,q.jsxs)(f.A,{anchorEl:i,open:l,onClose:c,PaperProps:{sx:{maxHeight:400,width:360,mt:1}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[(0,q.jsxs)(s.A,{sx:{px:2,py:1.5,borderBottom:1,borderColor:"divider"},children:[(0,q.jsx)(b.A,{variant:"h6",component:"div",children:"Announcements"}),(0,q.jsxs)(b.A,{variant:"caption",color:"text.secondary",children:[n.length," ",1===n.length?"announcement":"announcements"]})]}),0===n.length?[(0,q.jsx)(v.A,{disabled:!0,children:(0,q.jsx)(A.A,{primary:"No announcements",secondary:"You're all caught up!"})},"no-announcements"),...r?[(0,q.jsx)(d.A,{},"divider-create"),(0,q.jsxs)(v.A,{onClick:x,sx:{py:1.5,backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},children:[(0,q.jsx)(p.A,{sx:{minWidth:36,color:"inherit"},children:(0,q.jsx)(ae.A,{})}),(0,q.jsx)(A.A,{primary:(0,q.jsx)(b.A,{variant:"body2",sx:{fontWeight:600},children:"Create Announcement"})})]},"create")]:[]]:[...n.slice(0,5).map(e=>(0,q.jsxs)(v.A,{onClick:h,sx:{py:1.5,borderLeft:3,borderColor:u(e.priority)+".main","&:hover":{backgroundColor:"action.hover"}},children:[(0,q.jsx)(p.A,{sx:{minWidth:36},children:m(e.type)}),(0,q.jsx)(A.A,{primary:(0,q.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsx)(b.A,{variant:"body2",sx:{fontWeight:500,flex:1},children:e.title}),"NORMAL"!==e.priority&&(0,q.jsx)(ee.A,{label:e.priority,size:"small",color:u(e.priority),sx:{height:20,fontSize:"0.7rem"}})]}),secondary:(0,q.jsx)(b.A,{variant:"caption",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:e.message})})]},e.id)),...n.length>5?[(0,q.jsx)(d.A,{},"divider-1"),(0,q.jsx)(v.A,{onClick:h,children:(0,q.jsx)(A.A,{primary:(0,q.jsxs)(b.A,{variant:"body2",color:"primary",sx:{textAlign:"center"},children:["View all ",n.length," announcements"]})})},"view-all")]:[],...r?[(0,q.jsx)(d.A,{},"divider-2"),(0,q.jsxs)(v.A,{onClick:x,sx:{py:1.5,backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"}},children:[(0,q.jsx)(p.A,{sx:{minWidth:36,color:"inherit"},children:(0,q.jsx)(ae.A,{})}),(0,q.jsx)(A.A,{primary:(0,q.jsx)(b.A,{variant:"body2",sx:{fontWeight:600},children:"Create Announcement"})})]},"create")]:[]]]})]})};var le=o(6693),ce=o(68734),de=o(43466),he=o(98424);const xe=240,me=e=>{if(e)try{const n=window.location.origin,o=e.startsWith("/")?e:"/".concat(e);return"".concat(n).concat(o)}catch(n){return void console.error("Error constructing profile photo URL:",n)}},pe=e=>{var n,o;let{children:K}=e;const[V,J]=(0,t.useState)(!1),[Y,Z]=(0,t.useState)(null),[X,$]=(0,t.useState)(null),[ee,ne]=(0,t.useState)([]),[oe,te]=(0,t.useState)(!1),[re,ie]=(0,t.useState)(null),{user:ae,logout:pe,isLoading:Ae}=(0,F.As)(),{openHelp:ue}=(0,de.L)(),ge=(0,r.zy)(),je=(0,r.Zp)();(0,t.useEffect)(()=>{be(),ye()},[]),(0,t.useEffect)(()=>{oe&&be()},[oe]),(0,t.useEffect)(()=>{be()},[ge.pathname]);const be=async()=>{const e=await ce.Ay.getActiveAnnouncements();ne(e)},ye=async()=>{try{const e=(()=>window.location.origin)(),n=localStorage.getItem("tailtown_tenant_id")||localStorage.getItem("tenantId"),o={Authorization:"Bearer ".concat(localStorage.getItem("accessToken"))};n&&(o["x-tenant-subdomain"]=n);const t=await fetch("".concat(e,"/api/business-settings"),{headers:o});if(t.ok){const n=await t.json();if(n.logoUrl){const o="".concat(e).concat(n.logoUrl);ie(o),localStorage.setItem("businessLogo",o)}else localStorage.removeItem("businessLogo")}}catch(e){console.error("Error loading business settings:",e)}},fe=()=>{J(!V)},ve=()=>{Z(null)};if(Ae)return(0,q.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,q.jsx)(l.A,{})});if(!ae)return(0,q.jsx)(r.C5,{to:"/login",state:{from:ge},replace:!0});const ke=[{path:"/dashboard",label:"Dashboard",icon:C.A},{path:"/calendar",label:"Boarding & Daycare",icon:w.A},{path:"/calendar/grooming",label:"Grooming",icon:S.A},{path:"/calendar/training",label:"Training",icon:I.A},{path:"/customers",label:"Customers",icon:T.A},{path:"/pets",label:"Pets",icon:z.A},{path:"/report-cards",label:"Report Cards",icon:E.A},{path:"/waitlist",label:"Waitlist",icon:M.A},{path:"/products",label:"Products & POS",icon:P.A},{path:"/suites",label:"Kennels",icon:N.A,children:[{path:"/suites",label:"Kennel Board",icon:N.A},{path:"/kennels/print-cards",label:"Print Kennel Cards",icon:L.A}]},{path:"/reports",label:"Reports",icon:R.A,children:[{path:"/reports",label:"All Reports",icon:W.A},{path:"/analytics",label:"Sales Dashboard",icon:W.A},{path:"/analytics/customers",label:"Customer Value",icon:D.A}]}],Ce=(0,q.jsxs)("div",{children:[(0,q.jsx)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",py:2,px:1},children:(0,q.jsx)(s.A,{sx:{width:"140px",height:"140px",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,q.jsx)("img",{src:re||a,alt:"Business Logo",style:{width:"100%",height:"100%",objectFit:"contain",transform:re?"scale(1)":"scale(1.2)"}})})}),(0,q.jsx)(d.A,{}),(0,q.jsx)(h.A,{children:ke.map(e=>e.children?(0,q.jsxs)(t.Fragment,{children:[(0,q.jsx)(x.Ay,{disablePadding:!0,children:(0,q.jsxs)(m.A,{onClick:()=>{return n=e.label,void $(X===n?null:n);var n},selected:ge.pathname.startsWith(e.path),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(e.icon,{})}),(0,q.jsx)(A.A,{primary:e.label}),X===e.label?(0,q.jsx)(O.A,{}):(0,q.jsx)(B.A,{})]})}),X===e.label&&(0,q.jsx)(h.A,{component:"div",disablePadding:!0,children:e.children.map(e=>(0,q.jsx)(x.Ay,{disablePadding:!0,children:(0,q.jsxs)(m.A,{component:i.N_,to:e.path,selected:ge.pathname===e.path,onClick:fe,sx:{pl:4,"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(e.icon,{})}),(0,q.jsx)(A.A,{primary:e.label})]})},e.path))})]},e.path):(0,q.jsx)(x.Ay,{disablePadding:!0,children:(0,q.jsxs)(m.A,{component:i.N_,to:e.path,selected:ge.pathname===e.path,onClick:fe,sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(e.icon,{})}),(0,q.jsx)(A.A,{primary:e.label})]})},e.path))}),(0,q.jsx)(d.A,{}),(0,q.jsx)(h.A,{children:(0,q.jsx)(x.Ay,{disablePadding:!0,children:(0,q.jsxs)(m.A,{component:i.N_,to:"/settings",children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(_.A,{})}),(0,q.jsx)(A.A,{primary:"Admin"})]})})})]});return(0,q.jsxs)(s.A,{sx:{display:"flex"},children:[(0,q.jsx)(u.Ay,{}),(0,q.jsx)(le.A,{open:oe,announcements:ee,onClose:()=>te(!1),onDismiss:async e=>{try{await ce.Ay.dismissAnnouncement(e),ne(n=>n.filter(n=>n.id!==e)),console.log("Announcement dismissed successfully")}catch(n){console.error("Failed to dismiss announcement:",n),alert("Unable to dismiss announcement. Please try again later.")}}}),(0,q.jsx)(g.A,{position:"fixed",sx:{width:{sm:"calc(100% - ".concat(xe,"px)")},ml:{sm:"".concat(xe,"px")}},children:(0,q.jsxs)(c.A,{children:[(0,q.jsx)(j.A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:fe,sx:{mr:2,display:{sm:"none"}},children:(0,q.jsx)(U.A,{})}),(0,q.jsx)(b.A,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:(null===(n=ke.find(e=>e.path===ge.pathname))||void 0===n?void 0:n.label)||"Dashboard"}),(0,q.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,q.jsxs)(s.A,{sx:{display:{xs:"none",sm:"block"}},children:[(0,q.jsxs)(b.A,{variant:"body2",sx:{textAlign:"right",lineHeight:1.2},children:[null===ae||void 0===ae?void 0:ae.firstName," ",null===ae||void 0===ae?void 0:ae.lastName]}),(0,q.jsx)(b.A,{variant:"caption",color:"inherit",sx:{opacity:.8},children:(null===ae||void 0===ae?void 0:ae.role)||"Staff"})]}),(0,q.jsx)(se,{announcements:ee,onAnnouncementClick:()=>te(!0),onCreateClick:()=>je("/admin/announcements")}),(0,q.jsx)(j.A,{color:"inherit",onClick:()=>ue(),"aria-label":"help",sx:{ml:1},children:(0,q.jsx)(he.A,{})}),(0,q.jsx)(j.A,{size:"large",edge:"end",color:"inherit","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:e=>{Z(e.currentTarget)},children:(0,q.jsx)(y.A,{src:me(null===ae||void 0===ae?void 0:ae.profilePhoto),sx:{bgcolor:"secondary.main",border:"2px solid white"},children:!(null!==ae&&void 0!==ae&&ae.profilePhoto)&&((null===ae||void 0===ae||null===(o=ae.firstName)||void 0===o?void 0:o[0])||"U")})})]}),(0,q.jsxs)(f.A,{id:"menu-appbar",anchorEl:Y,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(Y),onClose:ve,children:[(0,q.jsxs)(v.A,{onClick:()=>{ve(),je("/profile")},children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(G.A,{fontSize:"small"})}),(0,q.jsx)(A.A,{children:"Profile"})]}),(0,q.jsxs)(v.A,{onClick:()=>{pe(),je("/login")},children:[(0,q.jsx)(p.A,{children:(0,q.jsx)(H.A,{fontSize:"small"})}),(0,q.jsx)(A.A,{children:"Logout"})]})]})]})}),(0,q.jsxs)(s.A,{component:"nav",sx:{width:{sm:xe},flexShrink:{sm:0}},"aria-label":"navigation menu",children:[(0,q.jsx)(k.Ay,{variant:"temporary",open:V,onClose:fe,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:xe}},children:Ce}),(0,q.jsx)(k.Ay,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:xe}},open:!0,children:Ce})]}),(0,q.jsxs)(s.A,{component:"main",sx:{flexGrow:1,p:3,width:{sm:"calc(100% - ".concat(xe,"px)")},minHeight:"100vh",backgroundColor:"background.default"},children:[(0,q.jsx)(c.A,{}),localStorage.getItem("impersonationSession")&&(0,q.jsx)(Q,{onExit:()=>{}}),K||(0,q.jsx)(r.sv,{})]})]})}}}]);