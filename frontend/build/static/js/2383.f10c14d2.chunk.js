"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[2383],{92383:(e,a,t)=>{t.d(a,{c:()=>n});var r=t(89379),s=t(82932),o=t(54060),i=t(78114),c=t(41976);const n={getAllResources:async function(e,a,t){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"asc",o=arguments.length>4?arguments[4]:void 0;try{if(a&&a>100){console.log("[ResourceService] Large limit detected:",a,"- fetching all pages");let e=[],i=1,c=1;const n=await s.Nl.get("/api/resources",{params:{page:i,limit:100,sortBy:t,sortOrder:r,type:o}});if("success"===n.data.status)for(e=n.data.data||[],c=n.data.totalPages||1,console.log("[ResourceService] First page fetched:",e.length,"resources, totalPages:",c);i<c;){i++;const a=await s.Nl.get("/api/resources",{params:{page:i,limit:100,sortBy:t,sortOrder:r,type:o}});"success"===a.data.status&&a.data.data&&(e=[...e,...a.data.data],console.log("[ResourceService] Page",i,"fetched:",a.data.data.length,"resources. Total so far:",e.length))}return console.log("[ResourceService] All pages fetched! Total resources:",e.length),{status:"success",data:e,totalPages:c,currentPage:c,results:e.length}}return(await s.Nl.get("/api/resources",{params:{page:e,limit:a,sortBy:t,sortOrder:r,type:o}})).data}catch(i){throw console.error("Error in getAllResources:",i),i}},getResource:async(e,a)=>{try{var t,r;const i=a||(0,o.$T)(new Date),c=await s.Nl.get("/api/resources/".concat(e),{params:{date:i}});c.data.data.reservations||(c.data.data.reservations=[]);const n=await s.Nl.get("/api/reservations",{params:{resourceId:e,date:i,status:"PENDING,CONFIRMED,CHECKED_IN"}});return"success"===(null===(t=n.data)||void 0===t?void 0:t.status)&&Array.isArray(null===(r=n.data)||void 0===r?void 0:r.data)&&n.data.data.length>0?c.data.data.reservations=n.data.data:c.data.data.reservations=[],c.data}catch(i){throw console.error("Error in getResource:",i),i}},createResource:async e=>{try{return(await s.Nl.post("/api/resources",e)).data}catch(a){throw console.error("Error in createResource:",a),a}},updateResource:async(e,a)=>{try{return(await s.Nl.put("/api/resources/".concat(e),a)).data}catch(t){throw console.error("Error in updateResource:",t),t}},deleteResource:async e=>{try{await s.Nl.delete("/api/resources/".concat(e))}catch(a){throw console.error("Error in deleteResource:",a),a}},getSuites:async(e,a,t,i)=>{try{var c,n;const e=["STANDARD_SUITE","STANDARD_PLUS_SUITE","VIP_SUITE","SUITE"];let a=[],t=1,d=1;const v=100;do{var l,u;const r=await s.Nl.get("/api/resources",{params:{type:e.join(","),page:t,limit:v,date:i}});if("success"!==(null===r||void 0===r||null===(l=r.data)||void 0===l?void 0:l.status)||!Array.isArray(null===r||void 0===r||null===(u=r.data)||void 0===u?void 0:u.data))break;a=a.concat(r.data.data),d=r.data.totalPages||1,t++}while(t<=d);const y=i||(0,o.$T)(new Date),p=await s.Nl.get("/api/reservations",{params:{date:y,status:"PENDING,CONFIRMED,CHECKED_IN",page:1,limit:500}}),g=(null===p||void 0===p||null===(c=p.data)||void 0===c||null===(n=c.data)||void 0===n?void 0:n.reservations)||[],h=a.map(e=>{const a=g.filter(a=>a.resourceId===e.id);return a.length,(0,r.A)((0,r.A)({},e),{},{reservations:a})});return{status:"success",data:h,results:h.length}}catch(d){throw console.error("Error in getSuites:",d),d}},getSuiteStats:async e=>{try{const r=await n.getSuites(void 0,void 0,void 0,e);if("success"!==r.status||!Array.isArray(r.data))throw new Error("Failed to fetch suites data for stats calculation");let s=0,o=0,i=0,c=0,l=0,u=0;const d=r.data;for(const e of d){var a,t;s++;const r=e.reservations&&e.reservations.length>0,n=e.maintenanceStatus||(null===(a=e.attributes)||void 0===a?void 0:a.maintenanceStatus),d=e.lastCleanedAt||(null===(t=e.attributes)||void 0===t?void 0:t.lastCleaned);if("MAINTENANCE"===n||"OUT_OF_ORDER"===n)l++;else if("NEEDS_CLEANING"===n||d&&new Date(d)<new Date(Date.now()-864e5))u++;else if(r&&e.reservations){const a=e.reservations[0];"CONFIRMED"===a.status||"CHECKED_IN"===a.status?i++:"PENDING"===a.status?c++:o++}else o++}return{status:"success",data:{total:s,occupied:i,reserved:c,available:o,maintenance:l,needsCleaning:u,occupancyRate:s>0?Math.round((i+c)/s*100):0}}}catch(r){throw console.error("Error in getSuiteStats:",r),r}},updateSuiteCleaning:async(e,a)=>{try{return(await s.Nl.patch("/api/resources/".concat(e),{maintenanceStatus:a.maintenanceStatus,notes:a.notes})).data}catch(t){throw console.error("Error in updateSuiteCleaning:",t),t}},initializeSuites:async e=>{try{return console.warn("Suite initialization endpoint not available in this version"),{status:"error",message:"Suite initialization is not available in this version of the API",data:null}}catch(a){throw console.error("Error in initializeSuites:",a),a}},getAvailableResourcesByDate:async(e,a,t)=>{try{var r,o;let u;if(t)try{var n;const e=await c.V.getServiceById(t),a=(null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.id?e.data:null===e||void 0===e?void 0:e.data)||e,r=(null===a||void 0===a?void 0:a.serviceCategory)||(null===a||void 0===a?void 0:a.category);u=(e=>{switch(e){case i.e.BOARDING:case"BOARDING":case i.e.DAYCARE:case"DAYCARE":return"SUITE";case i.e.GROOMING:case"GROOMING":return"GROOMING_TABLE";case i.e.TRAINING:case"TRAINING":return"TRAINING_ROOM";default:return"OTHER"}})(r)}catch(l){console.warn("Unable to resolve service by ID to map resourceType; proceeding without service filter",l)}const d={startDate:e,endDate:a};u&&(d.resourceType=u);const v=await s.Nl.get("/api/resources/availability",{params:d}),y=Array.isArray(null===v||void 0===v||null===(r=v.data)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.resources)?v.data.data.resources:Array.isArray(null===v||void 0===v?void 0:v.data)?v.data:[];return{status:"success",data:y.filter(e=>e&&(void 0===e.isAvailable||!0===e.isAvailable)).map(e=>({id:e.id||e.resourceId,name:e.name||e.resourceName||"Resource",type:e.type||e.resourceType||"OTHER",capacity:"capacity"in e?e.capacity:1,attributes:"attributes"in e?e.attributes:void 0,isActive:!0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}))}}catch(u){throw console.error("Error in getAvailableResourcesByDate:",u),u}},checkResourceAvailability:async(e,a)=>{try{return(await s.Nl.get("/api/resources/availability",{params:{resourceId:e,date:a}})).data}catch(t){throw console.error("Error in checkResourceAvailability:",t),t}},batchCheckResourceAvailability:async(e,a,t)=>{try{return(await s.Nl.post("/api/resources/availability/batch",{resources:e,startDate:a,endDate:t})).data}catch(r){throw console.error("Error in batchCheckResourceAvailability:",r),r}}}}}]);