"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[3058],{33058:(e,i,s)=>{s.r(i),s.d(i,{default:()=>P});var n=s(89379),t=s(9950),a=s(28429),r=s(62999),l=s(78317),d=s(82053),o=s(60899),c=s(2235),A=s(8145),x=s(25979),u=s(19647),h=s(70006),p=s(23266),m=s(74745),v=s(16497),j=s(37324),y=s(10226),g=s(25333),b=s(98785),C=s(65429),f=s(57988),E=s(99532),S=s(41976),T=s(78114),k=s(44414);const P=()=>{var e;const{id:i}=(0,a.g)(),s=(0,a.Zp)(),P=!i,[R,N]=(0,t.useState)({name:"",description:"",serviceCategory:T.e.DAYCARE,price:0,duration:0,requiresStaff:!1,isActive:!0,notes:"",availableAddOns:[],depositRequired:!1,depositType:void 0,depositAmount:void 0}),[w,D]=(0,t.useState)(!P),[I,W]=(0,t.useState)(!1),[q,V]=(0,t.useState)({name:"",description:"",price:0,duration:0}),[O,z]=(0,t.useState)(!1),[G,F]=(0,t.useState)({open:!1,message:"",severity:"success"}),$=(0,t.useCallback)(async()=>{try{const e=await S.V.getServiceById(i,!0);N(e.data),e.data&&!e.data.isActive&&F({open:!0,message:"This service has been deactivated and is not available for booking",severity:"warning"}),D(!1)}catch(e){const i=e.message||"Failed to load service";F({open:!0,message:i,severity:"error"}),setTimeout(()=>{s("/services")},2e3),D(!1)}},[i,P,s]);(0,t.useEffect)(()=>{P||$()},[P,$]);const M=e=>{const{name:i,value:s,type:t}=e.target;N(e=>(0,n.A)((0,n.A)({},e),{},{[i]:"number"===t?Number(s):s}))},_=e=>{const{name:i,checked:s}=e.target;N(e=>(0,n.A)((0,n.A)({},e),{},{[i]:s}))},H=e=>{const{name:i,value:s,type:t}=e.target;V(e=>(0,n.A)((0,n.A)({},e),{},{[i]:"number"===t?Number(s):s}))},B=()=>{F((0,n.A)((0,n.A)({},G),{},{open:!1}))};return w?(0,k.jsx)(r.A,{maxWidth:"lg",children:(0,k.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,k.jsx)(d.A,{children:"Loading service..."})})}):(0,k.jsxs)(r.A,{maxWidth:"lg",children:[(0,k.jsxs)(l.A,{sx:{py:4},children:[(0,k.jsx)(d.A,{variant:"h4",component:"h1",sx:{mb:4},children:P?"New Service":"Edit Service"}),(0,k.jsxs)(o.Ay,{container:!0,spacing:3,children:[(0,k.jsx)(o.Ay,{item:!0,xs:12,md:8,children:(0,k.jsx)(c.A,{sx:{p:3},children:(0,k.jsxs)(o.Ay,{container:!0,spacing:2,children:[(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Service Name",name:"name",value:R.name,onChange:M,required:!0})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Description",name:"description",value:R.description,onChange:M,multiline:!0,rows:3})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,sm:6,children:(0,k.jsxs)(x.A,{fullWidth:!0,children:[(0,k.jsx)(u.A,{children:"Category"}),(0,k.jsx)(h.A,{value:R.serviceCategory,onChange:e=>{N(i=>(0,n.A)((0,n.A)({},i),{},{serviceCategory:e.target.value}))},label:"Category",children:Object.values(T.e).filter(e=>e!==T.e.TRAINING).map(e=>(0,k.jsx)(p.A,{value:e,children:e},e))})]})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,sm:6,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Price",name:"price",type:"number",value:R.price,onChange:M,InputProps:{startAdornment:"$"}})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(m.A,{sx:{my:2},children:(0,k.jsx)(d.A,{variant:"overline",color:"text.secondary",children:"Deposit Configuration"})})}),(0,k.jsxs)(o.Ay,{item:!0,xs:12,children:[(0,k.jsx)(v.A,{control:(0,k.jsx)(j.A,{checked:R.depositRequired||!1,onChange:_,name:"depositRequired"}),label:"Require Deposit"}),(0,k.jsx)(d.A,{variant:"caption",color:"text.secondary",display:"block",sx:{ml:4,mt:-1},children:"Customers must pay a deposit when booking this service"})]}),R.depositRequired&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.Ay,{item:!0,xs:12,sm:6,children:(0,k.jsxs)(x.A,{fullWidth:!0,children:[(0,k.jsx)(u.A,{children:"Deposit Type"}),(0,k.jsxs)(h.A,{value:R.depositType||T.V.PERCENTAGE,onChange:e=>{const i=e.target.value;N(e=>(0,n.A)((0,n.A)({},e),{},{depositType:i,depositAmount:i===T.V.PERCENTAGE?50:.5*(e.price||0)}))},label:"Deposit Type",children:[(0,k.jsx)(p.A,{value:T.V.PERCENTAGE,children:"Percentage of Price"}),(0,k.jsx)(p.A,{value:T.V.FIXED_AMOUNT,children:"Fixed Dollar Amount"})]})]})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,sm:6,children:(0,k.jsx)(A.A,{fullWidth:!0,label:R.depositType===T.V.PERCENTAGE?"Deposit Percentage":"Deposit Amount",name:"depositAmount",type:"number",value:R.depositAmount||0,onChange:M,InputProps:{startAdornment:R.depositType===T.V.PERCENTAGE?"":"$",endAdornment:R.depositType===T.V.PERCENTAGE?"%":"",inputProps:{min:0,max:R.depositType===T.V.PERCENTAGE?100:void 0}},helperText:R.depositType===T.V.PERCENTAGE?"Deposit: $".concat(((R.price||0)*(R.depositAmount||0)/100).toFixed(2)):"".concat(((R.depositAmount||0)/(R.price||1)*100).toFixed(0),"% of service price")})})]}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(m.A,{sx:{my:1}})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,sm:6,children:(0,k.jsxs)(l.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,k.jsx)(d.A,{variant:"body2",sx:{minWidth:"60px"},children:"Duration:"}),(0,k.jsx)(A.A,{label:"Hours",type:"number",InputProps:{inputProps:{min:0}},value:void 0!==R.duration?Math.floor(R.duration/60):0,onChange:e=>{const i=parseInt(e.target.value)||0,s=void 0!==R.duration?R.duration%60:0;N(e=>(0,n.A)((0,n.A)({},e),{},{duration:60*i+s}))},size:"small",sx:{width:"100px"}}),(0,k.jsxs)(A.A,{label:"Min",select:!0,value:String(void 0!==R.duration?R.duration%60:0),onChange:e=>{const i=parseInt(e.target.value)||0,s=void 0!==R.duration?Math.floor(R.duration/60):0;N(e=>(0,n.A)((0,n.A)({},e),{},{duration:60*s+i}))},size:"small",sx:{width:"100px"},children:[(0,k.jsx)(p.A,{value:0,children:"0"},0),(0,k.jsx)(p.A,{value:5,children:"5"},5),(0,k.jsx)(p.A,{value:10,children:"10"},10),(0,k.jsx)(p.A,{value:15,children:"15"},15),(0,k.jsx)(p.A,{value:20,children:"20"},20),(0,k.jsx)(p.A,{value:25,children:"25"},25),(0,k.jsx)(p.A,{value:30,children:"30"},30),(0,k.jsx)(p.A,{value:35,children:"35"},35),(0,k.jsx)(p.A,{value:40,children:"40"},40),(0,k.jsx)(p.A,{value:45,children:"45"},45),(0,k.jsx)(p.A,{value:50,children:"50"},50),(0,k.jsx)(p.A,{value:55,children:"55"},55)]})]})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Notes",name:"notes",value:R.notes,onChange:M,multiline:!0,rows:2})}),(0,k.jsxs)(o.Ay,{item:!0,xs:12,children:[(0,k.jsx)(v.A,{control:(0,k.jsx)(j.A,{checked:!1!==R.taxable,onChange:_,name:"taxable"}),label:"Taxable"}),(0,k.jsx)(v.A,{control:(0,k.jsx)(j.A,{checked:R.requiresStaff,onChange:_,name:"requiresStaff"}),label:"Requires Staff"}),(0,k.jsx)(v.A,{control:(0,k.jsx)(j.A,{checked:R.isActive,onChange:_,name:"isActive"}),label:"Active"})]})]})})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,md:4,children:(0,k.jsxs)(c.A,{sx:{p:3},children:[(0,k.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,k.jsx)(d.A,{variant:"h6",children:"Add-On Services"}),!O&&(0,k.jsx)(y.A,{startIcon:(0,k.jsx)(E.A,{}),onClick:()=>z(!0),size:"small",children:"Add"})]}),O&&(0,k.jsx)(l.A,{sx:{mb:3,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:(0,k.jsxs)(o.Ay,{container:!0,spacing:2,children:[(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Name",name:"name",value:q.name,onChange:H,size:"small"})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Description",name:"description",value:q.description,onChange:H,size:"small"})}),(0,k.jsx)(o.Ay,{item:!0,xs:6,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Price",name:"price",type:"number",value:q.price,onChange:H,size:"small",InputProps:{startAdornment:"$"}})}),(0,k.jsx)(o.Ay,{item:!0,xs:6,children:(0,k.jsx)(A.A,{fullWidth:!0,label:"Duration",name:"duration",type:"number",value:q.duration,onChange:H,size:"small"})}),(0,k.jsx)(o.Ay,{item:!0,xs:12,children:(0,k.jsxs)(l.A,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[(0,k.jsx)(y.A,{size:"small",onClick:()=>z(!1),children:"Cancel"}),(0,k.jsx)(y.A,{variant:"contained",size:"small",onClick:()=>{N(e=>(0,n.A)((0,n.A)({},e),{},{availableAddOns:[...e.availableAddOns||[],q]})),V({name:"",description:"",price:0,duration:0}),z(!1)},disabled:!q.name,children:"Add"})]})})]})}),(0,k.jsx)(m.A,{sx:{my:2}}),null===(e=R.availableAddOns)||void 0===e?void 0:e.map((e,i)=>(0,k.jsxs)(l.A,{sx:{p:2,mb:1,border:"1px solid",borderColor:"divider",borderRadius:1,position:"relative"},children:[(0,k.jsx)(g.A,{size:"small",sx:{position:"absolute",top:8,right:8},onClick:()=>(e=>{N(i=>{var s;return(0,n.A)((0,n.A)({},i),{},{availableAddOns:null===(s=i.availableAddOns)||void 0===s?void 0:s.filter((i,s)=>s!==e)})})})(i),children:(0,k.jsx)(f.A,{})}),(0,k.jsx)(d.A,{variant:"subtitle1",children:e.name}),(0,k.jsx)(d.A,{variant:"body2",color:"textSecondary",children:e.description}),(0,k.jsx)(l.A,{sx:{mt:1},children:(0,k.jsxs)(d.A,{variant:"body2",children:["$",e.price," \u2022 ",e.duration," min"]})})]},i))]})})]}),(0,k.jsxs)(l.A,{sx:{mt:4,display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,k.jsx)(y.A,{onClick:()=>{s("/services")},children:"Cancel"}),(0,k.jsx)(y.A,{variant:"contained",onClick:async()=>{try{W(!0),console.log("Saving service:",R);const e=(0,n.A)((0,n.A)({},R),{},{isActive:void 0===R.isActive||R.isActive});P?await S.V.createService(e):await S.V.updateService(i,{name:e.name,description:e.description,duration:e.duration,price:e.price,color:e.color,serviceCategory:e.serviceCategory,isActive:e.isActive,requiresStaff:e.requiresStaff,notes:e.notes,availableAddOns:e.availableAddOns}),F({open:!0,message:"Service ".concat(P?"created":"updated"," successfully"),severity:"success"}),s("/services")}catch(e){const i=e.message||"Failed to ".concat(P?"create":"update"," service");F({open:!0,message:i,severity:"error"}),W(!1)}},disabled:I||!R.name,children:I?"Saving...":"Save"})]})]}),(0,k.jsx)(b.A,{open:G.open,autoHideDuration:6e3,onClose:B,children:(0,k.jsx)(C.A,{onClose:B,severity:G.severity,sx:{width:"100%"},children:G.message})})]})}}}]);