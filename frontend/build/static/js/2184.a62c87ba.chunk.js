"use strict";(self.webpackChunktailtown_frontend=self.webpackChunktailtown_frontend||[]).push([[2184],{52184:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var a=s(89379),n=s(9950),r=s(28429),l=s(62999),i=s(78317),d=s(46639),o=s(65429),c=s(82053),u=s(2235),v=s(25979),h=s(19647),x=s(70006),A=s(23266),f=s(8145),j=s(10226),m=s(396),g=s(81831),D=s(80678),S=s(69179),C=s(41976),b=s(92383),p=s(44414);function I(){var e,t,s,I;const{id:y}=(0,r.g)(),N=(0,r.Zp)(),[E,w]=(0,n.useState)(!0),[k,O]=(0,n.useState)(null),[R,W]=(0,n.useState)(null),[K,B]=(0,n.useState)([]),[F,P]=(0,n.useState)([]),[_,M]=(0,n.useState)(new Set),[H,L]=(0,n.useState)({startDate:new Date,endDate:new Date,status:"CONFIRMED",serviceId:"",resourceId:"",notes:"",staffNotes:""}),T=(0,n.useCallback)(async()=>{try{var e,t;if(!y)return;const[s,a,n]=await Promise.all([S.u.getReservationById(y),C.V.getAllServices(),b.c.getAllResources()]);W(s),B(a.data||[]),P(n.data||[]),L({startDate:new Date(s.startDate),endDate:new Date(s.endDate),status:s.status,serviceId:(null===(e=s.service)||void 0===e?void 0:e.id)||"",resourceId:(null===(t=s.resource)||void 0===t?void 0:t.id)||"",notes:s.notes||"",staffNotes:s.staffNotes||""}),O(null)}catch(k){console.error("Error fetching data:",k),O("Failed to load reservation details")}finally{w(!1)}},[y]);(0,n.useEffect)(()=>{T()},[T]);const G=(0,n.useCallback)(async()=>{if(H.startDate&&H.endDate&&0!==F.length)try{var e;const t=F.map(e=>e.id),s=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(a)},a=await b.c.batchCheckResourceAvailability(t,s(H.startDate),s(H.endDate));if("success"===(null===a||void 0===a?void 0:a.status)&&null!==a&&void 0!==a&&null!==(e=a.data)&&void 0!==e&&e.resources){const e=new Set;a.data.resources.forEach(t=>{if(!t.isAvailable){var s;y&&(null===(s=t.conflictingReservations)||void 0===s?void 0:s.some(e=>e.id===y))||e.add(t.resourceId)}}),M(e)}}catch(k){console.error("Error checking availability:",k),M(new Set)}else M(new Set)},[H.startDate,H.endDate,F,y]);(0,n.useEffect)(()=>{G()},[G]);return E?(0,p.jsx)(l.A,{maxWidth:"lg",children:(0,p.jsx)(i.A,{sx:{mt:4,display:"flex",justifyContent:"center"},children:(0,p.jsx)(d.A,{})})}):k||!R?(0,p.jsx)(l.A,{maxWidth:"lg",children:(0,p.jsx)(i.A,{sx:{mt:4},children:(0,p.jsx)(o.A,{severity:"error",children:k||"Reservation not found"})})}):(0,p.jsx)(l.A,{maxWidth:"lg",children:(0,p.jsxs)(i.A,{sx:{mt:4},children:[(0,p.jsx)(c.A,{variant:"h4",gutterBottom:!0,children:"Edit Reservation"}),(0,p.jsx)(u.A,{sx:{p:3},children:(0,p.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{if(!y)return;await S.u.updateReservation(y,(0,a.A)((0,a.A)({startDate:H.startDate.toISOString(),endDate:H.endDate.toISOString(),status:H.status,notes:H.notes,staffNotes:H.staffNotes},H.serviceId&&{serviceId:H.serviceId}),H.resourceId&&{resourceId:H.resourceId}));N("/reservations/".concat(y))}catch(k){console.error("Error updating reservation:",k),O("Failed to update reservation")}},children:[(0,p.jsxs)(i.A,{sx:{mb:3},children:[(0,p.jsxs)(c.A,{variant:"h6",gutterBottom:!0,children:["Service: ",(null===(e=R.service)||void 0===e?void 0:e.name)||"N/A"]}),(0,p.jsxs)(c.A,{variant:"body1",gutterBottom:!0,children:["Customer: ",null===(t=R.customer)||void 0===t?void 0:t.firstName," ",null===(s=R.customer)||void 0===s?void 0:s.lastName]}),(0,p.jsxs)(c.A,{variant:"body1",gutterBottom:!0,children:["Pet: ",null===(I=R.pet)||void 0===I?void 0:I.name]})]}),(0,p.jsxs)(g.$,{dateAdapter:m.h,children:[(0,p.jsx)(i.A,{sx:{mb:3},children:(0,p.jsx)(D.K,{label:"Start Date",value:H.startDate,onChange:e=>e&&L((0,a.A)((0,a.A)({},H),{},{startDate:e}))})}),(0,p.jsx)(i.A,{sx:{mb:3},children:(0,p.jsx)(D.K,{label:"End Date",value:H.endDate,onChange:e=>e&&L((0,a.A)((0,a.A)({},H),{},{endDate:e}))})})]}),(0,p.jsxs)(v.A,{fullWidth:!0,sx:{mb:3},children:[(0,p.jsx)(h.A,{children:"Status"}),(0,p.jsxs)(x.A,{value:H.status,label:"Status",onChange:e=>L((0,a.A)((0,a.A)({},H),{},{status:e.target.value})),children:[(0,p.jsx)(A.A,{value:"PENDING",children:"Pending"}),(0,p.jsx)(A.A,{value:"CONFIRMED",children:"Confirmed"}),(0,p.jsx)(A.A,{value:"CHECKED_IN",children:"Checked In"}),(0,p.jsx)(A.A,{value:"CHECKED_OUT",children:"Checked Out"}),(0,p.jsx)(A.A,{value:"COMPLETED",children:"Completed"}),(0,p.jsx)(A.A,{value:"CANCELLED",children:"Cancelled"}),(0,p.jsx)(A.A,{value:"NO_SHOW",children:"No Show"})]})]}),(0,p.jsxs)(v.A,{fullWidth:!0,sx:{mb:3},children:[(0,p.jsx)(h.A,{children:"Service"}),(0,p.jsxs)(x.A,{value:H.serviceId,label:"Service",onChange:e=>L((0,a.A)((0,a.A)({},H),{},{serviceId:e.target.value})),children:[(0,p.jsx)(A.A,{value:"",children:(0,p.jsx)("em",{children:"Select a service"})}),K.map(e=>(0,p.jsx)(A.A,{value:e.id,children:e.name},e.id))]})]}),(0,p.jsxs)(v.A,{fullWidth:!0,sx:{mb:3},children:[(0,p.jsx)(h.A,{children:"Kennel/Suite"}),(0,p.jsxs)(x.A,{value:H.resourceId,label:"Kennel/Suite",onChange:e=>L((0,a.A)((0,a.A)({},H),{},{resourceId:e.target.value})),children:[(0,p.jsx)(A.A,{value:"",children:(0,p.jsx)("em",{children:"Select a kennel/suite"})}),F.map(e=>{const t=_.has(e.id);return(0,p.jsxs)(A.A,{value:e.id,disabled:t,sx:{color:t?"#d32f2f":"#2e7d32",opacity:t?.6:1},children:[t?"\ud83d\udd34 ":"\ud83d\udfe2 ",e.name," (",e.type,")",t&&" (Occupied)"]},e.id)})]})]}),(0,p.jsx)(f.A,{fullWidth:!0,label:"Customer Notes",multiline:!0,rows:3,value:H.notes,onChange:e=>L((0,a.A)((0,a.A)({},H),{},{notes:e.target.value})),sx:{mb:3}}),(0,p.jsx)(f.A,{fullWidth:!0,label:"Staff Notes",multiline:!0,rows:3,value:H.staffNotes,onChange:e=>L((0,a.A)((0,a.A)({},H),{},{staffNotes:e.target.value})),sx:{mb:3}}),(0,p.jsxs)(i.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,p.jsx)(j.A,{variant:"outlined",onClick:()=>{N("/reservations/".concat(y))},children:"Cancel"}),(0,p.jsx)(j.A,{variant:"contained",type:"submit",children:"Save Changes"})]})]})})]})})}}}]);