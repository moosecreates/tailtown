// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Customer {
  id                String      @id @default(uuid())
  email             String      @unique
  firstName         String
  lastName          String
  phone             String?
  alternatePhone    String?
  address           String?
  city              String?
  state             String?
  zipCode           String?
  notes             String?
  portalEnabled     Boolean     @default(true)
  preferredContact  ContactMethod @default(EMAIL)
  emergencyContact  String?
  emergencyPhone    String?
  vatTaxId          String?     // For business customers and tax purposes
  referralSource    String?
  tags              String[]    @default([])
  isActive          Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  pets              Pet[]
  reservations      Reservation[]
  payments          Payment[]
  invoices          Invoice[]
  documents         Document[]
  notifications     NotificationPreference?
  
  @@map("customers")
}

model Pet {
  id                  String        @id @default(uuid())
  name                String
  type                PetType
  breed               String?
  color               String?
  birthdate           DateTime?
  weight              Float?
  gender              Gender?
  isNeutered          Boolean       @default(false)
  microchipNumber     String?
  rabiesTagNumber     String?
  specialNeeds        String?
  foodNotes           String?
  medicationNotes     String?
  behaviorNotes       String?
  allergies           String?
  idealPlayGroup      PlayGroupType?
  vaccinationStatus   Json?
  vaccineExpirations  Json?
  vetName             String?
  vetPhone            String?
  profilePhoto        String?       // URL to profile photo
  isActive            Boolean       @default(true)
  lastCheckIn         DateTime?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  customerId          String
  owner               Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  reservations        Reservation[]
  checkIns            CheckIn[]
  medicalRecords      MedicalRecord[]
  
  @@map("pets")
}

model Reservation {
  id                String            @id @default(uuid())
  startDate         DateTime
  endDate           DateTime
  status            ReservationStatus @default(PENDING)
  notes             String?
  staffNotes        String?           // Private notes for staff only
  checkInWindow     Int?              // Minutes before appointment when check-in is available
  isRecurring       Boolean           @default(false)
  recurringPattern  String?           // JSON pattern for recurring reservations
  preChecked        Boolean           @default(false)
  checkInDate       DateTime?
  checkOutDate      DateTime?
  earlyDropOff      Boolean           @default(false)
  latePickup        Boolean           @default(false)
  customPickupPerson String?
  confirmedBy       String?           // Staff who confirmed reservation
  cancelReason      String?
  cancelDate        DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  customerId        String
  customer          Customer          @relation(fields: [customerId], references: [id])
  petId             String
  pet               Pet               @relation(fields: [petId], references: [id])
  serviceId         String
  service           Service           @relation(fields: [serviceId], references: [id])
  resourceId        String?
  resource          Resource?         @relation(fields: [resourceId], references: [id])
  staffAssignedId   String?
  staffAssigned     Staff?            @relation(fields: [staffAssignedId], references: [id])
  addOnServices     ReservationAddOn[]
  invoice           Invoice?
  checkIns          CheckIn[]
  
  @@map("reservations")
}

enum PetType {
  DOG
  CAT
  BIRD
  RABBIT
  REPTILE
  OTHER
}

enum Gender {
  MALE
  FEMALE
  UNKNOWN
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  NO_SHOW
  COMPLETED
}

enum PlayGroupType {
  SMALL_DOGS
  MEDIUM_DOGS
  LARGE_DOGS
  HIGH_ENERGY
  LOW_ENERGY
  PUPPIES
  SENIORS
  SPECIAL_NEEDS
}

enum ContactMethod {
  EMAIL
  SMS
  BOTH
  NONE
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  CASH
  CHECK
  BANK_TRANSFER
  STORE_CREDIT
  GIFT_CARD
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum ResourceType {
  ROOM
  KENNEL
  GROOMING_TABLE
  PLAYPEN
  TRAINING_AREA
  OTHER
}

model Service {
  id              String        @id @default(uuid())
  name            String
  description     String?
  duration        Int           // Duration in minutes
  price           Float
  color           String?       // For calendar display
  serviceCategory ServiceCategory
  isActive        Boolean       @default(true)
  capacityLimit   Int?          // Max number of pets for this service type
  requiresStaff   Boolean       @default(false)
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  reservations    Reservation[]
  availableAddOns AddOnService[]
  
  @@map("services")
}

model AddOnService {
  id               String            @id @default(uuid())
  name             String
  description      String?
  price            Float
  duration         Int?              // Additional duration in minutes
  serviceId        String
  service          Service           @relation(fields: [serviceId], references: [id])
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  reservationAddOns ReservationAddOn[]
  
  @@map("addon_services")
}

model ReservationAddOn {
  id            String        @id @default(uuid())
  reservationId String
  reservation   Reservation   @relation(fields: [reservationId], references: [id], onDelete: Cascade)
  addOnId       String
  addOn         AddOnService  @relation(fields: [addOnId], references: [id])
  price         Float         // Captured price at time of booking
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  @@map("reservation_addons")
}

model Resource {
  id              String        @id @default(uuid())
  name            String
  type            ResourceType
  description     String?
  capacity        Int?
  isActive        Boolean       @default(true)
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  reservations    Reservation[]
  
  @@map("resources")
}

model Staff {
  id                String        @id @default(uuid())
  firstName         String
  lastName          String
  email             String        @unique
  phone             String?
  role              String
  workSchedule      Json?         // JSON data for work schedule
  specialties       String[]      @default([])
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  assignedReservations Reservation[]
  
  @@map("staff")
}

model Invoice {
  id              String          @id @default(uuid())
  invoiceNumber   String          @unique
  customerId      String
  customer        Customer        @relation(fields: [customerId], references: [id])
  reservationId   String?         @unique
  reservation     Reservation?    @relation(fields: [reservationId], references: [id])
  issueDate       DateTime        @default(now())
  dueDate         DateTime
  status          InvoiceStatus   @default(DRAFT)
  subtotal        Float
  taxRate         Float           @default(0)
  taxAmount       Float           @default(0)
  discount        Float           @default(0)
  total           Float
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  lineItems       InvoiceLineItem[]
  payments        Payment[]
  
  @@map("invoices")
}

model InvoiceLineItem {
  id              String    @id @default(uuid())
  invoiceId       String
  invoice         Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  description     String
  quantity        Int       @default(1)
  unitPrice       Float
  amount          Float
  taxable         Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("invoice_line_items")
}

model Payment {
  id                String          @id @default(uuid())
  invoiceId         String
  invoice           Invoice         @relation(fields: [invoiceId], references: [id])
  customerId        String
  customer          Customer        @relation(fields: [customerId], references: [id])
  amount            Float
  method            PaymentMethod
  status            PaymentStatus   @default(PENDING)
  transactionId     String?
  paymentDate       DateTime        @default(now())
  gatewayResponse   Json?
  refundedAmount    Float           @default(0)
  refundReason      String?
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  @@map("payments")
}

model Document {
  id              String    @id @default(uuid())
  customerId      String
  customer        Customer  @relation(fields: [customerId], references: [id])
  title           String
  description     String?
  fileUrl         String
  fileType        String
  fileSize        Int
  tags            String[]  @default([])
  uploaded        DateTime  @default(now())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("documents")
}

model NotificationPreference {
  id                  String    @id @default(uuid())
  customerId          String    @unique
  customer            Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  emailNotifications  Boolean   @default(true)
  smsNotifications    Boolean   @default(false)
  pushNotifications   Boolean   @default(false)
  marketingEmails     Boolean   @default(true)
  appointmentReminders Boolean   @default(true)
  checkinNotifications Boolean   @default(true)
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@map("notification_preferences")
}

model CheckIn {
  id                String    @id @default(uuid())
  petId             String
  pet               Pet       @relation(fields: [petId], references: [id])
  reservationId     String?
  reservation       Reservation? @relation(fields: [reservationId], references: [id])
  checkInTime       DateTime  @default(now())
  checkOutTime      DateTime?
  checkInNotes      String?
  checkOutNotes     String?
  checkInBy         String?   // Staff who processed check-in
  checkOutBy        String?   // Staff who processed check-out
  belongingsChecklist Json?    // List of items brought with pet
  foodProvided      Boolean   @default(false)
  medicationGiven   Boolean   @default(false)
  medicationNotes   String?
  behaviorDuringStay String?
  photosTaken       Boolean   @default(false)
  photosShared      Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  activities        Activity[]
  
  @@map("check_ins")
}

model Activity {
  id              String    @id @default(uuid())
  checkInId       String
  checkIn         CheckIn   @relation(fields: [checkInId], references: [id], onDelete: Cascade)
  activityType    String
  notes           String?
  timestamp       DateTime  @default(now())
  recordedBy      String?   // Staff who recorded the activity
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("activities")
}

model MedicalRecord {
  id              String    @id @default(uuid())
  petId           String
  pet             Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)
  recordType      String
  recordDate      DateTime
  expirationDate  DateTime?
  description     String
  veterinarian    String?
  fileUrl         String?
  verified        Boolean   @default(false)
  verifiedBy      String?
  verifiedDate    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("medical_records")
}

enum ServiceCategory {
  DAYCARE
  BOARDING
  GROOMING
  TRAINING
  OTHER
}
